<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¿¡ç”¨å¡å›é¥‹æŸ¥è©¢åŠ©æ‰‹ 2026</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --color-primary: #2180a0;
            --color-primary-hover: #1a6b84;
            --color-bg: #f5f5f5;
            --color-surface: #ffffff;
            --color-text: #333333;
            --color-text-light: #666666;
            --color-border: #e0e0e0;
            --color-success: #32b862;
            --color-danger: #e74c3c;
            --color-warning: #f57c00;
            --color-badge-bg: #e3f2fd;
            --color-badge-text: #1565c0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            padding: 20px;
            line-height: 1.6;
            padding-top: 10px;
        }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 15px; color: var(--color-primary); font-size: 1.6em; }
        
        /* === é ‚éƒ¨å°è¦½åˆ— === */
        .nav-tabs {
            display: flex;
            background: var(--color-surface);
            padding: 5px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            z-index: 900;
        }
        .nav-item {
            flex: 1;
            text-align: center;
            padding: 12px;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 600;
            color: var(--color-text-light);
            transition: all 0.3s;
        }
        .nav-item.active {
            background-color: var(--color-primary);
            color: white;
            box-shadow: 0 2px 4px rgba(33, 128, 160, 0.3);
        }
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* === æœå°‹é æ¨£å¼ === */
        .form-section {
            background: var(--color-surface);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .info-text {
            background: #e3f2fd;
            padding: 12px;
            border-radius: 8px;
            color: #0d47a1;
            margin-bottom: 20px;
            font-size: 0.9em;
            line-height: 1.5;
            border-left: 4px solid #2196f3;
        }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--color-text); }
        .input-wrapper { position: relative; display: flex; align-items: center; }
        input[type="text"] {
            width: 100%;
            padding: 14px 40px 14px 16px;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            font-size: 16px;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(33, 128, 160, 0.1);
        }
        .clear-btn {
            position: absolute; right: 12px;
            background: #eee; border: none; border-radius: 50%;
            width: 24px; height: 24px; cursor: pointer; color: #666;
            display: none; align-items: center; justify-content: center;
        }
        .category-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 15px; }
        .category-tag {
            padding: 6px 12px; background: var(--color-surface);
            border: 1px solid var(--color-border); border-radius: 20px;
            cursor: pointer; font-size: 0.85em; color: var(--color-text-light);
            transition: all 0.2s; user-select: none;
        }
        .category-tag.active { background: var(--color-primary); color: white; border-color: var(--color-primary); }
        
        /* æœå°‹çµæœåˆ—è¡¨ */
        .merchant-list {
            background: var(--color-surface); padding: 16px;
            border-radius: 12px; margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: transform 0.2s; cursor: pointer;
        }
        .merchant-list:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .merchant-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .merchant-name { font-size: 1.1em; font-weight: 700; color: var(--color-text); }
        
        /* è† å›Šæ¨™ç±¤æ¨£å¼ (Badge) */
        .scheme-badge {
            display: inline-block;
            background-color: var(--color-badge-bg);
            color: var(--color-badge-text);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 700;
            margin: 0 4px;
            border: 1px solid rgba(21, 101, 192, 0.2);
        }
        .scheme-badge.crazy { background-color: #ffebee; color: #c62828; border-color: #ffcdd2; }
        .scheme-badge.new-user { background-color: #fff3e0; color: #e65100; border-color: #ffe0b2; }

        .card-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 8px 0; border-bottom: 1px dashed #eee; font-size: 0.95em;
        }
        .card-row:last-child { border-bottom: none; }
        .card-info { display: flex; align-items: center; flex: 1; }
        .card-rate { font-weight: 700; color: var(--color-primary); margin-left: 10px; min-width: 50px; text-align: right; }
        .card-rate.high { color: var(--color-success); font-size: 1.1em; }
        .card-note { font-size: 0.8em; color: #999; margin-left: 10px; display: block; width: 100%; margin-top: 2px;}
        .card-row-content { flex: 1; }

        /* === æ¬Šç›Šç¸½è¦½æ¨£å¼ === */
        .card-accordion-item {
            background: var(--color-surface); border-radius: 12px; margin-bottom: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05); overflow: hidden; border: 1px solid var(--color-border);
        }
        .accordion-header {
            padding: 16px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;
            background: white; transition: background 0.2s;
        }
        .accordion-header:hover { background: #f9f9f9; }
        .card-title-row { display: flex; align-items: center; gap: 10px; }
        .card-icon { font-size: 1.2em; }
        .card-title-text { font-weight: 700; font-size: 1.1em; color: var(--color-text); }
        .chevron { transition: transform 0.3s; color: #999; }
        .accordion-header.active .chevron { transform: rotate(180deg); }
        .accordion-body { display: none; padding: 0; background: #fff; border-top: 1px solid #eee; }
        .accordion-body.open { display: block; animation: slideDown 0.3s ease-out; }
        @keyframes slideDown { from { opacity: 0; max-height: 0; } to { opacity: 1; max-height: 2000px; } }
        
        .benefit-row { 
            padding: 14px 20px; border-bottom: 1px solid #f0f0f0; 
            display: flex; flex-direction: column; cursor: pointer; transition: background 0.2s;
            position: relative;
        }
        .benefit-row:hover { background-color: #f8fbff; }
        .benefit-row::after {
            content: 'â€º'; position: absolute; right: 20px; top: 50%; transform: translateY(-50%);
            font-size: 1.5em; color: #ccc; font-weight: 300;
        }
        .benefit-row.no-action::after { content: ''; }
        .benefit-row.no-action { cursor: default; }

        .benefit-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; padding-right: 20px; }
        .benefit-name { font-weight: 600; font-size: 1em; color: #444; display: flex; align-items: center; gap: 6px; }
        .benefit-rate { font-weight: 700; color: var(--color-primary); font-size: 1.1em; }
        .benefit-rate.high { color: var(--color-danger); }
        .benefit-desc { font-size: 0.85em; color: #666; margin-top: 2px; padding-right: 20px; line-height: 1.4; }
        .benefit-note { font-size: 0.8em; color: #999; margin-top: 4px; display: flex; align-items: center; gap: 4px; }
        .urgent-text { color: #c62828; font-weight: 700; background: #ffebee; padding: 1px 4px; border-radius: 4px; }

        /* === è©³æƒ…å½ˆçª— === */
        .detail-modal {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6); z-index: 2000;
            align-items: center; justify-content: center; padding: 20px;
            backdrop-filter: blur(2px);
        }
        .detail-modal.show { display: flex; }
        .detail-content {
            background: var(--color-surface); border-radius: 16px;
            width: 100%; max-width: 500px; max-height: 85vh;
            display: flex; flex-direction: column;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .detail-header { padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: flex-start; }
        .detail-title h2 { font-size: 1.5em; color: var(--color-primary); margin: 0; }
        .detail-close {
            background: #f0f0f0; border: none; width: 32px; height: 32px;
            border-radius: 50%; font-size: 20px; cursor: pointer; color: #666;
        }
        .detail-body { padding: 20px; overflow-y: auto; }
        
        .scheme-list-container { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        .scheme-list-item { background: #f5f5f5; padding: 6px 12px; border-radius: 6px; font-size: 0.9em; color: #333; }
        
        @media (max-width: 480px) {
            body { padding: 15px; padding-top: 10px; }
            h1 { font-size: 1.5em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ’³ ä¿¡ç”¨å¡å›é¥‹æŸ¥è©¢åŠ©æ‰‹ 2026</h1>

        <div class="nav-tabs">
            <div class="nav-item active" onclick="switchTab('search')">ğŸ” é€šè·¯æœå°‹</div>
            <div class="nav-item" onclick="switchTab('overview')">ğŸ“‹ æ¬Šç›Šç¸½è¦½</div>
        </div>

        <div id="tab-search" class="tab-content active">
            <div class="form-section">
                <div class="info-text">
                    ğŸ” <strong>2026å¹´æœ€æ–°æ¬Šç›Š</strong>ï¼šåœ‹æ³°CUBE(ç˜‹å¤§æ¸¯3.5%è‡³3/23)ã€å°æ–°Richartã€ç‰å±±Unicard(æ–°æˆ¶7.5%)ã€UBear(æ–°æˆ¶10%)ã€æ°¸è±DAWHOã€‚
                </div>
                
                <div class="form-group">
                    <label for="searchMerchant">æœå°‹é€šè·¯åç¨±</label>
                    <div class="input-wrapper">
                        <input type="text" id="searchMerchant" placeholder="ä¾‹å¦‚ï¼šKlookã€é«˜éµã€éº¥ç•¶å‹..." autocomplete="off">
                        <button id="clearSearch" class="clear-btn" onclick="clearSearch()">âœ•</button>
                    </div>
                </div>
                
                <div style="margin-top: 10px;">
                    <label>å¿«é€Ÿç¯„ä¾‹</label>
                    <div class="category-tags">
                        <div class="category-tag" onclick="quickSearch('é«˜éµ')">ğŸš… é«˜éµ</div>
                        <div class="category-tag" onclick="quickSearch('è¦çš®')">ğŸ›ï¸ è¦çš®</div>
                        <div class="category-tag" onclick="quickSearch('éº¥ç•¶å‹')">ğŸ” éº¥ç•¶å‹</div>
                        <div class="category-tag" onclick="quickSearch('æ—¥æœ¬')">ğŸ‡¯ğŸ‡µ æ—¥æœ¬</div>
                        <div class="category-tag" onclick="quickSearch('Uber')">ğŸš— Uber</div>
                        <div class="category-tag" onclick="quickSearch('å…¨è¯')">ğŸ›’ å…¨è¯</div>
                    </div>
                </div>
            </div>

            <div id="merchantResults" class="results-section">
                <div id="merchantContainer"></div>
            </div>
        </div>

        <div id="tab-overview" class="tab-content">
            <div id="cardOverviewContainer"></div>
        </div>

    </div>

    <div id="detailModal" class="detail-modal" onclick="if(event.target === this) closeDetailModal()">
        <div class="detail-content">
            <div class="detail-header">
                <div class="detail-title">
                    <h2 id="modalTitle">æ–¹æ¡ˆè©³æƒ…</h2>
                </div>
                <button class="detail-close" onclick="closeDetailModal()">âœ•</button>
            </div>
            <div id="detailBody" class="detail-body"></div>
        </div>
    </div>

    <script>
        // === æ¬Šç›Šç¸½è¦½è³‡æ–™ (Single Source of Truth) ===
        const cardBenefitsData = [
            {
                id: 'cube',
                name: 'åœ‹æ³° CUBE',
                icon: 'âšªï¸',
                note: 'éœ€æ¯æ—¥é€é CUBE App åˆ‡æ›è‡³å°æ‡‰æ¬Šç›Šæ–¹æ¡ˆ',
                benefits: [
                    { 
                        name: 'ç˜‹å¤§æ¸¯', rate: 0.035, tag: 'crazy',
                        desc: 'æŒ‡å®šé«˜é›„ä½å®¿ | Klook | å°ç£é«˜éµ | å°ç£éµè·¯å±€', 
                        list: ['åŸå¸‚å•†æ—…', 'å’Œé€¸é£¯åº—', 'æ—…å±…æ–‡æ—…', 'ç§èŠ¯æ—…åº—', 'å¤å„ªæ—…å±…', 'è¯åœ’å¤§é£¯åº—', 'æ·çµ²æ—…', 'éº—å°Šé…’åº—', 'å¸•å¯éº—é…’åº—', 'éˆæ€¡å¤§é£¯åº—', 'Klook', 'å°ç£é«˜éµ', 'å°ç£éµè·¯å±€'],
                        note: '<span class="urgent-text">2026/3/23 æˆªæ­¢</span> âš ï¸ è¨˜å¾—åˆ‡æ›æ–¹æ¡ˆ'
                    },
                    { 
                        name: 'é›†ç²¾é¸', rate: 0.02, tag: 'base',
                        desc: 'è¶…å•† | é‡è²© | åŠ æ²¹ | IKEA | å……é›»åœè»Š', 
                        list: ['7-ELEVEN', 'å…¨å®¶ä¾¿åˆ©å•†åº—', 'å®¶æ¨‚ç¦', 'å…¨è¯ç¦åˆ©ä¸­å¿ƒ', 'LOPIAå°ç£', 'å°ç£ä¸­æ²¹-ç›´ç‡Ÿç«™', 'IKEA', 'U-POWER', 'EVOASIS', 'EVALUE', 'TAIL', 'iCharging', 'è»Šéº»å‰', 'uTagGo'],
                        note: 'âš ï¸ è¨˜å¾—åˆ‡æ›æ–¹æ¡ˆ'
                    },
                    { 
                        name: 'ç©æ•¸ä½', rate: 0.03, tag: 'digital',
                        desc: 'ç¶²è³¼ | å½±éŸ³ | AI | åœ‹éš›é›»å•†', 
                        list: ['è¦çš®è³¼ç‰©', 'momoè³¼ç‰©ç¶²', 'PChome 24hè³¼ç‰©', 'å°æ¨¹è³¼', 'æ·˜å¯¶', 'å¤©è²“', 'Coupang é…·æ¾', 'Apple åª’é«”æœå‹™', 'Google Play', 'Disney+', 'Netflix', 'Spotify', 'YouTube Premium', 'Max', 'ChatGPT', 'Canva', 'Claude', 'Cursor', 'Duolingo', 'Gamma', 'Gemini', 'Notion', 'Perplexity', 'Speak'],
                        note: 'âš ï¸ è¨˜å¾—åˆ‡æ›æ–¹æ¡ˆ'
                    },
                    { 
                        name: 'æ¨‚éŸ¿è³¼', rate: 0.03, tag: 'fun',
                        desc: 'ç™¾è²¨ | é¤é£² | å¤–é€ | è—¥å¦', 
                        list: ['é æ±SOGO', 'æ–°å…‰ä¸‰è¶Š', 'é æ±ç™¾è²¨', 'å°åŒ—101', 'å¾®é¢¨å»£å ´', 'èª å“ç”Ÿæ´»', 'äº¬ç«™', 'ç¾éº—è¯', 'LaLaport', 'æ¼¢ç¥ç™¾è²¨', 'æ¼¢ç¥å·¨è›‹', 'çµ±ä¸€æ™‚ä»£', 'MITSUI OUTLET PARK', 'è¯æ³°åå“åŸ', 'é æ±Garden City', 'BELLAVITA', 'NOKEå¿ æ³°æ¨‚ç”Ÿæ´»', 'å¤§è‘‰é«˜å³¶å±‹', 'å®åŒ¯å»£å ´', 'å°èŒ‚', 'å¤§æ±Ÿ', 'Big City', 'ä¸­å‹', 'å»£ä¸‰SOGO', 'å—ç´¡', 'å¤¢æ™‚ä»£', 'SKM Park', 'åœ‹å…§é¤é£²', 'éº¥ç•¶å‹', 'Uber Eats', 'foodpanda', 'å±ˆè‡£æ°', 'åº·æ˜¯ç¾'],
                        note: 'âš ï¸ è¨˜å¾—åˆ‡æ›æ–¹æ¡ˆ'
                    },
                    { 
                        name: 'è¶£æ—…è¡Œ', rate: 0.03, tag: 'travel',
                        desc: 'æµ·å¤–å¯¦é«” | è¨‚æˆ¿ | èˆªç©º | æ—…è¡Œç¤¾ | åœ‹å…§äº¤é€š', 
                        list: ['æµ·å¤–æ¶ˆè²»', 'Uber', 'Grab', 'SUICA', 'PASMO', 'ICOCA', 'Klook', 'KKday', 'Agoda', 'Airbnb', 'Booking.com', 'Trip.com', 'é›„ç…æ—…éŠ', 'æ˜“éŠç¶²', 'å¯æ¨‚æ—…éŠ', 'æ±å—æ—…éŠ', 'äº”ç¦æ—…éŠ', 'ç‡¦æ˜Ÿæ—…éŠ', 'å±±å¯Œæ—…éŠ', 'é•·æ±å‡æœŸ', 'é³³å‡°æ—…éŠ', 'æ˜“é£›ç¶²', 'å°ç£é«˜éµ', 'å°ç£å¤§è»ŠéšŠ', 'yoxi', 'iRent', 'å’Œé‹ç§Ÿè»Š', 'æ ¼ä¸Šç§Ÿè»Š', 'ä¸­è¯èˆªç©º', 'é•·æ¦®èˆªç©º', 'æ˜Ÿå®‡èˆªç©º', 'å°ç£è™èˆª', 'åœ‹æ³°èˆªç©º', 'æ¨‚æ¡ƒèˆªç©º', 'é˜¿è¯é…‹èˆªç©º', 'é…·èˆª', 'æ·æ˜Ÿèˆªç©º', 'æ—¥æœ¬èˆªç©º', 'äºæ´²èˆªç©º', 'è¯åˆèˆªç©º', 'æ–°åŠ å¡èˆªç©º', 'å…¨æ—¥ç©º', 'è¶Šæ·èˆªç©º', 'å¤§éŸ“èˆªç©º', 'é”ç¾èˆªç©º', 'åœŸè€³å…¶èˆªç©º', 'æ³•åœ‹èˆªç©º', 'åœ‹å…§é£¯åº—', 'æ˜Ÿé‡é›†åœ˜', 'è¿ªå£«å°¼é£¯åº—', 'æ±æ©«INN', 'æ±äº¬è¿ªå£«å°¼', 'ç’°çƒå½±åŸ', 'å“ˆåˆ©æ³¢ç‰¹å½±åŸ'],
                        note: 'âš ï¸ è¨˜å¾—åˆ‡æ›æ–¹æ¡ˆ (Klook/é«˜éµå„ªå…ˆé¸ç˜‹å¤§æ¸¯)'
                    }
                ]
            },
            {
                id: 'richart',
                name: 'å°æ–° Richart',
                icon: 'ğŸ¶',
                note: 'éœ€æ¯æ—¥é€é Richart App åˆ‡æ›æ–¹æ¡ˆ (Payè‘—åˆ·éœ€ç¶å°æ–°Pay)',
                benefits: [
                    { 
                        name: 'Payè‘—åˆ·', rate: 0.038, tag: 'pay',
                        desc: 'è¶…å•† | ç™¾è²¨ | IKEA | è¨ˆç¨‹è»Š (éœ€ç¶å°æ–°Pay)', 
                        list: ['7-11', 'å…¨å®¶', 'æ–°å…‰ä¸‰è¶Š', 'IKEA', 'å°ç£å¤§è»ŠéšŠ', 'å°æ–°Pay'],
                        note: 'âš ï¸ éœ€ç¶å®šå°æ–°Pay'
                    },
                    { 
                        name: 'æ•¸è¶£åˆ·', rate: 0.033, tag: 'digital',
                        desc: 'ç¶²è³¼ | éŠæˆ²å½±éŸ³ | èª²ç¨‹ | AI', 
                        list: ['è¦çš®', 'momo', 'é…·æ¾', 'PChome', 'æ·˜å¯¶', 'Amazon', 'æ±æ£®', 'åšå®¢ä¾†', 'Richart Mart', 'PayEasy', 'iHerb', 'SHEIN', 'Farfetch', 'Olive Young', 'çŸ¥è­˜è¡›æ˜Ÿ', 'Amazing Talker', 'Tutor ABC', 'Hahow', 'PressPlay', 'MyCard', 'éŠæˆ²æ©˜å­', 'Steam', 'PlayStation', 'Nintendo', 'Netfilx', 'Disney+', 'ChatGPT', 'Notion', 'Canva', 'Perplexity', 'Claude'],
                        note: 'âš ï¸ è¨˜å¾—ç•¶å¤©23:59å‰åˆ‡æ›æ–¹æ¡ˆ'
                    },
                    { 
                        name: 'ç©æ—…åˆ·', rate: 0.033, tag: 'travel',
                        desc: 'æµ·å¤– | èˆªç©º | è¨‚æˆ¿ | æ—…è¡Œç¤¾', 
                        list: ['æµ·å¤–æ¶ˆè²»', 'Klook', 'KKday', 'Agoda', 'Booking.com', 'Trip.com', 'Airbnb', 'Hotels.com', 'Expedia', 'Uber', 'Grab', 'SUICA', 'ICOCA', 'PASMO', 'WOWPASS', 'AIRSIM', 'é›„ç…æ—…éŠ', 'æ˜“éŠç¶²', 'æ±å—æ—…éŠ', 'å¯æ¨‚æ—…éŠ', 'é•·æ±å‡æœŸ', 'äº”ç¦æ—…éŠ', 'å–œé´»å‡æœŸ', 'æ˜“é£›æ—…éŠ', 'ç‡¦æ˜Ÿæ—…éŠ', 'åŠ åˆ©åˆ©', 'é³³å‡°åœ‹éš›', 'å±±å¯Œæ—…éŠ', 'è¡Œå¥æ—…éŠ', 'ä¸­è¯èˆªç©º', 'é•·æ¦®èˆªç©º', 'æ˜Ÿå®‡èˆªç©º', 'å°ç£è™èˆª', 'åœ‹æ³°èˆªç©º', 'è¯ä¿¡èˆªç©º', 'ç«‹æ¦®èˆªç©º', 'æ¨‚æ¡ƒèˆªç©º', 'é˜¿è¯é…‹èˆªç©º', 'äºæ´²èˆªç©º', 'é…·èˆª', 'æ·æ˜Ÿèˆªç©º', 'æ–°åŠ å¡èˆªç©º', 'æ—¥æœ¬èˆªç©º', 'è¶Šæ·èˆªç©º'],
                        note: 'âš ï¸ è¨˜å¾—ç•¶å¤©23:59å‰åˆ‡æ›æ–¹æ¡ˆ'
                    },
                    { 
                        name: 'å¤©å¤©åˆ·', rate: 0.033, tag: 'daily',
                        desc: 'è¶…å•†é‡è²©(Pay) | äº¤é€š | åœè»Š | è—¥å±€', 
                        list: ['7-11(å°æ–°Pay)', 'å…¨å®¶(å°æ–°Pay)', 'å®¶æ¨‚ç¦', 'å¤§è²·å®¶', 'å”å‰è»»å¾·', 'LOPIA', 'å°éµ', 'é«˜éµ', 'å°ç£å¤§è»ŠéšŠ', 'Yoxi', 'Uber', 'å˜Ÿå˜Ÿæˆ¿', 'è»Šéº»å‰', 'åŸå¸‚è»Šæ—…', 'ViViPark', 'USPACE', 'UDRIVE', 'iRent', 'å’Œé‹ç§Ÿè»Š', 'æ ¼ä¸Šç§Ÿè»Š', 'å¯¶é›…', 'åº·æ˜¯ç¾', 'å±ˆè‡£æ°', 'æä¸€é†«ç™‚', 'å¤§æ¨¹è—¥å±€', 'ä¸ä¸è—¥å±€', 'ä½‘å…¨ä¿å¥', 'å¥åº·äººç”Ÿ'],
                        note: 'âš ï¸ è¨˜å¾—ç•¶å¤©23:59å‰åˆ‡æ›æ–¹æ¡ˆ (è¶…å•†éœ€å°æ–°Pay)'
                    },
                    { 
                        name: 'å¤§ç­†åˆ·', rate: 0.033, tag: 'big',
                        desc: 'ç™¾è²¨ | Outlet | å±…å®¶ | æ™‚å°š', 
                        list: ['æ–°å…‰ä¸‰è¶Š', 'é æ±ç™¾è²¨', 'é æ±SOGO', 'æ¼¢ç¥å·¨è›‹', 'æ¼¢ç¥ç™¾è²¨', 'å¾®é¢¨', 'å°åŒ—101', 'é æ±å·¨åŸ', 'å»£ä¸‰SOGO', 'å—ç´¡è³¼ç‰©ä¸­å¿ƒ', 'èª å“ç”Ÿæ´»', 'äº¬ç«™', 'ä¸‰å‰µç”Ÿæ´»', 'å¤¢æ™‚ä»£', 'çµ±ä¸€æ™‚ä»£', 'ä¸­å‹ç™¾è²¨', 'LaLaport', 'MITSUI OUTLET PARK', 'è¯æ³°åå“åŸ', 'SKM Park', 'IKEA', 'ç‰¹åŠ›å±‹', 'HOLA', 'å®œå¾—åˆ©', 'ç‘ªé»‘å®¶å±…', 'UNIQLO', 'GU', 'ZARA', 'NET', 'lululemon'],
                        note: 'âš ï¸ è¨˜å¾—ç•¶å¤©23:59å‰åˆ‡æ›æ–¹æ¡ˆ'
                    },
                    { 
                        name: 'å¥½é¥—åˆ·', rate: 0.033, tag: 'fun',
                        desc: 'é¤é£² | å¤–é€ | åŠ æ²¹ | å¨›æ¨‚', 
                        list: ['åœ‹å…§é¤é£²', 'ç‹å“ç˜‹Pay', 'Uber Eats', 'Foodpanda', 'ä¸­æ²¹ç›´ç‡Ÿ', 'å°äºç›´ç‡Ÿ', 'å…¨åœ‹åŠ æ²¹', 'EVOASIS', 'EVALUE', 'æ‹“å…ƒå”®ç¥¨', 'KKTIX', 'å¹´ä»£å”®ç¥¨', 'å¯¬å®å”®ç¥¨', 'OPENTIX', 'FunNow', 'éŒ¢æ«ƒ', 'å¥½æ¨‚è¿ª', 'ONCOR', 'sing!go', 'äº«æº«é¦¨', 'ç¾©å¤§éŠæ¨‚ä¸–ç•Œ', 'éº—å¯¶æ¨‚åœ’', 'å…­ç¦æ‘', 'ä¹æ—æ–‡åŒ–æ‘', 'åŠæ¹–å±±', 'X-Park', 'æµ·ç”Ÿé¤¨', 'é é›„æµ·æ´‹å…¬åœ’', 'å°äººåœ‹', 'æ™¶è¯', 'é›²æœ—', 'è¬è±ª', 'ç…™æ³¢', 'è€çˆº', 'ç¦è¯', 'æ¼¢ä¾†', 'å›æ‚…', 'æ´²éš›', 'å¯’æ²'],
                        note: 'âš ï¸ è¨˜å¾—ç•¶å¤©23:59å‰åˆ‡æ›æ–¹æ¡ˆ'
                    },
                    { name: 'LINE Pay', rate: 0.023, desc: 'ä¸€èˆ¬ LINE Pay ç¶å®šæ”¯ä»˜', list: ['LINE Pay'], note: 'ç„¡é–€æª»' },
                    { name: 'å‡æ—¥åˆ·', rate: 0.02, desc: 'åœ‹å…§ç¯€å‡æ—¥ä¸é™é€šè·¯', list: [], note: 'åŸºæœ¬å›é¥‹' }
                ]
            },
            {
                id: 'unicard',
                name: 'ç‰å±± Unicard',
                icon: 'â›°ï¸',
                note: 'ç°¡å–®é¸ 3% / ä»»æ„é¸ 3.5% / UPé¸ 4.5% (æ–°æˆ¶æŒ‡å®šé€šè·¯ +3%)',
                benefits: [
                    { 
                        name: 'UPé¸', rate: 0.045, tag: 'unicard_all',
                        desc: 'ç™¾å¤§ç‰¹åº— (éœ€149é»è¨‚é–±)', 
                        list: ['ç‰å±±Wallet', 'LINE Pay', 'å…¨æ”¯ä»˜', 'è¡—å£æ”¯ä»˜', 'æ‚ éŠä»˜', 'å…¨ç›ˆ+PAY', 'iPASS MONEY', 'icash Pay', 'å°ç£ä¸­æ²¹', '55688', 'å°éµ', 'é«˜éµ', 'Uber', 'Yoxi', 'æ–°å…‰ä¸‰è¶Š', 'é æ±ç™¾è²¨', 'æ¼¢ç¥ç™¾è²¨', 'å¾®é¢¨', 'å°åŒ—101', 'è¯æ³°åå“åŸ', 'ä¸‰äº•OUTLET', 'äº¬ç«™', 'ç¾éº—è¯', 'èª å“', 'ç§€æ³°', 'LaLaport', 'çµ±é ˜', 'çµ±ä¸€æ™‚ä»£', 'æ˜‡æ†æ˜Œ', 'é‡‡ç›Ÿ', 'Uber Eats', 'foodpanda', 'EZTABLE', 'ç‹å“ç˜‹Pay', 'é¥—è³“', 'ç“¦åŸ', 'ä¹¾æ¯', 'æ¼¢ä¾†ç¾é£Ÿ', 'é¼ç‹', 'çˆ­é®®', 'ä¸­è¯èˆªç©º', 'é•·æ¦®èˆªç©º', 'æ—¥æœ¬èˆªç©º', 'å°ç£è™èˆª', 'æ¨‚æ¡ƒèˆªç©º', 'é…·èˆª', 'Trip.com', 'Booking.com', 'Hotels.com', 'AsiaYo', 'Expedia', 'KKday', 'Klook', 'é›„ç…', 'å¯æ¨‚', 'æ±å—', 'Agoda', 'Appleç›´ç‡Ÿåº—', 'å°ç±³å°ç£', 'å…¨åœ‹é›»å­', 'ç‡¦å¤', 'è¿ªå¡å„‚', 'å®¶æ¨‚ç¦', 'å±ˆè‡£æ°', 'åº·æ˜¯ç¾', 'ç‰¹åŠ›å±‹', 'HOLA', 'hoi', 'UNIQLO', 'NET', 'å¤§æ¨¹è—¥å±€', 'ä¸ä¸è—¥å¦', 'momoè³¼ç‰©ç¶²', 'è¦çš®è³¼ç‰©', 'æ·˜å¯¶', 'Coupangé…·æ¾', 'æ—¥æœ¬å¯¦é«”', 'éŸ“åœ‹å¯¦é«”', 'æ³°åœ‹å¯¦é«”', 'è¶Šå—å¯¦é«”', 'æ–°åŠ å¡å¯¦é«”', 'ç‰¹æ–¯æ‹‰', 'Gogoro', 'YouBike'],
                        note: '<span class="urgent-text">æ–°æˆ¶+3% (æœ€é«˜7.5%)</span>'
                    },
                    { name: 'ä¸€èˆ¬æ¶ˆè²»', rate: 0.01, desc: 'éæŒ‡å®šé€šè·¯', list: [], note: 'ç„¡ä¸Šé™' }
                ]
            },
            {
                id: 'ubear',
                name: 'ç‰å±± UBear',
                icon: 'ğŸ»',
                note: 'æŒ‡å®šå¨›æ¨‚ 10% / ç¶²è³¼ 3% (æ–°æˆ¶ç¶²è³¼ +7% = 10%)',
                benefits: [
                    { 
                        name: 'å½±éŸ³å¨›æ¨‚', rate: 0.10, tag: 'ent',
                        desc: 'Netflix | Disney+ | Nintendo | PlayStation', 
                        list: ['Netflix', 'Disney+', 'Nintendo', 'PlayStation'],
                        note: 'æ¯æœŸä¸Šé™ 100 å…ƒ' 
                    },
                    { 
                        name: 'ç¶²è³¼/Pay', rate: 0.03, tag: 'net',
                        desc: 'ç¶²è³¼ | è¡Œå‹•æ”¯ä»˜ | äº¤é€šè¨‚æˆ¿', 
                        list: ['LINE Pay', 'è¡—å£æ”¯ä»˜', 'æ‚ éŠä»˜', 'å…¨ç›ˆ+PAY', 'å…¨æ”¯ä»˜', 'momoè³¼ç‰©ç¶²', 'è¦çš®è³¼ç‰©', 'PChome', 'Coupang', 'æ·˜å¯¶', 'Uber Eats', 'foodpanda', 'é«˜éµ', 'å°éµ', 'Agoda', 'Booking.com'],
                        note: '<span class="urgent-text">æ–°æˆ¶+7% (æœ€é«˜10%)</span>' 
                    }
                ]
            },
            {
                id: 'dawho',
                name: 'æ°¸è± DAWHO',
                icon: 'âš«ï¸',
                note: 'åœ‹å…§ 3.5% / åœ‹å¤– 4.5% (éœ€å¤§æˆ¶ç­‰ç´š)',
                benefits: [
                    { 
                        name: 'åœ‹å…§å…¨é€šè·¯', rate: 0.035, tag: 'all',
                        desc: 'å…¨é€šè·¯ç„¡è…¦åˆ· (å«ä»»å‹™)', 
                        list: ['æ‰€æœ‰ä¸€èˆ¬æ¶ˆè²»'],
                        note: 'ä¸Šé™é¡¯ç¤º 3.5%' 
                    },
                    {
                        name: 'æ‚ éŠå¡', rate: 0.03, tag: 'easy',
                        desc: 'æ‚ éŠå¡è‡ªå‹•åŠ å€¼', list: ['æ‚ éŠå¡è‡ªå‹•åŠ å€¼'], note: 'ä¸Šé™100å…ƒ'
                    }
                ]
            }
        ];

        // === åˆ¥åå°ç…§è¡¨ (Alias Map) ===
        const aliasMap = {
            'é«˜éµ': 'å°ç£é«˜éµ',
            'å°éµ': 'å°ç£éµè·¯',
            '711': '7-ELEVEN',
            'å°ä¸ƒ': '7-ELEVEN',
            'éº¥ç•¶å‹': 'éº¥ç•¶å‹', 
            'è‚¯å¾·åŸº': 'åœ‹å…§é¤é£²',
            'æ˜Ÿå·´å…‹': 'åœ‹å…§é¤é£²',
            'ä¸­æ²¹': 'å°ç£ä¸­æ²¹',
            'line': 'LINE Pay',
            'uber': 'Uber',
            'ubereats': 'Uber Eats',
            'foodpanda': 'foodpanda',
            'ç†Šè²“': 'foodpanda',
            'å…¨è¯': 'å…¨è¯ç¦åˆ©ä¸­å¿ƒ',
            'å®¶æ¨‚ç¦': 'å®¶æ¨‚ç¦',
            'momo': 'momoè³¼ç‰©ç¶²',
            'è¦çš®': 'è¦çš®è³¼ç‰©',
            'pchome': 'PChome',
            'æ—¥æœ¬': 'æ—¥æœ¬å¯¦é«”',
            'éŸ“åœ‹': 'éŸ“åœ‹å¯¦é«”',
            'klook': 'Klook',
            'kkday': 'KKday'
        };

        let currentTab = 'search';

        function init() {
            renderCardOverview();
            const input = document.getElementById('searchMerchant');
            input.addEventListener('input', handleSearch); 
            input.addEventListener('focus', handleSearch); 
        }

        function switchTab(tabId) {
            currentTab = tabId;
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.querySelector(`.nav-item[onclick="switchTab('${tabId}')"]`).classList.add('active');
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(`tab-${tabId}`).classList.add('active');
        }

        function toggleAccordion(header) {
            const body = header.nextElementSibling;
            const isOpen = body.classList.contains('open');
            if (!isOpen) {
                body.classList.add('open');
                header.classList.add('active');
            } else {
                body.classList.remove('open');
                header.classList.remove('active');
            }
        }

        function renderCardOverview() {
            const container = document.getElementById('cardOverviewContainer');
            const html = cardBenefitsData.map((card, cardIndex) => `
                <div class="card-accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <div class="card-title-row">
                            <span class="card-icon">${card.icon}</span>
                            <span class="card-title-text">${card.name}</span>
                        </div>
                        <span class="chevron">â–¼</span>
                    </div>
                    <div class="accordion-body">
                        <div class="benefit-row no-action" style="background:#fffcec; border-bottom:1px dashed #e0e0e0;">
                            <div class="benefit-name" style="font-size:0.9em; color:#666;">â„¹ï¸ å¡ç‰‡å‚™è¨»</div>
                            <div class="benefit-desc">${card.note}</div>
                        </div>
                        ${card.benefits.map((b, bIndex) => `
                            <div class="benefit-row ${b.list && b.list.length > 0 ? '' : 'no-action'}" 
                                 onclick="${b.list && b.list.length > 0 ? `openDetail(${cardIndex}, ${bIndex})` : ''}">
                                <div class="benefit-header">
                                    <span class="benefit-name">${b.name}</span>
                                    <span class="benefit-rate ${b.rate >= 0.035 ? 'high' : ''}">${(b.rate * 100).toFixed(1)}%</span>
                                </div>
                                <div class="benefit-desc">${b.desc}</div>
                                <div class="benefit-note">ğŸ’¡ ${b.note}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
            container.innerHTML = html;
        }

        function openDetail(cardIndex, benefitIndex) {
            const benefit = cardBenefitsData[cardIndex].benefits[benefitIndex];
            const cardName = cardBenefitsData[cardIndex].name;
            
            let listHtml = '<div style="color:#999;">æš«ç„¡è©³ç´°æ¸…å–®</div>';
            if (benefit.list && benefit.list.length > 0) {
                listHtml = `<div class="scheme-list-container">
                    ${benefit.list.map(item => `<span class="scheme-list-item">${item}</span>`).join('')}
                </div>`;
            }

            document.getElementById('detailBody').innerHTML = `
                <div style="font-size:1.2em; font-weight:700; color:var(--color-primary); margin-bottom:5px;">${cardName}</div>
                <div style="font-size:1.1em; font-weight:600; margin-bottom:10px;">${benefit.name} <span style="color:var(--color-success)">${(benefit.rate * 100).toFixed(1)}%</span></div>
                <div style="font-size:0.9em; color:#666; margin-bottom:15px;">${benefit.note}</div>
                <div style="border-top:1px solid #eee; padding-top:10px;">
                    <div style="font-weight:600; margin-bottom:8px;">é©ç”¨é€šè·¯ï¼š</div>
                    ${listHtml}
                </div>
            `;
            document.getElementById('detailModal').classList.add('show');
        }

        function closeDetailModal() {
            document.getElementById('detailModal').classList.remove('show');
        }

        // === æœå°‹å¼•æ“ (æ ¸å¿ƒé‚è¼¯ï¼šå³æ™‚æƒææ¬Šç›Šè¡¨) ===
        function handleSearch(e) {
            const inputVal = document.getElementById('searchMerchant').value.trim().toLowerCase();
            const container = document.getElementById('merchantContainer');
            const clearBtn = document.getElementById('clearSearch');
            
            clearBtn.style.display = inputVal ? 'flex' : 'none';

            if (!inputVal) {
                container.innerHTML = '';
                return;
            }

            // 1. è™•ç†åˆ¥å
            let searchKey = inputVal;
            for (const [alias, realName] of Object.entries(aliasMap)) {
                if (inputVal.includes(alias)) {
                    searchKey = realName.toLowerCase(); // è½‰æ›ç‚ºæ­£è¦åç¨±é€²è¡Œæœå°‹
                    break;
                }
            }

            // 2. æƒææ‰€æœ‰å¡ç‰‡çš„æ¬Šç›Š
            let results = [];

            cardBenefitsData.forEach(card => {
                let bestBenefit = null;
                let maxRate = 0;

                card.benefits.forEach(benefit => {
                    // æª¢æŸ¥æ˜¯å¦åŒ¹é… (åç¨± æˆ– åˆ—è¡¨å…§å®¹)
                    let isMatch = false;
                    
                    // DAWHO å…¨é€šè·¯ç‰¹åˆ¤
                    if (card.id === 'dawho' && benefit.tag === 'all') isMatch = true;
                    
                    // æª¢æŸ¥åˆ—è¡¨
                    if (benefit.list) {
                        if (benefit.list.some(m => m.toLowerCase().includes(searchKey))) isMatch = true;
                    }
                    // æª¢æŸ¥æè¿°
                    if (benefit.desc.toLowerCase().includes(searchKey)) isMatch = true;

                    // å¦‚æœåŒ¹é…ï¼Œä¸”å›é¥‹ç‡æ›´é«˜ï¼Œå‰‡æ›´æ–°
                    if (isMatch) {
                        let currentRate = benefit.rate;
                        
                        // æ–°æˆ¶åŠ ç¢¼è¨ˆç®—
                        if (card.id === 'unicard' && benefit.name === 'UPé¸') {
                            const newUsersList = ['LINE Pay', 'Uber Eats', 'å®¶æ¨‚ç¦', 'éŸ“åœ‹', 'å…¨ç›ˆ+PAY'];
                            if (newUsersList.some(n => searchKey.includes(n.toLowerCase()) || benefit.list.some(l => l.toLowerCase().includes(searchKey) && n.toLowerCase().includes(l.toLowerCase())))) {
                                // ç°¡æ˜“åˆ¤æ–·ï¼šè‹¥æœå°‹è©åŒ…å«æ–°æˆ¶æŒ‡å®šé€šè·¯ï¼Œå‰‡+3%
                                if(newUsersList.some(n => searchKey.includes(n.toLowerCase()) || benefit.list.filter(item => item.toLowerCase().includes(searchKey)).some(x => newUsersList.includes(x)) )) {
                                     currentRate = 0.075; 
                                }
                            }
                        }
                        if (card.id === 'ubear' && benefit.tag === 'net') {
                             currentRate = 0.10; // æ–°æˆ¶ç¶²è³¼10%
                        }

                        if (currentRate > maxRate) {
                            maxRate = currentRate;
                            bestBenefit = { ...benefit, finalRate: currentRate };
                        }
                    }
                });

                if (bestBenefit) {
                    results.push({
                        cardName: card.name,
                        benefitName: bestBenefit.name,
                        rate: bestBenefit.finalRate,
                        note: bestBenefit.note,
                        tag: bestBenefit.tag
                    });
                }
            });

            // 3. æ’åºèˆ‡é¡¯ç¤º
            results.sort((a, b) => b.rate - a.rate);

            if (results.length === 0) {
                container.innerHTML = '<div style="text-align:center; padding:30px; color:#999;">æ‰¾ä¸åˆ°ç›¸é—œé€šè·¯ï¼Œè«‹å˜—è©¦å…¶ä»–é—œéµå­—</div>';
            } else {
                renderSearchResults(results);
            }
        }

        function renderSearchResults(results) {
            const container = document.getElementById('merchantContainer');
            
            // æ‰¾å‡ºæœ€é«˜å›é¥‹
            const bestRate = results[0].rate;
            
            const html = results.map((res, idx) => {
                const isBest = res.rate === bestRate;
                // è† å›Šé¡è‰²é‚è¼¯
                let badgeClass = 'scheme-badge';
                if (res.tag === 'crazy') badgeClass += ' crazy'; // ç˜‹å¤§æ¸¯ç´…è‰²
                if (res.rate >= 0.07) badgeClass += ' new-user'; // æ–°æˆ¶/é«˜å›é¥‹æ©˜è‰²

                return `
                    <div class="merchant-list">
                        <div class="card-row">
                            <div class="card-info">
                                <span style="font-weight:700; font-size:1.05em;">${res.cardName}</span>
                                <span class="${badgeClass}">${res.benefitName}</span>
                            </div>
                            <div class="card-rate ${isBest ? 'high' : ''}">${(res.rate * 100).toFixed(1)}%</div>
                        </div>
                        <div style="font-size:0.85em; color:#666; margin-top:6px;">
                            ${res.note}
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
        }

        function clearSearch() {
            document.getElementById('searchMerchant').value = '';
            document.getElementById('merchantContainer').innerHTML = '';
            document.getElementById('clearSearch').style.display = 'none';
        }

        function quickSearch(term) {
            const input = document.getElementById('searchMerchant');
            input.value = term;
            handleSearch();
        }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
