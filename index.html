<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¿¡ç”¨å¡å›é¥‹æŸ¥è©¢åŠ©æ‰‹ 2026</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --color-primary: #2180a0;
            --color-bg: #f5f5f5;
            --color-surface: #ffffff;
            --color-text: #333333;
            --color-border: #e0e0e0;
            --color-success: #2e7d32;
            
            /* === å“ç‰Œè‰²å®šç¾© === */
            --brand-richart: #e01a22; /* å°æ–°ç´… */
            --brand-cube: #00AA4F;    /* åœ‹æ³°ç¶  */
            --brand-unicard: #1890ff; /* ç‰å±±è— */
            --brand-ubear: #e6b800;   /* ç‰å±±é»ƒ */
            --brand-dawho: #2d3436;   /* æ°¸è±é»‘ */
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            padding: 20px;
            line-height: 1.6;
            padding-bottom: 90px;
            -webkit-tap-highlight-color: transparent;
        }
        
        .container { max-width: 800px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 15px; color: var(--color-primary); font-size: 1.6em; }

        /* === å°è¦½åˆ— === */
        .nav-tabs {
            display: flex; background: var(--color-surface); padding: 5px;
            border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 20px; position: sticky; top: 10px; z-index: 900;
            transition: all 0.3s;
        }
        .nav-item {
            flex: 1; text-align: center; padding: 12px; cursor: pointer;
            border-radius: 8px; font-weight: 600; color: #888; transition: all 0.2s;
            display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px;
        }
        .nav-icon { font-size: 1.2em; margin-bottom: 2px; display: none; }
        .nav-item.active { background-color: var(--color-primary); color: white; box-shadow: 0 2px 4px rgba(33, 128, 160, 0.3); }

        @media (max-width: 768px) {
            .nav-tabs {
                position: fixed; bottom: 0; top: auto; left: 0; right: 0;
                margin-bottom: 0; border-radius: 0; padding: 8px 5px 20px 5px;
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(10px);
                border-top: 1px solid #eee;
                box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            }
            .nav-item { background: transparent !important; color: #999; padding: 4px; font-size: 0.75rem; }
            .nav-item.active { color: var(--color-primary); box-shadow: none; }
            .nav-icon { display: block; font-size: 1.4rem; }
            .nav-text { margin-top: 2px; }
            h1 { margin-top: 10px; font-size: 1.4em; }
            body { padding-top: 10px; }
        }

        .tab-content { display: none; animation: fadeIn 0.3s ease-out; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* === å€å¡Šæ¨£å¼ === */
        .form-section {
            background: var(--color-surface); padding: 20px;
            border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .info-text {
            background: #e3f2fd; padding: 12px; border-radius: 8px; color: #0d47a1;
            margin-bottom: 15px; font-size: 0.9em; line-height: 1.5; border-left: 4px solid #2196f3;
        }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 6px; font-weight: 600; color: var(--color-text); font-size: 0.95em; }
        .input-wrapper { position: relative; display: flex; align-items: center; }
        input[type="text"], input[type="number"], select {
            width: 100%; padding: 12px 40px 12px 14px; border: 1px solid var(--color-border);
            border-radius: 8px; font-size: 16px; background: #fff; appearance: none;
        }
        input:focus, select:focus { outline: none; border-color: var(--color-primary); box-shadow: 0 0 0 3px rgba(33, 128, 160, 0.1); }
        
        .clear-btn {
            position: absolute; right: 5px; background: #eee; border: none; border-radius: 50%;
            width: 30px; height: 30px; cursor: pointer; color: #666; display: none; align-items: center; justify-content: center;
            font-size: 14px;
        }
        
        .suggestion-dropdown {
            position: absolute; top: 100%; left: 0; right: 0; background: var(--color-surface);
            border: 1px solid var(--color-border); border-radius: 0 0 8px 8px;
            max-height: 250px; overflow-y: auto; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: none;
        }
        .suggestion-item { padding: 12px 16px; cursor: pointer; border-bottom: 1px solid #f0f0f0; }
        .suggestion-item:hover { background-color: #f5f9ff; }

        .controls-row { display: flex; gap: 10px; margin-bottom: 15px; align-items: center; }
        .control-group { flex: 1; }
        .toggle-btn {
            display: flex; align-items: center; justify-content: center; padding: 10px;
            background: #fff; border: 1px solid var(--color-border); border-radius: 8px;
            cursor: pointer; user-select: none; font-size: 0.9em; height: 46px; white-space: nowrap; transition: all 0.2s;
        }
        .toggle-btn.active { background: #e3f2fd; border-color: var(--color-primary); color: var(--color-primary); font-weight: 700; transform: scale(1.02); }
        .toggle-checkbox { margin-right: 6px; width: 16px; height: 16px; pointer-events: none; }

        /* === æœå°‹çµæœåˆ—è¡¨ === */
        .merchant-list {
            background: var(--color-surface); padding: 16px; border-radius: 12px; margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: transform 0.2s; cursor: pointer;
            border: 1px solid transparent; display: flex; justify-content: space-between; align-items: center;
            border-left: 5px solid #ccc;
        }
        .merchant-list:hover { transform: translateY(-3px); box-shadow: 0 6px 15px rgba(0,0,0,0.1); }
        
        /* å“ç‰Œè‰² Class */
        .card-theme-richart { border-left-color: var(--brand-richart) !important; }
        .card-theme-cube { border-left-color: var(--brand-cube) !important; }
        .card-theme-unicard { border-left-color: var(--brand-unicard) !important; }
        .card-theme-ubear { border-left-color: var(--brand-ubear) !important; }
        .card-theme-dawho { border-left-color: var(--brand-dawho) !important; }

        .merchant-name { font-size: 1.1em; font-weight: 700; color: var(--color-text); }
        .merchant-type { font-size: 0.85em; color: #888; background: #eee; padding: 2px 8px; border-radius: 10px; margin-left: 8px; }
        .merchant-best-info { text-align: right; }
        
        .best-rate { color: var(--color-primary); font-weight: 800; font-size: 1.4em; }
        
        .best-card-name { font-size: 0.85em; color: #666; display: flex; align-items: center; justify-content: flex-end; gap: 4px; flex-wrap: wrap; }
        
        /* åœ–ç¤ºï¼š12px åœ“å½¢é» */
        .card-icon-shape { 
            width: 12px; height: 12px; border-radius: 50%;
            display: inline-block; vertical-align: middle; margin-right: 6px;
        }
        
        /* === æ–¹æ¡ˆæ¨™ç±¤æ¨£å¼ (æ·ºè—è‰²é¢¨æ ¼) === */
        .scheme-badge {
            display: inline-block; 
            background-color: #e3f2fd; /* æ·ºè—åº• */
            color: var(--color-primary); /* æ·±è—å­— */
            border: 1px solid #b3e5fc; /* è—é‚Šæ¡† */
            padding: 3px 10px; border-radius: 12px; font-size: 0.85em; font-weight: 700;
        }
        .list-badge {
            padding: 1px 8px; border-radius: 10px; font-size: 0.8em; margin-left: 6px; vertical-align: middle;
        }
        
        /* æ–°æˆ¶å›é¥‹ç¶­æŒæ©˜è‰² */
        .scheme-badge.new-user { background-color: #fff3e0; color: #e65100; border-color: #ffe0b2; }
        
        /* === Accordion (æ¬Šç›Šç¸½è¦½) === */
        .card-accordion-item {
            background: var(--color-surface); border-radius: 12px; margin-bottom: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05); overflow: hidden; border: 1px solid var(--color-border);
            border-left: 5px solid #ccc;
        }
        .accordion-header {
            padding: 16px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;
            background: white; transition: background 0.2s;
        }
        .card-title-row { display: flex; align-items: center; }
        .card-title-text { font-weight: 700; font-size: 1.1em; color: var(--color-text); }
        .chevron { transition: transform 0.3s; color: #999; }
        .accordion-header.active .chevron { transform: rotate(180deg); }
        .accordion-body { display: none; padding: 0; background: #fff; border-top: 1px solid #eee; }
        .accordion-body.open { display: block; animation: slideDown 0.3s ease-out; }
        @keyframes slideDown { from { opacity: 0; max-height: 0; } to { opacity: 1; max-height: 3000px; } }
        
        .benefit-row { padding: 12px 20px; border-bottom: 1px solid #f0f0f0; display: flex; flex-direction: column; position: relative; }
        .benefit-row:not(.no-action):hover { background-color: #f8fbff; cursor: pointer; }
        .benefit-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px; padding-right: 20px; }
        .benefit-name { font-weight: 600; font-size: 1em; color: #444; }
        .benefit-rate { font-weight: 700; color: var(--color-primary); font-size: 1.1em; }
        .benefit-desc { font-size: 0.85em; color: #666; margin-top: 2px; padding-right: 20px; }

        /* === å½ˆçª— (æ‰‹æ©Ÿç‰ˆå„ªåŒ–) === */
        .detail-modal {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6); z-index: 2000; justify-content: center; padding: 20px;
            backdrop-filter: blur(4px); 
        }
        .detail-modal.show { display: flex; align-items: center; }
        .detail-content {
            background: var(--color-surface); border-radius: 16px; width: 100%; max-width: 500px;
            display: flex; flex-direction: column; box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            max-height: 85vh; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

        .detail-header { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .detail-title h2 { font-size: 1.4em; color: var(--color-primary); margin: 0; }
        .detail-close { background: #f0f0f0; border: none; width: 32px; height: 32px; border-radius: 50%; font-size: 20px; cursor: pointer; color: #666; }
        .detail-body { padding: 20px; overflow-y: auto; }

        .detail-category-group { margin-bottom: 20px; }
        .detail-category-title { 
            font-size: 0.95em; font-weight: 700; color: var(--color-text); margin-bottom: 10px; 
            padding-left: 8px; border-left: 4px solid var(--color-primary);
        }
        .scheme-list-container { display: flex; flex-wrap: wrap; gap: 8px; }
        .scheme-list-item { 
            background: var(--tag-bg); padding: 6px 12px; border-radius: 20px; 
            font-size: 0.9em; color: var(--tag-text); border: 1px solid #e0e0e0; display: inline-block;
        }

        /* å½ˆçª—åˆ—è¡¨æ¨£å¼ (UIä¿®æ­£) */
        .detail-card-item { margin-bottom: 12px; border: 1px solid #eee; border-radius: 12px; overflow: hidden; border-left: 4px solid #ccc; }
        .detail-card-item.best-card { background-color: #fafffc; }
        
        .detail-card-header { 
            padding: 10px 15px; background: #f9f9f9; 
            font-weight: 600; display: flex; justify-content: space-between; align-items: center;
            font-size: 0.95em;
        }
        .detail-card-body { padding: 12px 15px; font-size: 0.9em; }
        .detail-card-body .scheme-badge { font-size: 0.8em; padding: 2px 8px; }

        .plan-warning { color: var(--color-danger); font-weight: 600; font-size: 0.85em; margin-top: 6px; display: flex; align-items: center; padding-top: 6px; border-top: 1px dashed rgba(0,0,0,0.1); }
        .plan-warning::before { content: 'âš ï¸'; margin-right: 4px; }

        .category-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        .category-tag {
            padding: 6px 14px; background: var(--color-surface);
            border: 1px solid var(--color-border); border-radius: 20px;
            cursor: pointer; font-size: 0.9em; color: var(--color-text); font-weight: 500;
            transition: all 0.2s; user-select: none;
        }
        .category-tag:hover { border-color: var(--color-primary); color: var(--color-primary); background: #e3f2fd; }
        .category-tag.active { background: var(--color-primary); color: white; border-color: var(--color-primary); }

        /* === è©¦ç®—çµæœæ¨£å¼ === */
        .calc-result-item { 
            margin-bottom: 12px; padding: 15px; background: white; 
            border: 1px solid #eee; border-radius: 12px; border-left: 5px solid #ccc;
            transition: transform 0.2s;
        }
        .calc-result-item.winner { 
            background: #ffffff; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .calc-header { 
            display: flex; justify-content: space-between; align-items: flex-start;
            margin-bottom: 6px; 
        }
        
        .calc-money { 
            font-size: 1.5em; font-weight: 800; color: #333; 
            white-space: nowrap; flex-shrink: 0; margin-left: 10px; text-align: right; 
        }
        
        .calc-result-item.winner.card-theme-richart .calc-money { color: var(--brand-richart); }
        .calc-result-item.winner.card-theme-cube .calc-money { color: var(--brand-cube); }
        .calc-result-item.winner.card-theme-unicard .calc-money { color: var(--brand-unicard); }
        .calc-result-item.winner.card-theme-ubear .calc-money { color: #b8860b; } 
        .calc-result-item.winner.card-theme-dawho .calc-money { color: var(--brand-dawho); }

        .calc-detail { font-size: 0.85em; color: #666; background: rgba(0,0,0,0.03); padding: 8px; border-radius: 6px; margin-top: 8px; font-family: monospace; }
        
        /* æ‹†å–®å»ºè­°æ¨£å¼ */
        .split-recommendation {
            margin-top: 12px; padding: 10px;
            background-color: #f1f8e9; border: 1px dashed #aed581; border-radius: 8px;
            color: #33691e; font-size: 0.9em;
        }
        .split-title { font-weight: 700; margin-bottom: 6px; display: flex; align-items: center; }
        .split-step { margin-left: 14px; margin-bottom: 4px; position: relative; }
        .split-step::before { content: 'â€¢'; position: absolute; left: -12px; color: #689f38; }
        .split-total { margin-top: 6px; font-weight: 700; border-top: 1px dotted #c5e1a5; padding-top: 4px; }

        .action-btn { width:100%; padding:14px; background:var(--color-primary); color:white; border:none; border-radius:12px; font-weight:700; margin-top:10px; font-size:1.1em; box-shadow: 0 4px 10px rgba(33, 128, 160, 0.3); transition: transform 0.1s; }
        .action-btn:active { transform: scale(0.98); }

    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ’³ ä¿¡ç”¨å¡å›é¥‹æŸ¥è©¢ 2026</h1>

        <div class="nav-tabs">
            <div class="nav-item active" onclick="switchTab('search')">
                <span class="nav-icon">ğŸ”</span><span class="nav-text">é€šè·¯æœå°‹</span>
            </div>
            <div class="nav-item" onclick="switchTab('overview')">
                <span class="nav-icon">ğŸ“‹</span><span class="nav-text">æ¬Šç›Šç¸½è¦½</span>
            </div>
            <div class="nav-item" onclick="switchTab('calculator')">
                <span class="nav-icon">ğŸ’°</span><span class="nav-text">å›é¥‹è©¦ç®—</span>
            </div>
        </div>

        <div id="tab-search" class="tab-content active">
            <div class="form-section">
                <div class="info-text">
                    âœ¨ <strong>2026 æ–°æˆ¶åŠ ç¢¼</strong>ï¼šUnicard æœ€é«˜ 7.5%ã€UBear ç¶²è³¼ 10%ã€‚
                </div>
                
                <div class="form-group">
                    <div class="input-wrapper">
                        <input type="text" id="searchMerchant" placeholder="è¼¸å…¥å•†å®¶ (å¦‚ï¼šå…¨å®¶ã€é«˜éµ)..." autocomplete="off">
                        <button id="clearSearchBtn" class="clear-btn" onclick="clearSearch('searchMerchant', 'clearSearchBtn', true)">âœ•</button>
                        <div id="suggestionDropdown" class="suggestion-dropdown"></div>
                    </div>
                </div>

                <div class="controls-row">
                    <div class="control-group">
                        <select id="searchUnicardScheme" onchange="debouncedReSearch()">
                            <option value="any" selected>Unicard: ä»»æ„é¸ (3.5%)</option>
                            <option value="simple">Unicard: ç°¡å–®é¸ (3.0%)</option>
                            <option value="up">Unicard: UPé¸ (4.5%)</option>
                        </select>
                    </div>
                    <div class="toggle-btn" id="searchNewUserBtn" onclick="toggleSearchNewUser()">
                        <input type="checkbox" id="searchNewUser" class="toggle-checkbox" readonly>
                        <span>æˆ‘æ˜¯æ–°æˆ¶</span>
                    </div>
                </div>
                
                <div style="margin-top: 10px;">
                    <div class="category-tags" id="quickCategoryTags"></div>
                </div>
            </div>

            <div id="merchantResults" class="results-section">
                <div id="merchantContainer"></div>
            </div>
        </div>

        <div id="tab-overview" class="tab-content">
            <div id="cardOverviewContainer"></div>
        </div>

        <div id="tab-calculator" class="tab-content">
            <div class="form-section">
                <div class="form-group">
                    <label>æ¶ˆè²»é‡‘é¡</label>
                    <div class="input-wrapper">
                        <input type="number" id="calcAmount" placeholder="è¼¸å…¥é‡‘é¡ (å¦‚ï¼š20000)" inputmode="numeric">
                    </div>
                </div>
                <div class="form-group">
                    <label>æ¶ˆè²»é€šè·¯</label>
                    <div class="input-wrapper">
                        <input type="text" id="calcMerchant" placeholder="è¼¸å…¥é€šè·¯ (å¦‚ï¼šè¦çš®è³¼ç‰©)" autocomplete="off">
                        <button id="clearCalcBtn" class="clear-btn" onclick="clearSearch('calcMerchant', 'clearCalcBtn', false)">âœ•</button>
                        <div id="calcSuggestionDropdown" class="suggestion-dropdown"></div>
                    </div>
                </div>
                <div class="controls-row">
                    <div class="control-group">
                        <select id="calcUnicardScheme">
                            <option value="any" selected>Unicard: ä»»æ„é¸ (3.5%)</option>
                            <option value="simple">Unicard: ç°¡å–®é¸ (3.0%)</option>
                            <option value="up">Unicard: UPé¸ (4.5%)</option>
                        </select>
                    </div>
                    <div class="toggle-btn" id="calcNewUserBtn" onclick="toggleCalcNewUser()">
                        <input type="checkbox" id="calcNewUser" class="toggle-checkbox" readonly>
                        <span>æˆ‘æ˜¯æ–°æˆ¶</span>
                    </div>
                </div>
                <button onclick="calculateRewards()" class="action-btn">é–‹å§‹è©¦ç®—</button>
            </div>
            <div id="calcResults"></div>
        </div>

    </div>

    <div id="detailModal" class="detail-modal" onclick="if(event.target === this) closeDetailModal()">
        <div class="detail-content">
            <div class="detail-header">
                <div class="detail-title">
                    <h2 id="modalTitle">æ–¹æ¡ˆè©³æƒ…</h2>
                </div>
                <button class="detail-close" onclick="closeDetailModal()">âœ•</button>
            </div>
            <div id="detailBody" class="detail-body"></div>
        </div>
    </div>

    <script>
        const formatMoney = (num) => '$' + num.toLocaleString();
        const formatRate = (num) => {
            let fixed = parseFloat(num).toFixed(1);
            return fixed.endsWith('.0') ? fixed.slice(0, -2) : fixed;
        };
        
        const debounce = (func, delay = 300) => {
            let timer;
            return (...args) => {
                clearTimeout(timer);
                timer = setTimeout(() => func(...args), delay);
            };
        };

        const brandColorMap = {
            'richart': { class: 'card-theme-richart', color: '#e01a22' },
            'cube': { class: 'card-theme-cube', color: '#00AA4F' },
            'unicard': { class: 'card-theme-unicard', color: '#1890ff' },
            'ubear': { class: 'card-theme-ubear', color: '#e6b800' },
            'dawho': { class: 'card-theme-dawho', color: '#2d3436' }
        };

        const cardBenefitsData = [
            {
                id: 'richart', name: 'å°æ–° Richart', note: 'éœ€æ¯æ—¥ App åˆ‡æ›æ¬Šç›Š (ä¸€èˆ¬æ¶ˆç„¡ä¸Šé™/æ¬Šç›Šä¸Šé™æœ¬èº«é¡åº¦+30è¬)',
                benefits: [
                    { name: 'ä¸€èˆ¬æ¶ˆè²»', rate: 0.003, desc: 'åœ‹å…§å¤–ä¸€èˆ¬æ¶ˆè²»', type: 'text', note: '0.3%', categories: {}, cap: Infinity },
                    { name: 'Payè‘—åˆ·', rate: 0.038, desc: 'ç¶å®šå°æ–°Pay', note: '3.8%', tag: 'pay', categories: { 'å°æ–°Pay':['7-11', 'å…¨å®¶ä¾¿åˆ©å•†åº—', 'æ–°å…‰ä¸‰è¶Š', 'Richart Mart', 'åº·æ˜¯ç¾', 'IKEA', 'NET'], 'å°ç£Pay':['ç¥è…¦', 'ç‡¦å¤', 'å…¨åœ‹é›»å­', 'éº¥ç•¶å‹', 'ç¾å»‰ç¤¾', 'å¤§æ¨¹è—¥å±€', 'æä¸€é†«ç™‚'], 'äº¤é€š':['å°ç£å¤§è»ŠéšŠ'] }, cap: Infinity },
                    { name: 'LINE Pay', rate: 0.023, desc: 'LINE Pay ç¶å®šæ”¯ä»˜', note: '2.3%', tag: 'line', categories: { 'è¡Œå‹•æ”¯ä»˜':['LINE Pay'] }, cap: Infinity },
                    { name: 'å‡æ—¥åˆ·', rate: 0.02, desc: 'åœ‹å…§ç¯€å‡æ—¥æ¶ˆè²»', note: '2%', tag: 'holiday', type: 'text', categories: {}, cap: Infinity },
                    { name: 'æ•¸è¶£åˆ·', rate: 0.033, desc: 'ç¶²è³¼ | éŠæˆ² | AIæœå‹™', note: '3.3%', tag: 'digital', categories: { 'ç¶²è³¼å¹³å°':['è¦çš®è³¼ç‰©', 'momoè³¼ç‰©ç¶²', 'é…·æ¾(Coupang)', 'PChome', 'æ·˜å¯¶', 'Amazon', 'æ±æ£®', 'åšå®¢ä¾†', 'Richart Mart', 'PayEasy', 'iHerb', 'SHEIN', 'Farfetch', 'Olive Young'], 'ç·šä¸Šèª²ç¨‹':['çŸ¥è­˜è¡›æ˜Ÿ', 'Amazing Talker', 'Tutor ABC', 'Hahow', 'PressPlay'], 'éŠæˆ²å½±éŸ³':['MyCard', 'éŠæˆ²æ©˜å­', 'Steam', 'PlayStation', 'Nintendo', 'Netfilx', 'Disney+'], 'AIæœå‹™':['ChatGPT', 'Notion', 'Canva', 'Perplexity', 'Claude'] }, cap: Infinity },
                    { name: 'ç©æ—…åˆ·', rate: 0.033, desc: 'æµ·å¤– | èˆªç©º | è¨‚æˆ¿ | æ—…è¡Œç¤¾', note: '3.3%', tag: 'travel', categories: { 'æµ·å¤–æ¶ˆè²»':['æµ·å¤–æ¶ˆè²»(å«å¯¦é«”)'], 'è¨‚æˆ¿å¹³å°':['Klook', 'KKday', 'Agoda', 'Booking.com', 'Trip.com', 'Airbnb', 'Hotels.com', 'Expedia'], 'æµ·å¤–äº¤é€š':['Uber', 'Grab', 'SUICA', 'ICOCA', 'PASMO', 'WOWPASS', 'AIRSIM'], 'æ—…è¡Œç¤¾':['é›„ç…æ—…éŠ', 'æ˜“éŠç¶²', 'æ±å—æ—…éŠ', 'å¯æ¨‚æ—…éŠ', 'é•·æ±å‡æœŸ', 'äº”ç¦æ—…éŠ', 'å–œé´»å‡æœŸ', 'æ˜“é£›æ—…éŠ', 'ç‡¦æ˜Ÿæ—…éŠ', 'åŠ åˆ©åˆ©æ—…è¡Œç¤¾', 'é³³å‡°åœ‹éš›æ—…è¡Œç¤¾', 'å±±å¯Œæ—…éŠ', 'è¡Œå¥æ—…éŠ'], 'èˆªç©ºå…¬å¸':['ä¸­è¯èˆªç©º', 'é•·æ¦®èˆªç©º', 'æ˜Ÿå®‡èˆªç©º', 'å°ç£è™èˆª', 'åœ‹æ³°èˆªç©º', 'è¯ä¿¡èˆªç©º', 'ç«‹æ¦®èˆªç©º', 'æ¨‚æ¡ƒèˆªç©º', 'é˜¿è¯é…‹èˆªç©º', 'äºæ´²èˆªç©º', 'é…·èˆª', 'æ·æ˜Ÿèˆªç©º', 'æ–°åŠ å¡èˆªç©º', 'æ—¥æœ¬èˆªç©º', 'è¶Šæ·èˆªç©º'] }, cap: Infinity },
                    { name: 'å¤©å¤©åˆ·', rate: 0.033, desc: 'è¶…å•†é‡è²© | äº¤é€š | åœè»Š', note: '3.3%', tag: 'daily', categories: { 'è¶…å•†é‡è²©(å°æ–°Pay)':['7-11', 'å…¨å®¶', 'å®¶æ¨‚ç¦', 'å¤§è²·å®¶', 'å”å‰è»»å¾·', 'LOPIA'], 'é€šå‹¤äº¤é€š':['å°ç£éµè·¯', 'å°ç£é«˜éµ', 'å°ç£å¤§è»ŠéšŠ', 'Yoxi', 'Uber'], 'åœè»Šç§Ÿè»Š':['å˜Ÿå˜Ÿæˆ¿', 'è»Šéº»å‰', 'åŸå¸‚è»Šæ—…', 'ViViPark', 'USPACE', 'UDRIVE', 'iRent', 'å’Œé‹ç§Ÿè»Š', 'æ ¼ä¸Šç§Ÿè»Š'], 'è—¥å¦è—¥å±€':['å¯¶é›…', 'åº·æ˜¯ç¾', 'å±ˆè‡£æ°', 'æä¸€é†«ç™‚', 'å¤§æ¨¹è—¥å±€', 'ä¸ä¸è—¥å±€', 'ä½‘å…¨ä¿å¥', 'å¥åº·äººç”Ÿ'] }, cap: Infinity },
                    { name: 'å¤§ç­†åˆ·', rate: 0.033, desc: 'ç™¾è²¨ | Outlet | å±…å®¶', note: '3.3%', tag: 'big', categories: { 'æŒ‡å®šç™¾è²¨':['æ–°å…‰ä¸‰è¶Š', 'é æ±ç™¾è²¨', 'é æ±SOGO', 'æ¼¢ç¥å·¨è›‹', 'æ¼¢ç¥ç™¾è²¨', 'å¾®é¢¨', 'å°åŒ—101', 'é æ±å·¨åŸ', 'å»£ä¸‰SOGO', 'å—ç´¡è³¼ç‰©ä¸­å¿ƒ', 'èª å“ç”Ÿæ´»', 'äº¬ç«™', 'ä¸‰å‰µç”Ÿæ´»', 'å¤¢æ™‚ä»£', 'çµ±ä¸€æ™‚ä»£', 'ä¸­å‹ç™¾è²¨', 'LaLaport'], 'æŒ‡å®šOutlet':['MITSUI OUTLET PARK', 'è¯æ³°åå“åŸ', 'SKM Park Outlets'], 'å±…å®¶è£ä¿®':['IKEA', 'ç‰¹åŠ›å±‹', 'HOLA', 'å®œå¾—åˆ©', 'ç‘ªé»‘å®¶å±…'], 'æ™‚å°šå“å‘³':['UNIQLO', 'GU', 'ZARA', 'NET', 'lululemon'] }, cap: Infinity },
                    { name: 'å¥½é¥—åˆ·', rate: 0.033, desc: 'é¤é£² | å¤–é€ | åŠ æ²¹', note: '3.3%', tag: 'fun', categories: { 'é¤é£²å¤–é€':['åœ‹å…§é¤é£²', 'ç‹å“ç˜‹Pay', 'Uber Eats', 'Foodpanda'], 'åŠ æ²¹å……é›»':['å°ç£ä¸­æ²¹-ç›´ç‡Ÿç«™', 'å°äºç›´ç‡Ÿ', 'å…¨åœ‹åŠ æ²¹', 'EVOASIS', 'EVALUE'], 'å±•æ¼”è³¼ç¥¨':['æ‹“å…ƒå”®ç¥¨', 'KKTIX', 'å¹´ä»£å”®ç¥¨', 'å¯¬å®å”®ç¥¨', 'OPENTIX', 'FunNow'], 'æŒ‡å®šKTV':['éŒ¢æ«ƒ', 'å¥½æ¨‚è¿ª', 'ONCOR', 'sing!go', 'äº«æº«é¦¨'], 'æŒ‡å®šæ¨‚åœ’':['ç¾©å¤§éŠæ¨‚ä¸–ç•Œ', 'éº—å¯¶æ¨‚åœ’', 'å…­ç¦æ‘', 'ä¹æ—æ–‡åŒ–æ‘', 'åŠæ¹–å±±', 'X-Park', 'åœ‹ç«‹æµ·æ´‹ç”Ÿç‰©åšç‰©é¤¨', 'é é›„æµ·æ´‹å…¬åœ’', 'å°äººåœ‹'], 'æŒ‡å®šé£¯åº—':['æ™¶è¯', 'é›²æœ—', 'è¬è±ª', 'ç…™æ³¢', 'è€çˆº', 'ç¦è¯', 'æ¼¢ä¾†', 'å›æ‚…', 'æ´²éš›', 'å¯’æ²'] }, cap: Infinity }
                ]
            },
            {
                id: 'cube', name: 'åœ‹æ³° CUBE', note: 'éœ€æ¯æ—¥ App åˆ‡æ›æ–¹æ¡ˆ (ä¸€èˆ¬æ¶ˆè²»/æ¬Šç›Šç„¡ä¸Šé™)',
                benefits: [
                    { name: 'ä¸€èˆ¬æ¶ˆè²»', rate: 0.003, desc: 'ä¸€èˆ¬æ¶ˆè²» (ç„¡ä¸Šé™)', type: 'text', note: '0.3%', categories: {}, cap: Infinity },
                    { name: 'ç˜‹å¤§æ¸¯', rate: 0.035, desc: 'é«˜é›„ä½å®¿ | Klook | é«˜éµå°éµ', note: '3.5%', tag: 'crazy', categories: { 'æŒ‡å®šé«˜é›„ä½å®¿':['åŸå¸‚å•†æ—…', 'å’Œé€¸é£¯åº—', 'æ—…å±…æ–‡æ—…', 'ç§èŠ¯æ—…åº—', 'å¤å„ªæ—…å±…', 'è¯åœ’å¤§é£¯åº—', 'æ·çµ²æ—…', 'éº—å°Šé…’åº—', 'å¸•å¯éº—é…’åº—', 'éˆæ€¡å¤§é£¯åº—'], 'æ—…éŠå¹³å°':['Klook'], 'æŒ‡å®šäº¤é€š':['å°ç£é«˜éµ', 'å°ç£éµè·¯å±€'] }, cap: Infinity },
                    { name: 'ç©æ•¸ä½', rate: 0.03, desc: 'ç¶²è³¼ | å½±éŸ³ | AI', note: '3%', tag: 'digital', categories: { 'AIå·¥å…·':['ChatGPT', 'Canva', 'Claude', 'Cursor', 'Duolingo', 'Gamma', 'Gemini', 'Notion', 'Perplexity', 'Speak'], 'åœ‹éš›é›»å•†':['æ·˜å¯¶', 'å¤©è²“', 'Coupang é…·æ¾'], 'ç¶²è³¼å¹³å°':['è¦çš®è³¼ç‰©', 'momoè³¼ç‰©ç¶²', 'PChome 24hè³¼ç‰©', 'å°æ¨¹è³¼'], 'æ•¸ä½ä¸²æµ':['Apple åª’é«”æœå‹™', 'Google Play', 'Disney+', 'Netflix', 'Spotify', 'YouTube Premium', 'Max'] }, cap: Infinity },
                    { name: 'æ¨‚éŸ¿è³¼', rate: 0.03, desc: 'ç™¾è²¨ | é¤é£² | å¤–é€ | è—¥å¦', note: '3%', tag: 'fun', categories: { 'åœ‹å…§ç™¾è²¨':['é æ±SOGO', 'é æ±Garden City', 'æ–°å…‰ä¸‰è¶Š', 'é æ±ç™¾è²¨', 'å°åŒ—101', 'BELLAVITA', 'å¾®é¢¨å»£å ´', 'çµ±ä¸€æ™‚ä»£', 'èª å“ç”Ÿæ´»', 'ATT 4 FUN', 'äº¬ç«™', 'ç¾éº—è¯', 'NOKEå¿ æ³°æ¨‚ç”Ÿæ´»', 'å¤§è‘‰é«˜å³¶å±‹', 'Mitsui Shopping Park LaLaport', 'å®åŒ¯å»£å ´', 'å°èŒ‚', 'å¤§æ±Ÿ', 'Big City', 'ä¸­å‹', 'å»£ä¸‰SOGO', 'å—ç´¡', 'è€æ–¯å»£å ´', 'å¤¢æ™‚ä»£', 'æ¼¢ç¥ç™¾è²¨', 'æ¼¢ç¥å·¨è›‹', 'æ–°æœˆå»£å ´', 'CITYLINK', 'ç§€æ³°ç”Ÿæ´»', 'ç’°çƒè³¼ç‰©ä¸­å¿ƒ', 'å¤ªå¹³æ´‹ç™¾è²¨', 'è¯æ³°åå“åŸ', 'SKM Park', 'MITSUI OUTLET PARK'], 'åœ‹å…§é¤é£²':['åœ‹å…§é¤é£²', 'éº¥ç•¶å‹'], 'å¤–é€å¹³å°':['Uber Eats', 'foodpanda'], 'åœ‹å…§è—¥å¦':['å±ˆè‡£æ°', 'åº·æ˜¯ç¾'] }, cap: Infinity },
                    { name: 'è¶£æ—…è¡Œ', rate: 0.03, desc: 'æµ·å¤– | è¨‚æˆ¿ | èˆªç©º | äº¤é€š', note: '3%', tag: 'travel', categories: { 'æµ·å¤–æ¶ˆè²»':['æµ·å¤–å¯¦é«”æ¶ˆè²»'], 'æµ·å¤–äº¤é€š':['SUICA', 'PASMO', 'ICOCA', 'Uber', 'Grab'], 'æŒ‡å®šæ¨‚åœ’':['æ±äº¬è¿ªå£«å°¼', 'å“ˆåˆ©æ³¢ç‰¹å½±åŸ', 'å¤§é˜ªç’°çƒå½±åŸ'], 'æ—…éŠè¨‚æˆ¿':['Klook', 'KKday', 'Agoda', 'Airbnb', 'Booking.com', 'Trip.com'], 'åœ‹å…§æ—…è¡Œç¤¾':['é›„ç…', 'æ˜“éŠç¶²', 'å¯æ¨‚', 'æ±å—', 'äº”ç¦', 'ç‡¦æ˜Ÿ', 'å±±å¯Œ', 'é•·æ±å‡æœŸ', 'é³³å‡°', 'æ˜“é£›ç¶²', 'ç†æƒ³æ—…éŠ', 'æ°¸åˆ©', 'ä¸‰è³€'], 'åœ‹å…§äº¤é€š':['å°ç£é«˜éµ', 'å°ç£å¤§è»ŠéšŠ', 'yoxi', 'iRent', 'å’Œé‹ç§Ÿè»Š', 'æ ¼ä¸Šç§Ÿè»Š', 'Uber'], 'æŒ‡å®šèˆªç©º':['ä¸­è¯èˆªç©º', 'é•·æ¦®èˆªç©º', 'æ˜Ÿå®‡èˆªç©º', 'å°ç£è™èˆª', 'åœ‹æ³°èˆªç©º', 'æ¨‚æ¡ƒèˆªç©º', 'é˜¿è¯é…‹èˆªç©º', 'é…·èˆª', 'æ·æ˜Ÿèˆªç©º', 'æ—¥æœ¬èˆªç©º', 'äºæ´²èˆªç©º', 'è¯åˆèˆªç©º', 'æ–°åŠ å¡èˆªç©º', 'ANAå…¨æ—¥ç©º', 'è¶Šæ·èˆªç©º', 'å¤§éŸ“èˆªç©º', 'é”ç¾èˆªç©º', 'åœŸè€³å…¶èˆªç©º', 'æ³•åœ‹èˆªç©º', 'å¡é”èˆªç©º'], 'æŒ‡å®šä½å®¿':['åœ‹å…§é£¯åº—', 'æ˜Ÿé‡é›†åœ˜', 'å…¨çƒè¿ªå£«å°¼é£¯åº—', 'æ±æ©«INN'] }, cap: Infinity },
                    { name: 'é›†ç²¾é¸', rate: 0.02, desc: 'è¶…å•† | é‡è²© | åŠ æ²¹ | IKEA', note: '2%', tag: 'base', categories: { 'å……é›»åœè»Š':['U-POWER', 'EVOASIS', 'EVALUE', 'TAIL', 'iCharging', 'è»Šéº»å‰', 'uTagGo'], 'ç”Ÿæ´»å±…å®¶':['IKEA'], 'é‡è²©è¶…å¸‚':['å®¶æ¨‚ç¦', 'å…¨è¯ç¦åˆ©ä¸­å¿ƒ', 'LOPIAå°ç£'], 'æŒ‡å®šåŠ æ²¹':['å°ç£ä¸­æ²¹-ç›´ç‡Ÿç«™'], 'æŒ‡å®šè¶…å•†':['7-ELEVEN', 'å…¨å®¶ä¾¿åˆ©å•†åº—'] }, cap: Infinity }
                ]
            },
            {
                id: 'unicard', name: 'ç‰å±± Unicard', note: 'ç•¶æœˆæœˆåº•æœ€å¾Œä¸€å¤©åˆ‡æ–¹æ¡ˆ',
                benefits: [
                    { name: 'ä¸€èˆ¬æ¶ˆè²»', rate: 0.01, desc: 'ä¸€èˆ¬æ¶ˆè²» (ç„¡ä¸Šé™)', type: 'text', note: '1%', categories: {}, cap: Infinity },
                    { 
                        name: 'ç™¾å¤§ç‰¹åº—', rate: 0, tag: 'list', type: 'modal',
                        desc: 'é»æ“ŠæŸ¥çœ‹å®Œæ•´åå–®', 
                        categories: {
                            'è¡Œå‹•æ”¯ä»˜': ['ç‰å±±Wallet', 'LINE Pay', 'å…¨æ”¯ä»˜', 'è¡—å£æ”¯ä»˜', 'æ‚ éŠä»˜', 'å…¨ç›ˆ+PAY', 'iPASS MONEY', 'icash Pay'],
                            'åŠ æ²¹äº¤é€š': ['å°ç£ä¸­æ²¹-ç›´ç‡Ÿç«™', '55688', 'å°ç£éµè·¯', 'å°ç£é«˜éµ', 'Uber', 'Yoxi'],
                            'åœ‹å…§ç™¾è²¨': ['æ–°å…‰ä¸‰è¶Š', 'é æ±ç™¾è²¨', 'æ¼¢ç¥ç™¾è²¨', 'å¾®é¢¨', 'å°åŒ—101', 'è¯æ³°åå“åŸ', 'ä¸‰äº•OUTLET', 'äº¬ç«™', 'ç¾éº—è¯', 'èª å“', 'ç§€æ³°', 'LaLaport', 'çµ±é ˜', 'çµ±ä¸€æ™‚ä»£', 'æ˜‡æ†æ˜Œ', 'é‡‡ç›Ÿ'],
                            'é¤é£²ç¾é£Ÿ': ['Uber Eats', 'foodpanda', 'EZTABLE', 'ç‹å“ç˜‹Pay', 'é¥—è³“', 'ç“¦åŸ', 'ä¹¾æ¯', 'æ¼¢ä¾†ç¾é£Ÿ', 'é¼ç‹', 'çˆ­é®®'],
                            'èˆªç©ºæ—…éŠ': ['ä¸­è¯èˆªç©º', 'é•·æ¦®èˆªç©º', 'æ—¥æœ¬èˆªç©º', 'å°ç£è™èˆª', 'æ¨‚æ¡ƒèˆªç©º', 'é…·èˆª', 'Trip.com', 'Booking.com', 'Hotels.com', 'AsiaYo', 'Expedia', 'KKday', 'Klook', 'é›„ç…', 'å¯æ¨‚', 'æ±å—', 'Agoda'],
                            'ç²¾é¸å•†å®¶': ['Appleç›´ç‡Ÿåº—', 'å°ç±³å°ç£', 'å…¨åœ‹é›»å­', 'ç‡¦å¤', 'è¿ªå¡å„‚'],
                            'ç”Ÿæ´»æ¡è²·': ['å®¶æ¨‚ç¦', 'å±ˆè‡£æ°', 'åº·æ˜¯ç¾', 'ç‰¹åŠ›å±‹', 'HOLA', 'hoi', 'UNIQLO', 'NET', 'å¤§æ¨¹è—¥å±€', 'ä¸ä¸è—¥å¦'],
                            'é›»å•†å¹³å°': ['momoè³¼ç‰©ç¶²', 'è¦çš®è³¼ç‰©', 'æ·˜å¯¶', 'Coupangé…·æ¾'],
                            'åœ‹å¤–å¯¦é«”': ['æ—¥æœ¬', 'éŸ“åœ‹', 'æ³°åœ‹', 'è¶Šå—', 'æ–°åŠ å¡', 'é¦¬ä¾†è¥¿äº', 'è²å¾‹è³“', 'ä¸­åœ‹', 'é¦™æ¸¯', 'æ¾³é–€', 'ç¾åœ‹', 'åŠ æ‹¿å¤§', 'è‹±åœ‹', 'æ³•åœ‹', 'å¾·åœ‹', 'ç¾©å¤§åˆ©', 'æ¾³æ´²'],
                            'ESGæ¶ˆè²»': ['ç‰¹æ–¯æ‹‰', 'Gogoro', 'YouBike']
                        },
                        note: 'å›é¥‹ä¾æ–¹æ¡ˆ',
                        cap: Infinity
                    },
                    { name: 'UPé¸', rate: 0.045, desc: 'ç™¾å¤§ç‰¹åº— (éœ€149é»è¨‚é–±)', type: 'text', note: 'ä¸€èˆ¬1% + UPé¸3.5% (ä¸Šé™åˆ·$142,857)', cap: 142857 },
                    { name: 'ä»»æ„é¸', rate: 0.035, desc: 'ç™¾å¤§ç‰¹åº— (éœ€è¨­å®š8å®¶)', type: 'text', note: 'ä¸€èˆ¬1% + ä»»æ„é¸2.5% (ä¸Šé™åˆ·$400,000)', cap: 400000 },
                    { name: 'ç°¡å–®é¸', rate: 0.03, desc: 'ç™¾å¤§ç‰¹åº— (é è¨­æ–¹æ¡ˆ)', type: 'text', note: 'ä¸€èˆ¬1% + ç°¡å–®é¸2% (ä¸Šé™åˆ·$500,000)', cap: 500000 },
                    { 
                        name: 'æ–°æˆ¶å›é¥‹', rate: 0.03, tag: 'new', type: 'modal',
                        desc: 'æŒ‡å®šé€šè·¯', 
                        categories: { 'æŒ‡å®šé€šè·¯': ['LINE Pay', 'Uber Eats', 'å®¶æ¨‚ç¦', 'éŸ“åœ‹', 'å…¨ç›ˆ+PAY'] },
                        note: '<span class="urgent-text">æŒ‡å®šé€šè·¯ + 3% (ä¸Šé™åˆ·$14,667) æœ€é«˜7.5%</span>',
                        cap: 14667 
                    }
                ]
            },
            {
                id: 'ubear', name: 'ç‰å±± UBear', note: 'å¨›æ¨‚10% / ç¶²è³¼3% (ç¶²è³¼ä¸Šé™åˆ· $7,500)',
                benefits: [
                    { name: 'ä¸€èˆ¬æ¶ˆè²»', rate: 0.01, desc: 'ä¸€èˆ¬æ¶ˆè²» (ç„¡ä¸Šé™)', type: 'text', note: '1%', categories: {}, cap: Infinity },
                    { name: 'å½±éŸ³å¨›æ¨‚', rate: 0.10, tag: 'ent', desc: 'Netflix | Disney+ | Nintendo', categories: { 'å½±éŸ³å¨›æ¨‚': ['Netflix', 'Disney+', 'Nintendo', 'PlayStation', 'KKBOX', 'iTunes', 'Google Play', 'Funnow'] }, note: '10% (ä¸Šé™åˆ·$1000)', cap: 1000 },
                    { name: 'ç¶²è³¼/Pay', rate: 0.03, tag: 'net', desc: 'ç¶²è³¼ | è¡Œå‹•æ”¯ä»˜ | è¨‚æˆ¿ | å¤–é€', 
                      categories: { 
                        'è¡Œå‹•æ”¯ä»˜': ['LINE Pay', 'è¡—å£æ”¯ä»˜', 'æ‚ éŠä»˜', 'OPENéŒ¢åŒ…', 'icash Pay', 'å…¨ç›ˆ+PAY', 'å…¨æ”¯ä»˜', 'æ©˜å­æ”¯ä»˜', 'skm pay', 'ä¸­æ²¹Pay', 'ç‰å±±Wallet', 'Pi æ‹éŒ¢åŒ…', 'æ­ä»˜å¯¶', 'PayPal', 'Hami Pay'],
                        'ç·šä¸Šè³¼ç‰©': ['PChome', 'momoè³¼ç‰©ç¶²', 'è¦çš®è³¼ç‰©', 'Coupangé…·æ¾', 'Yahoo', 'æ·˜å¯¶', 'éœ²å¤©', 'åšå®¢ä¾†', 'ç”Ÿæ´»å¸‚é›†', 'æ¾æœè³¼ç‰©', 'èª å“ç¶²è·¯', 'friDayè³¼ç‰©', 'udnå”®ç¥¨ç¶²', 'GOMAJI', 'æ¨‚å¤©å¸‚å ´', 'å±ˆè‡£æ°ç·šä¸Š', 'åº·æ˜¯ç¾ç·šä¸Š', 'å®¶æ¨‚ç¦ç·šä¸Š', 'ç¥è…¦', 'ç‡¦å¤ç·šä¸Š', 'Appleå®˜ç¶²', 'å°ç±³å°ç£', 'è¿ªå¡å„‚ç·šä¸Š', 'æ‹“å…ƒ', 'ZARA', 'H&M', 'GU', 'UNIQLO', 'Lativ', 'ZALORA', 'Pinkoi'],
                        'äº¤é€šè¨‚æˆ¿': ['55688', 'Uber', 'å°ç£é«˜éµT-EX', 'å°ç£éµè·¯ç·šä¸Š', 'æ˜“éŠç¶²', 'Agoda', 'Hotels.com', 'Expedia', 'Klook', 'KKday', 'Booking.com', 'Airbnb', 'ä¸­è¯èˆªç©º', 'é•·æ¦®èˆªç©º', 'å°ç£è™èˆª'],
                        'å¤–é€å¹³å°': ['Uber Eats', 'foodpanda', 'foodomo', 'lalamove', 'ä½ è¨‚']
                      },
                      note: 'ä¸€èˆ¬1% + ç¶²è³¼2% (ä¸Šé™åˆ·$7500)', cap: 7500 
                    },
                    { name: 'æ–°æˆ¶åŠ ç¢¼', rate: 0.07, tag: 'bonus', type: 'text', desc: 'åŒç¶²è³¼/Payé€šè·¯', note: 'ç¶²è³¼/PayåŠ ç¢¼ + 7% (ä¸Šé™åˆ·$2142) æœ€é«˜10%', categories: {}, cap: 2142 }
                ]
            },
            {
                id: 'dawho', name: 'æ°¸è± DAWHO', note: 'å¤§æˆ¶ç­‰ç´šï¼šåœ‹å…§3.5%/åœ‹å¤–4.5% (ä¸Šé™åˆ· 1.6 è¬)',
                benefits: [
                    { name: 'ä¸€èˆ¬æ¶ˆè²»', rate: 0.01, desc: 'ä¸€èˆ¬æ¶ˆè²» (ç„¡ä¸Šé™)', type: 'text', note: 'åœ‹å…§1%/åœ‹å¤–2%', categories: {}, cap: Infinity },
                    { name: 'åœ‹å…§å…¨é€šè·¯', rate: 0.035, desc: 'å…¨é€šè·¯ç„¡è…¦åˆ·', tag: 'all', type: 'text', note: 'ä¸€èˆ¬1% + ä»»å‹™2.5% (ä¸Šé™åˆ·$16,000)', cap: 16000 },
                    { name: 'åœ‹å¤–å…¨é€šè·¯', rate: 0.045, desc: 'åœ‹å¤–æ¶ˆè²»)', tag: 'foreign', type: 'text', note: 'ä¸€èˆ¬2% + ä»»å‹™2.5% (ä¸Šé™åˆ·$16,000)', cap: 16000 },
                    { name: 'æ‚ éŠå¡è‡ªå‹•åŠ å€¼', rate: 0.03, desc: 'ä¸å«ä¸€èˆ¬æ¶ˆè²»å›é¥‹', tag: 'easy', type: 'text', note: '3% (ä¸Šé™åˆ·$3333)', cap: 3333 }
                ]
            }
        ];

        const normalizationMap = {
            'å…¨å®¶': 'å…¨å®¶ä¾¿åˆ©å•†åº—', '7-11': '7-ELEVEN', 'å°ä¸ƒ': '7-ELEVEN',
            'è¦çš®': 'è¦çš®è³¼ç‰©', 'uber': 'Uber', 'é«˜éµ': 'å°ç£é«˜éµ', 'å°éµ': 'å°ç£éµè·¯',
            'ä¸­æ²¹': 'å°ç£ä¸­æ²¹-ç›´ç‡Ÿç«™', 'line': 'LINE Pay', 'linepay': 'LINE Pay',
            'ubereats': 'Uber Eats', 'foodpanda': 'foodpanda', 'ç†Šè²“': 'foodpanda',
            'å…¨è¯': 'å…¨è¯ç¦åˆ©ä¸­å¿ƒ', 'å®¶æ¨‚ç¦': 'å®¶æ¨‚ç¦', 'momo': 'momoè³¼ç‰©ç¶²',
            'pchome': 'PChome 24hè³¼ç‰©', 'klook': 'Klook', 'kkday': 'KKday',
            'uniqlo': 'UNIQLO', 'ikea': 'IKEA'
        };
        const aliasMap = { ...normalizationMap, 'è‚¯å¾·åŸº': 'åœ‹å…§é¤é£²', 'æ˜Ÿå·´å…‹': 'åœ‹å…§é¤é£²', 'éº¥ç•¶å‹': 'éº¥ç•¶å‹', 'æ—¥æœ¬': 'åœ‹å¤–æ¶ˆè²»', 'éŸ“åœ‹': 'åœ‹å¤–æ¶ˆè²»' };

        const quickFilters = [
            { name: 'ğŸª è¶…å•†é‡è²©', keywords: ['è¶…å•†', 'é‡è²©', 'è¶…å¸‚'] },
            { name: 'ğŸ” é¤é£²å¤–é€', keywords: ['é¤é£²', 'å¤–é€', 'ç¾é£Ÿ'] },
            { name: 'ğŸ›ï¸ ç¶²è³¼å¹³å°', keywords: ['ç¶²è³¼', 'é›»å•†', 'ç·šä¸Šè³¼ç‰©'] },
            { name: 'ğŸš„ äº¤é€šæ—…éŠ', keywords: ['äº¤é€š', 'æ—…éŠ', 'è¨‚æˆ¿', 'èˆªç©º', 'æ—…è¡Œç¤¾', 'é«˜éµ', 'å°éµ', 'åœ‹å¤–'] },
            { name: 'ğŸ’³ è¡Œå‹•æ”¯ä»˜', keywords: ['è¡Œå‹•æ”¯ä»˜', 'Pay'] },
            { name: 'ğŸ¬ å½±éŸ³å¨›æ¨‚', keywords: ['å½±éŸ³', 'å¨›æ¨‚', 'éŠæˆ²', 'KTV', 'æ¨‚åœ’'] },
            { name: 'ğŸ¬ ç™¾è²¨è—¥å¦', keywords: ['ç™¾è²¨', 'Outlet', 'è—¥å¦', 'è—¥å±€'] }
        ];

        let globalMerchantDB = {};
        let activeFilter = null;

        function init() {
            generateMerchantDB();
            renderCardOverview();
            renderQuickFilters();
            
            const debouncedSearch = debounce(handleSearchInput, 300);
            document.getElementById('searchMerchant').addEventListener('input', (e) => {
                const val = e.target.value.trim();
                document.getElementById('clearSearchBtn').style.display = val ? 'flex' : 'none';
                debouncedSearch(e);
            });

            document.getElementById('calcMerchant').addEventListener('input', handleCalcSearchInput);
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.input-wrapper')) {
                    document.getElementById('suggestionDropdown').style.display = 'none';
                    document.getElementById('calcSuggestionDropdown').style.display = 'none';
                }
            });
            document.getElementById('calcAmount').addEventListener('keyup', (e) => { if(e.key === 'Enter') calculateRewards(); });
            document.getElementById('calcMerchant').addEventListener('keyup', (e) => { if(e.key === 'Enter') calculateRewards(); });
            document.getElementById('calcUnicardScheme').addEventListener('change', calculateRewards);
            document.getElementById('calcNewUser').addEventListener('change', calculateRewards);
        }

        function toggleSearchNewUser() {
            const btn = document.getElementById('searchNewUserBtn');
            const chk = document.getElementById('searchNewUser');
            chk.checked = !chk.checked;
            btn.classList.toggle('active', chk.checked);
            
            const val = document.getElementById('searchMerchant').value.trim();
            if (val) {
                renderMerchantResult(val);
            } else if (activeFilter) {
                const currentFilter = activeFilter;
                activeFilter = null;
                applyCategoryFilter(currentFilter);
            } 
        }

        function toggleCalcNewUser() {
            const btn = document.getElementById('calcNewUserBtn');
            const chk = document.getElementById('calcNewUser');
            chk.checked = !chk.checked;
            btn.classList.toggle('active', chk.checked);
            calculateRewards();
        }

        const debouncedReSearch = debounce(() => {
             const val = document.getElementById('searchMerchant').value;
             if (val) renderMerchantResult(val);
        }, 300);

        function generateMerchantDB() {
            globalMerchantDB = {};
            cardBenefitsData.forEach(card => {
                card.benefits.forEach(benefit => {
                    if (card.id === 'unicard' && benefit.tag === 'new') return;

                    if (benefit.categories) {
                        Object.entries(benefit.categories).forEach(([catName, list]) => {
                            list.forEach(rawMerchant => {
                                const merchant = normalizationMap[rawMerchant] || rawMerchant;
                                const key = merchant.toLowerCase();
                                if (!globalMerchantDB[key]) globalMerchantDB[key] = { name: merchant, category: catName, cards: [] };
                                
                                let rate = benefit.rate;
                                let note = benefit.note;
                                let scheme = benefit.name;

                                if (card.id === 'ubear' && benefit.tag === 'net') note = 'ä¸€èˆ¬1% + ç¶²è³¼2% (ä¸Šé™åˆ·$7500)';
                                if (card.id === 'unicard' && benefit.name === 'ç™¾å¤§ç‰¹åº—åå–®') note = 'UPé¸4.5%';

                                if (!globalMerchantDB[key].cards.some(c => c.cardName === card.name && c.scheme === scheme)) {
                                    globalMerchantDB[key].cards.push({
                                        cardId: card.id, cardName: card.name, rate: rate, scheme: scheme, note: note, tag: benefit.tag
                                    });
                                }
                            });
                        });
                    }
                });
            });
        }

        function renderQuickFilters() {
            document.getElementById('quickCategoryTags').innerHTML = quickFilters.map(f => 
                `<div class="category-tag" onclick="applyCategoryFilter('${f.name}')">${f.name}</div>`
            ).join('');
        }
        function applyCategoryFilter(filterName) {
            const tags = document.querySelectorAll('.category-tag');
            if (activeFilter === filterName) {
                activeFilter = null; tags.forEach(t => t.classList.remove('active'));
                document.getElementById('merchantContainer').innerHTML = ''; return;
            }
            activeFilter = filterName; tags.forEach(t => {
                t.classList.toggle('active', t.textContent === filterName);
            });
            const filter = quickFilters.find(f => f.name === filterName);
            const matched = Object.values(globalMerchantDB).filter(d => filter.keywords.some(kw => d.category.includes(kw)));
            document.getElementById('merchantContainer').innerHTML = matched.length ? matched.map(d => generateMerchantCardHTML(d.name)).join('') : '<div style="text-align:center; padding:20px; color:#999;">ç„¡è³‡æ–™</div>';
        }
        function handleSearchInput(e) {
            const val = e.target.value.trim().toLowerCase();
            const dropdown = document.getElementById('suggestionDropdown');
            if (!val) { dropdown.style.display = 'none'; return; }
            let matches = new Set();
            for (const [alias, real] of Object.entries(aliasMap)) if (alias.includes(val)) matches.add(real);
            Object.keys(globalMerchantDB).forEach(k => { if(k.includes(val)) matches.add(globalMerchantDB[k].name); });
            const results = Array.from(matches).slice(0, 10);
            dropdown.innerHTML = results.length ? results.map(n => `<div class="suggestion-item" onclick="selectMerchant('${n}')">${n}</div>`).join('') : '<div class="suggestion-item" style="color:#999;">ç„¡ç›¸é—œè³‡æ–™</div>';
            dropdown.style.display = 'block';
        }
        function selectMerchant(name) {
            document.getElementById('searchMerchant').value = name;
            document.getElementById('suggestionDropdown').style.display = 'none';
            // é»é¸æœå°‹å»ºè­°æ™‚ï¼Œå¼·åˆ¶æ¸…é™¤åˆ†é¡æ¨™ç±¤ï¼Œé¿å…é‚è¼¯è¡çª
            activeFilter = null; 
            document.querySelectorAll('.category-tag').forEach(t => t.classList.remove('active'));
            renderMerchantResult(name);
        }
        function clearSearch(inputId, btnId, isSearch) {
            document.getElementById(inputId).value = '';
            document.getElementById(btnId).style.display = 'none';
            if (isSearch) {
                document.getElementById('merchantContainer').innerHTML = '';
                document.getElementById('suggestionDropdown').style.display = 'none';
                activeFilter = null; document.querySelectorAll('.category-tag').forEach(t => t.classList.remove('active'));
            } else {
                 document.getElementById('calcSuggestionDropdown').style.display = 'none';
            }
        }
        function renderMerchantResult(name) {
            document.getElementById('merchantContainer').innerHTML = generateMerchantCardHTML(name);
        }
        function generateMerchantCardHTML(name) {
            const key = name.toLowerCase();
            let data = globalMerchantDB[key];
            if (!data) {
                const fuzzy = Object.keys(globalMerchantDB).find(k => k.includes(key) || key.includes(k));
                if (fuzzy) data = globalMerchantDB[fuzzy];
            }
            let cards = data ? JSON.parse(JSON.stringify(data.cards)) : [];
            const isForeign = ['åœ‹å¤–','æ—¥æœ¬','éŸ“åœ‹','æµ·å¤–'].some(k => name.includes(k));
            if (!cards.find(c => c.cardId === 'dawho')) {
                if (isForeign) cards.push({ cardId: 'dawho', cardName: 'æ°¸è± DAWHO', rate: 0.045, scheme: 'åœ‹å¤–æ¶ˆè²»', note: 'ä¸€èˆ¬2% + ä»»å‹™2.5% (ä¸Šé™åˆ·$16,000)', tag: 'foreign' });
                else cards.push({ cardId: 'dawho', cardName: 'æ°¸è± DAWHO', rate: 0.035, scheme: 'åœ‹å…§å…¨é€šè·¯', note: 'ä¸€èˆ¬1% + ä»»å‹™2.5% (ä¸Šé™åˆ·$16,000)', tag: 'all' });
            }
            const uniScheme = document.getElementById('searchUnicardScheme').value;
            const isNew = document.getElementById('searchNewUser').checked;
            
            cards.forEach(c => {
                if (c.cardId === 'unicard' && c.tag === 'list') {
                    let rate = 0.035, bonus = 0.025, txt = 'ä»»æ„é¸';
                    if (uniScheme === 'simple') { rate = 0.03; bonus = 0.02; txt = 'ç°¡å–®é¸'; }
                    if (uniScheme === 'up') { rate = 0.045; bonus = 0.035; txt = 'UPé¸'; }
                    
                    if (isNew) {
                        const newBonusList = ['line pay', 'uber eats', 'å®¶æ¨‚ç¦', 'éŸ“åœ‹', 'å…¨ç›ˆ'];
                        if (newBonusList.some(kw => name.toLowerCase().includes(kw))) { 
                            rate += 0.03; 
                            txt += ' + æ–°æˆ¶'; 
                        }
                    }
                    c.rate = rate; 
                    c.scheme = txt; 
                    c.note = `ä¸€èˆ¬1% + ${txt.replace(' ','').replace('ç°¡å–®é¸','ç°¡å–®é¸2% (ä¸Šé™åˆ·$500,000)').replace('ä»»æ„é¸','ä»»æ„é¸2.5% (ä¸Šé™åˆ·$400,000)').replace('UPé¸','UPé¸3.5% (ä¸Šé™åˆ·$142,857)')}`;
                    if(txt.includes('æ–°æˆ¶')) c.note += ' + æ–°æˆ¶3%';
                }
                if (c.cardId === 'ubear' && c.tag === 'net' && isNew) { c.rate = 0.10; c.scheme = 'ç¶²è³¼/Pay + æ–°æˆ¶'; c.note = 'ç¶²è³¼/PayåŠ ç¢¼ + 7% (ä¸Šé™åˆ·$2142) æœ€é«˜10%'; }
            });

            if (!data) {
                cards.push({ cardId: 'unicard', cardName: 'ç‰å±± Unicard', rate: 0.01, scheme: 'ä¸€èˆ¬æ¶ˆè²»', note: '1%' });
                cards.push({ cardId: 'ubear', cardName: 'ç‰å±± UBear', rate: 0.01, scheme: 'ä¸€èˆ¬æ¶ˆè²»', note: '1%' });
                cards.push({ cardId: 'richart', cardName: 'å°æ–° Richart', rate: 0.003, scheme: 'ä¸€èˆ¬æ¶ˆè²»', note: '0.3%' });
                cards.push({ cardId: 'cube', cardName: 'åœ‹æ³° CUBE', rate: 0.003, scheme: 'ä¸€èˆ¬æ¶ˆè²»', note: '0.3%' });
            }
            cards.sort((a, b) => b.rate - a.rate);
            const best = cards[0];
            const brandClass = brandColorMap[best.cardId]?.class || '';
            const dotColor = brandColorMap[best.cardId]?.color || '#ccc';

            return `
                <div class="merchant-list ${brandClass}" onclick='openRankingModal(${JSON.stringify(cards)}, "${data ? data.name : name}")'>
                    <div><div class="merchant-name">${data ? data.name : name}</div>${data ? `<span class="merchant-type">${data.category}</span>` : '<span class="merchant-type">ä¸€èˆ¬æ¶ˆè²»æ’è¡Œ</span>'}</div>
                    <div class="merchant-best-info">
                        <div class="best-rate">${(best.rate * 100).toFixed(1)}%</div>
                        <div class="best-card-name">
                            <span class="card-icon-shape" style="background:${dotColor}"></span>
                            ${best.cardName}
                            <span class="scheme-badge list-badge">${best.scheme}</span>
                        </div>
                    </div>
                </div>
            `;
        }
        function openRankingModal(cards, merchantName) {
            const body = document.getElementById('detailBody');
            document.getElementById('modalTitle').innerText = `${merchantName} å›é¥‹æ’å`;
            const html = cards.map((c, idx) => {
                const isBest = idx === 0;
                let badgeClass = 'scheme-badge';
                if (c.scheme.includes('æ–°æˆ¶') || c.rate >= 0.07) badgeClass += ' new-user';
                
                const warningHtml = (isBest && c.tag === 'pay' && c.cardId === 'richart') ? `<div class="plan-warning">é™å°æ–°Pay/å°ç£Pay</div>` : '';
                const themeClass = brandColorMap[c.cardId]?.class || '';
                
                return `
                    <div class="detail-card-item ${isBest ? 'best-card' : ''} ${themeClass}">
                        <div class="detail-card-header"><span>${isBest ? 'ğŸ† ' : ''}${c.cardName}</span><span>${(c.rate * 100).toFixed(1)}%</span></div>
                        <div class="detail-card-body">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <span class="${badgeClass}">${c.scheme}</span>
                                <span style="font-size:0.9em; color:#666;">${c.note.replace(/<[^>]*>/g, '')}</span>
                            </div>
                            ${warningHtml}
                        </div>
                    </div>
                `;
            }).join('');
            body.innerHTML = html;
            document.getElementById('detailModal').classList.add('show');
        }

        function handleCalcSearchInput(e) {
            const val = e.target.value.trim().toLowerCase();
            const dropdown = document.getElementById('calcSuggestionDropdown');
            document.getElementById('clearCalcBtn').style.display = val ? 'flex' : 'none';
            if (!val) { dropdown.style.display = 'none'; return; }
            let matches = new Set();
            for (const [alias, real] of Object.entries(aliasMap)) if (alias.includes(val)) matches.add(real);
            Object.keys(globalMerchantDB).forEach(k => { if(k.includes(val)) matches.add(globalMerchantDB[k].name); });
            const results = Array.from(matches).slice(0, 5);
            dropdown.innerHTML = results.map(n => `<div class="suggestion-item" onclick="selectCalcMerchant('${n}')">${n}</div>`).join('');
            dropdown.style.display = 'block';
        }
        function selectCalcMerchant(name) {
            document.getElementById('calcMerchant').value = name;
            document.getElementById('calcSuggestionDropdown').style.display = 'none';
            if (name) calculateRewards();
        }

        function calculateRewards() {
            const amount = parseFloat(document.getElementById('calcAmount').value);
            const merchantInput = document.getElementById('calcMerchant').value.trim();
            const isNewUser = document.getElementById('calcNewUser').checked;
            const unicardScheme = document.getElementById('calcUnicardScheme').value;
            const container = document.getElementById('calcResults');

            if (!amount || !merchantInput) { return; }

            // 1. å–å¾—é€šè·¯èˆ‡å¡ç‰‡è³‡æ–™
            const key = merchantInput.toLowerCase();
            let data = globalMerchantDB[key];
            if (!data) {
                const fuzzy = Object.keys(globalMerchantDB).find(k => k.includes(key) || key.includes(k));
                if (fuzzy) data = globalMerchantDB[fuzzy];
            }
            let cards = data ? JSON.parse(JSON.stringify(data.cards)) : [];
            
            // è£œä¸Šé€šç”¨å¡ç‰‡ (å¤§æˆ¶/CUBE/Unicard/UBear)
            const isForeign = ['åœ‹å¤–','æ—¥æœ¬','éŸ“åœ‹','æµ·å¤–'].some(k => merchantInput.includes(k));
            if (!cards.find(c => c.cardId === 'dawho')) {
                if (isForeign) cards.push({ cardId: 'dawho', cardName: 'æ°¸è± DAWHO', scheme: 'åœ‹å¤–æ¶ˆè²»', tag: 'foreign', rate: 0.045, note: 'ä¸€èˆ¬2%+ä»»å‹™2.5%' });
                else cards.push({ cardId: 'dawho', cardName: 'æ°¸è± DAWHO', scheme: 'åœ‹å…§å…¨é€šè·¯', tag: 'all', rate: 0.035, note: 'ä¸€èˆ¬1%+ä»»å‹™2.5%' });
            }
            if (!data) {
                cards.push({ cardId: 'ubear', cardName: 'ç‰å±± UBear', scheme: 'ä¸€èˆ¬æ¶ˆè²»', tag: 'gen', rate: 0.01 });
                cards.push({ cardId: 'unicard', cardName: 'ç‰å±± Unicard', scheme: 'ä¸€èˆ¬æ¶ˆè²»', tag: 'gen', rate: 0.01 });
                cards.push({ cardId: 'richart', cardName: 'å°æ–° Richart', scheme: 'ä¸€èˆ¬æ¶ˆè²»', tag: 'gen', rate: 0.003 });
                cards.push({ cardId: 'cube', cardName: 'åœ‹æ³° CUBE', scheme: 'ä¸€èˆ¬æ¶ˆè²»', tag: 'gen', rate: 0.003 });
            }

            // 2. è¨ˆç®—æ¯å¼µå¡ç‰‡çš„å›é¥‹ (å«è©³ç´°é‚è¼¯)
            const results = cards.map(c => {
                let reward = 0, detailText = '';
                // ç”¨ä¾†çµ¦æ‹†å–®é‚è¼¯åˆ¤æ–·çš„åƒæ•¸
                let actualCap = c.cap || Infinity; 
                let rateAfterCap = 0.01; // è¶…éä¸Šé™å¾Œçš„è²»ç‡ (é è¨­1%)

                if (c.cardId === 'richart') {
                    // Richart 3.3% ~ 3.8% ç„¡ä¸Šé™
                    reward = Math.floor(amount * c.rate);
                    detailText = `${formatMoney(reward)} (${formatRate(c.rate*100)}%)`;
                    rateAfterCap = c.rate; // å› ç‚ºç„¡ä¸Šé™ï¼Œæ‰€ä»¥å¾ŒçºŒè²»ç‡ä¸è®Š
                }
                else if (c.cardId === 'cube') {
                    // CUBE 3% ç„¡ä¸Šé™
                    reward = Math.floor(amount * c.rate);
                    detailText = `${formatMoney(reward)} (æ–¹æ¡ˆ${formatRate(c.rate*100)}%)`;
                    rateAfterCap = c.rate;
                }
                else if (c.cardId === 'dawho') {
                    // å¤§æˆ¶ 3.5% / 4.5% ä¸Šé™ 16000ï¼Œä¹‹å¾Œè®Š 1% (æˆ–2%åœ‹å¤–)
                    const cap = 16000;
                    actualCap = cap;
                    const baseRate = c.tag === 'foreign' ? 0.02 : 0.01;
                    rateAfterCap = baseRate;

                    if (amount <= cap) { reward = Math.floor(amount * c.rate); }
                    else { reward = Math.floor(cap * c.rate) + Math.floor((amount - cap) * baseRate); }
                    detailText = `${formatMoney(reward)} (å¹³å‡${formatRate(reward/amount*100)}%)`;
                }
                else if (c.cardId === 'ubear' && c.tag === 'net') {
                    // UBear ç¶²è³¼
                    const baseCap = 7500;
                    actualCap = baseCap;
                    rateAfterCap = 0.01;

                    if (isNewUser) {
                        // æ–°æˆ¶: ç¶²è³¼3% + åŠ ç¢¼7%(ä¸Šé™2142, åˆ·30600)
                        // ä½†é€šå¸¸ 7500 ä¹‹å¾Œ 3% å°±æ²’äº†ï¼Œåªå‰©åŠ ç¢¼çš„ 7%? 
                        // ä¾ç…§æ¢æ¬¾ï¼šæ–°æˆ¶åŠ ç¢¼æ˜¯é¡å¤–çš„ã€‚
                        // ç°¡åŒ–é‚è¼¯ï¼š3% (up to 7500) + 7% (up to 2142/0.07=30600)
                        // å¯¦éš›ä¸Šå› ç‚º 7500 å°±æ²’äº† 3%ï¼Œæ‰€ä»¥é€šå¸¸å»ºè­° 7500 ç‚ºæ‹†å–®é»ï¼Œé™¤éåŠ ç¢¼æ¥µå¼·
                        // é€™è£¡ç¶­æŒåŸé‚è¼¯ï¼Œä½†åŠ ä¸Šæ–°æˆ¶è¨ˆç®—
                        
                        let baseReward = (amount <= 7500) ? Math.floor(amount * 0.03) : (Math.floor(7500 * 0.03) + Math.floor((amount - 7500) * 0.01));
                        
                        // æ–°æˆ¶åŠ ç¢¼éƒ¨åˆ† (7% ä¸Šé™ 2142)
                        let newBonusCapAmt = 14667 * 2; // ç´„ 30600
                        let newBonusBase = Math.min(amount, 30600); // æ¦‚æŠ“
                        // ä¿®æ­£ï¼šæ–°æˆ¶ä¸Šé™æ˜¯å›é¥‹ 2142ï¼Œæ‰€ä»¥æ˜¯åˆ· 30600
                        // ä½†æ˜¯ UBear æœ¬èº« 3% åœ¨ 7500 å°±åœäº†ã€‚
                        // 7500 å…§: 10%
                        // 7500 ~ 30600: 1% + 7% = 8%
                        // > 30600: 1%
                        // ç‚ºäº†æ‹†å–®é‚è¼¯æº–ç¢ºï¼Œæˆ‘å€‘è¨­å®š "æœ€å¼·å€é–“"
                        if (amount > 7500) {
                             // é€™è£¡æ¨™è¨˜çµ¦æ‹†å–®é‚è¼¯ï¼šé 7500 å¾Œé‚„æœ‰ 8% å…¶å¯¦å¾ˆå¼·ï¼Œä¸æ‡‰è©²åœ¨ 7500 æ‹†
                             // ä½†ç‚ºäº†ä¿éšªï¼Œé€™è£¡æš«å®š cap ç‚º 7500
                             // *é€²éšä¿®æ­£*ï¼šå¦‚æœæ–°æˆ¶ï¼ŒUBear å…¶å¯¦åœ¨ 3è¬ä»¥å…§éƒ½è¶…å¼·ï¼Œä¸ç”¨æ‹†
                             rateAfterCap = 0.08; 
                        }
                        let newBonus = Math.floor(Math.min(amount, 30600) * 0.07);
                        reward = baseReward + newBonus;
                    } else {
                        // èˆŠæˆ¶
                        if (amount <= baseCap) reward = Math.floor(amount * 0.03);
                        else reward = Math.floor(baseCap * 0.03) + Math.floor((amount - baseCap) * 0.01);
                    }
                    detailText = `${formatMoney(reward)} (å¹³å‡${formatRate(reward/amount*100)}%)`;
                }
                else if (c.cardId === 'unicard' && c.tag === 'list') {
                    // Unicard è¤‡é›œé‚è¼¯
                    let baseRate = 0.01;
                    let schemeAdd = 0.02; // simple
                    if (unicardScheme === 'any') schemeAdd = 0.025;
                    if (unicardScheme === 'up') schemeAdd = 0.035;
                    
                    let totalSchemeRate = baseRate + schemeAdd; // 3% ~ 4.5%
                    
                    // æ–¹æ¡ˆä¸Šé™
                    let schemeCap = 500000;
                    if (unicardScheme === 'any') schemeCap = 400000;
                    if (unicardScheme === 'up') schemeCap = 142857;
                    actualCap = schemeCap;
                    rateAfterCap = 0.01;

                    // æ–°æˆ¶åˆ¤æ–·
                    const newBonusList = ['line pay', 'uber eats', 'å®¶æ¨‚ç¦', 'éŸ“åœ‹', 'å…¨ç›ˆ'];
                    let isNewTarget = isNewUser && newBonusList.some(kw => merchantInput.toLowerCase().includes(kw));

                    if (amount <= schemeCap) {
                        reward = Math.floor(amount * totalSchemeRate);
                    } else {
                        reward = Math.floor(schemeCap * totalSchemeRate) + Math.floor((amount - schemeCap) * 0.01);
                    }
                    
                    if (isNewTarget) {
                        // æ–°æˆ¶é¡å¤– +3% (ä¸Šé™ 14667)
                        let newCap = 14667;
                        let newBase = Math.min(amount, newCap);
                        reward += Math.floor(newBase * 0.03);

                        // **é—œéµä¿®æ­£**ï¼šå‘ŠçŸ¥æ‹†å–®é‚è¼¯ï¼Œåœ¨ 14667 ä¹‹å¾Œï¼Œè²»ç‡æœƒè®Šæˆ totalSchemeRate (ä¾‹å¦‚ 3%)
                        // è€Œä¸æ˜¯ä¸€ç›´ç¶­æŒé«˜è²»ç‡ç›´åˆ° schemeCap
                        c.specialSplitThreshold = newCap; 
                        c.rateAfterSpecialThreshold = totalSchemeRate;
                    }
                    
                    detailText = `${formatMoney(reward)} (å¹³å‡${formatRate(reward/amount*100)}%)`;
                }
                else { 
                    // å…¶ä»–ç„¡ä¸Šé™å¡
                    reward = Math.floor(amount * c.rate); 
                    detailText = `${formatMoney(reward)} (å…¨é¡${formatRate(c.rate*100)}%)`; 
                    rateAfterCap = c.rate;
                }
                
                return { ...c, reward, detail: detailText, actualCap, rateAfterCap };
            });

            // 3. æ’åºæ‰¾å‡ºå† è»
            results.sort((a, b) => b.reward - a.reward);
            const winner = results[0];
            
            // 4. æ‹†å–®å»ºè­°é‚è¼¯ (ä¿®æ­£ç‰ˆ)
            let splitHtml = '';
            
            // æ‰¾å‡ºç¬¬äºŒå (æ’é™¤å† è»è‡ªå·±)
            const candidates = results.filter(r => r.cardId !== winner.cardId);
            // æ‰¾å‡ºå–®åˆ·é¤˜é¡æœ€å¼·çš„å‰¯å¡
            // æˆ‘å€‘éœ€è¦ä¸€å€‹å‹•æ…‹çš„æ¯”è¼ƒåŸºæº–ï¼Œé€™è£¡ç°¡åŒ–ï¼šå–å‰¯å¡çš„åŸºæœ¬å›é¥‹ç‡ä¾†æ¯”è¼ƒ
            const bestBackup = candidates[0]; // æ—¢ç„¶å·²æ’åºï¼Œç¬¬äºŒåé€šå¸¸æ˜¯æœ€ä½³å‰¯å¡

            if (bestBackup && amount > 100) {
                // æ±ºå®šæ‹†å–®é» (Split Point)
                let splitPoint = null;
                let reason = '';

                // Case A: Unicard æ–°æˆ¶ç‰¹æ®Šæ–·é» ($14,667)
                if (winner.specialSplitThreshold && amount > winner.specialSplitThreshold) {
                    // å¦‚æœã€Œéæ–°æˆ¶é–€æª»å¾Œçš„è²»ç‡ã€ < ã€Œå‰¯å¡è²»ç‡ã€
                    // ä¾‹å¦‚: Unicard å‰© 3% < Richart 3.8% -> æ‡‰è©²æ‹†
                    if (winner.rateAfterSpecialThreshold < bestBackup.rate) {
                        splitPoint = winner.specialSplitThreshold;
                        reason = `è¶…éæ–°æˆ¶é¡åº¦ ${formatMoney(splitPoint)} å¾Œå›é¥‹ä¸‹é™`;
                    }
                }
                // Case B: ä¸€èˆ¬ä¸Šé™æ–·é» (ä¾‹å¦‚ UBear $7500, å¤§æˆ¶ $16000)
                else if (winner.actualCap && amount > winner.actualCap && winner.actualCap !== Infinity) {
                    // å¦‚æœã€Œéä¸Šé™å¾Œçš„è²»ç‡ã€ < ã€Œå‰¯å¡è²»ç‡ã€
                    // ä¾‹å¦‚: å¤§æˆ¶ å‰© 1% < Cube 3% -> æ‡‰è©²æ‹†
                    if (winner.rateAfterCap < bestBackup.rate) {
                        splitPoint = winner.actualCap;
                        reason = `è¶…éä¸Šé™ ${formatMoney(splitPoint)} å¾Œå›é¥‹ä¸‹é™`;
                    }
                }

                // å¦‚æœæœ‰æ‰¾åˆ°é©åˆçš„æ‹†å–®é»
                if (splitPoint) {
                    // è¨ˆç®—æ‹†å–®å¾Œçš„ç¸½å›é¥‹
                    // 1. å† è»å¡åˆ·åˆ° splitPoint çš„å›é¥‹ (éœ€é‡æ–°ç²¾ç®—ï¼Œä¸èƒ½åªç”¨æ¯”ä¾‹ï¼Œå› ç‚ºå¯èƒ½æœ‰åŠ ç¢¼)
                    // é€™è£¡ç‚ºäº†ä¸å¯«å¤ªè¤‡é›œçš„éè¿´ï¼Œæˆ‘å€‘ç”¨ "ç¸½å›é¥‹ - è¶…å‡ºéƒ¨åˆ†çš„å›é¥‹" ä¾†åæ¨ï¼Œæˆ–è€…ç°¡å–®é‡ç®—
                    // ç°¡å–®é‡ç®— Winner Part:
                    let winnerPartReward = 0;
                    // ç‚ºäº†æ–¹ä¾¿ï¼Œæˆ‘å€‘é‡æ–°å‘¼å«ä¸€æ¬¡é‚è¼¯å¤ªéº»ç…©ï¼Œé€™è£¡ç”¨ç°¡æ˜“ä¼°ç®—ï¼š
                    // Winner Reward at SplitPoint (é€šå¸¸æ˜¯é«˜è²»ç‡æ»¿é¡)
                    // é€™è£¡ç”¨ "æ¯”ä¾‹" è¿‘ä¼¼æœƒæœ‰èª¤å·®ï¼Œæˆ‘å€‘ç”¨ "ç¸½å›é¥‹" æ‰£æ‰ "è¶…å‡ºéƒ¨åˆ†ç”¨ä½è²»ç‡ç®—çš„å›é¥‹"
                    
                    // ç‚ºäº†ç²¾æº–ï¼Œæˆ‘å€‘æ‰‹å‹•ç®—ä¸€ä¸‹ SplitPoint å…§çš„ Winner Reward
                    // é€™ç¨®å¯«æ³•æœ‰é»é«’ä½†æœ‰æ•ˆï¼š
                    if (winner.cardId === 'unicard' && winner.specialSplitThreshold) {
                         // Unicard æ–°æˆ¶æ»¿é¡: (Scheme% + 3%) * 14667
                         winnerPartReward = Math.floor(splitPoint * (winner.rateAfterSpecialThreshold + 0.03));
                    } else if (winner.cardId === 'ubear') {
                        winnerPartReward = Math.floor(splitPoint * 0.03); // UBear 7500 å…§
                        if (isNewUser) winnerPartReward += Math.floor(splitPoint * 0.07);
                    } else {
                        winnerPartReward = Math.floor(splitPoint * winner.rate);
                    }

                    // 2. å‰¯å¡åˆ·å‰©é¤˜é‡‘é¡
                    const remaining = amount - splitPoint;
                    const backupPartReward = Math.floor(remaining * bestBackup.rate);
                    
                    const splitTotal = winnerPartReward + backupPartReward;
                    const diff = splitTotal - winner.reward;

                    if (diff > 10) { // è‡³å°‘å¤šè³º 10 å…ƒæ‰å»ºè­°
                        splitHtml = `
                            <div class="split-recommendation">
                                <div class="split-title">ğŸ’¡ å»ºè­°æ‹†å–® (å¤šè³º ${formatMoney(diff)})</div>
                                <div style="font-size:0.85em; color:#558b2f; margin-bottom:5px;">${reason}</div>
                                <div class="split-step">å…ˆåˆ· <b>${winner.cardName}</b>ï¼š${formatMoney(splitPoint)}</div>
                                <div class="split-step">é¤˜é¡ <b>${bestBackup.cardName}</b>ï¼š${formatMoney(remaining)}</div>
                                <div class="split-total">é æœŸç¸½å›é¥‹ï¼š${formatMoney(splitTotal)}</div>
                            </div>
                        `;
                    }
                }
            }

            container.innerHTML = results.map((res, idx) => {
                const isWinner = idx === 0;
                const themeClass = brandColorMap[res.cardId]?.class || '';
                const trophy = isWinner ? 'ğŸ† ' : '';
                return `
                <div class="calc-result-item ${isWinner ? 'winner' : ''} ${themeClass}">
                    <div class="calc-header">
                        <span style="font-weight:700;">${idx+1}. ${res.cardName} (${res.scheme})</span>
                        <span class="calc-money">${trophy}${formatMoney(res.reward)}</span>
                    </div>
                    <div style="font-size:0.9em; color:${isWinner?'var(--color-success)':'#555'};">
                        ${res.detail.split('(')[1] ? 'å¹³å‡å›é¥‹ç‡ï¼š' + res.detail.split('(')[1].replace(')', '') : ''}
                    </div>
                    <div class="calc-detail">${res.detail}</div>
                    ${isWinner ? splitHtml : ''}
                </div>
            `}).join('');
        }

        function renderCardOverview() {
            document.getElementById('cardOverviewContainer').innerHTML = cardBenefitsData.map((card, idx) => {
                const color = brandColorMap[card.id]?.color || '#ccc';
                const themeClass = brandColorMap[card.id]?.class || '';
                return `
                <div class="card-accordion-item ${themeClass}">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <div class="card-title-row">
                            <span class="card-icon-shape" style="background:${color}"></span>
                            <span class="card-title-text">${card.name}</span>
                        </div>
                        <span class="chevron">â–¼</span>
                    </div>
                    <div class="accordion-body">
                        <div class="benefit-row no-action" style="background:#fffcec;"><div class="benefit-desc">${card.note}</div></div>
                        ${renderBenefits(card, idx)}
                    </div>
                </div>
            `}).join('');
        }
        function renderBenefits(card, cardIndex) {
            return card.benefits.map((b, bIndex) => {
                if (b.type === 'text') return `<div class="benefit-row no-action"><div class="benefit-header"><span class="benefit-name">${b.name}</span><span class="benefit-rate">${(b.rate > 0 ? (b.rate * 100).toFixed(1) + '%' : '')}</span></div><div class="benefit-desc">${b.desc}</div>${b.note ? `<div class="benefit-note">ğŸ’¡ ${b.note}</div>` : ''}</div>`;
                return `<div class="benefit-row" onclick="openSchemeList(${cardIndex}, ${bIndex})"><div class="benefit-header"><span class="benefit-name">${b.name}</span><span class="benefit-rate">${(b.rate * 100).toFixed(1)}%</span></div><div class="benefit-desc">${b.desc}</div>${b.note ? `<div class="benefit-note">ğŸ’¡ ${b.note}</div>` : ''}</div>`;
            }).join('');
        }
        function openSchemeList(cardIndex, benefitIndex) {
            const benefit = cardBenefitsData[cardIndex].benefits[benefitIndex];
            document.getElementById('modalTitle').innerText = `${cardBenefitsData[cardIndex].name} - ${benefit.name}`;
            let htmlContent = `<div style="margin-bottom:15px; font-size:0.9em; color:#666;">${benefit.note}</div>`;
            if (benefit.categories) {
                Object.entries(benefit.categories).forEach(([categoryName, items]) => {
                    htmlContent += `<div class="detail-category-group"><div class="detail-category-title">${categoryName}</div><div class="scheme-list-container">${items.map(item => `<span class="scheme-list-item">${item}</span>`).join('')}</div></div>`;
                });
            }
            document.getElementById('detailBody').innerHTML = htmlContent;
            document.getElementById('detailModal').classList.add('show');
        }
        function toggleAccordion(header) {
            const body = header.nextElementSibling;
            const isOpen = body.classList.contains('open');
            if(!isOpen) { body.classList.add('open'); header.classList.add('active'); } else { body.classList.remove('open'); header.classList.remove('active'); }
        }
        function switchTab(tabId) {
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.querySelector(`.nav-item[onclick="switchTab('${tabId}')"]`).classList.add('active');
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(`tab-${tabId}`).classList.add('active');
        }
        function closeDetailModal() { document.getElementById('detailModal').classList.remove('show'); }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>

