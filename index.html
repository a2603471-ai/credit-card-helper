<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿¡ç”¨å¡å›é¥‹æŸ¥è©¢åŠ©æ‰‹ 2026 (å®Œæ•´è³‡æ–™ç‰ˆ)</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --color-primary: #2180a0;
            --color-primary-hover: #1a6b84;
            --color-bg: #f5f5f5;
            --color-surface: #ffffff;
            --color-text: #333333;
            --color-text-light: #666666;
            --color-border: #e0e0e0;
            --color-success: #32b862;
            --color-best-bg: #e6fffa;
            --color-best-text: #047857;
            --color-highlight: #e65100;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            padding: 20px;
            line-height: 1.6;
        }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 20px; color: var(--color-primary); font-size: 1.8em; }
        
        .form-section {
            background: var(--color-surface);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .info-text {
            background: #e3f2fd;
            padding: 12px;
            border-radius: 8px;
            color: #0d47a1;
            margin-bottom: 20px;
            font-size: 0.9em;
            line-height: 1.5;
            border-left: 4px solid #2196f3;
        }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--color-text); }
        .input-wrapper { position: relative; display: flex; align-items: center; }
        input[type="text"] {
            width: 100%;
            padding: 14px 40px 14px 16px;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            font-size: 16px;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(33, 128, 160, 0.1);
        }
        .clear-btn {
            position: absolute; right: 12px;
            background: #eee; border: none; border-radius: 50%;
            width: 24px; height: 24px; cursor: pointer; color: #666;
            display: none; align-items: center; justify-content: center;
        }

        .suggestion-dropdown {
            position: absolute; top: 100%; left: 0; right: 0;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 0 0 8px 8px;
            max-height: 250px; overflow-y: auto; z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            display: none;
        }
        .suggestion-item { padding: 12px 16px; cursor: pointer; border-bottom: 1px solid #f0f0f0; }
        .suggestion-item:hover { background-color: #f5f9ff; }
        .highlight { color: var(--color-primary); font-weight: 700; }

        .category-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 15px; }
        .category-tag {
            padding: 6px 12px; background: var(--color-surface);
            border: 1px solid var(--color-border); border-radius: 20px;
            cursor: pointer; font-size: 0.85em; color: var(--color-text-light);
            transition: all 0.2s; user-select: none;
        }
        .category-tag.active { background: var(--color-primary); color: white; border-color: var(--color-primary); }

        .merchant-list {
            background: var(--color-surface); padding: 16px;
            border-radius: 12px; margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: transform 0.2s; cursor: pointer;
        }
        .merchant-list:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .merchant-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .merchant-name { font-size: 1.1em; font-weight: 700; color: var(--color-text); }
        .merchant-type { font-size: 0.8em; color: #888; background: #eee; padding: 2px 6px; border-radius: 4px; }
        .card-badges-row { display: flex; flex-wrap: wrap; gap: 6px; }
        .card-badge {
            padding: 4px 8px; background: #f0f0f0; color: #555;
            border-radius: 6px; font-size: 0.85em; font-weight: 500;
        }
        .card-badge.best {
            background: var(--color-best-bg); color: var(--color-best-text); border: 1px solid #b7eb8f;
        }
        .best-tip {
            margin-top: 10px; padding-top: 8px; border-top: 1px solid #eee;
            font-size: 0.85em; color: var(--color-text-light); display: flex; align-items: center;
        }
        .plan-hint {
            color: var(--color-highlight);
            font-weight: 700;
            margin-left: 4px;
            font-size: 0.9em;
        }

        .detail-modal {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6); z-index: 2000;
            align-items: center; justify-content: center; padding: 20px;
            backdrop-filter: blur(2px);
        }
        .detail-modal.show { display: flex; }
        .detail-content {
            background: var(--color-surface); border-radius: 16px;
            width: 100%; max-width: 500px; max-height: 85vh;
            display: flex; flex-direction: column;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .detail-header {
            padding: 20px; border-bottom: 1px solid #eee;
            display: flex; justify-content: space-between; align-items: flex-start;
        }
        .detail-title h2 { font-size: 1.5em; color: var(--color-primary); margin: 0; }
        .detail-close {
            background: #f0f0f0; border: none; width: 32px; height: 32px;
            border-radius: 50%; font-size: 20px; cursor: pointer; color: #666;
        }
        .detail-body { padding: 20px; overflow-y: auto; }
        .detail-card-item {
            margin-bottom: 16px; border: 1px solid #eee; border-radius: 8px; overflow: hidden;
        }
        .detail-card-item.best-card { border: 2px solid var(--color-success); background-color: #f6ffed; }
        .detail-card-header {
            padding: 10px 15px; background: #f9f9f9; font-weight: 600;
            display: flex; justify-content: space-between; align-items: center;
        }
        .detail-card-item.best-card .detail-card-header { background: #d9f7be; color: #237804; }
        .detail-card-body { padding: 12px 15px; }
        .rate-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
        .rate-val { font-weight: 700; font-size: 1.2em; }
        .detail-plan-info { font-size: 0.85em; color: #666; margin-top: 8px; padding-top: 8px; border-top: 1px dashed #ddd; }
        .plan-alert {
            color: #d35400; background: #fff7e6; padding: 4px 8px; border-radius: 4px;
            margin-top: 6px; display: inline-block; font-weight: 600; font-size: 0.9em;
        }
        
        @media (max-width: 480px) {
            body { padding: 15px; }
            h1 { font-size: 1.5em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ’³ ä¿¡ç”¨å¡å›é¥‹æŸ¥è©¢åŠ©æ‰‹ 2026</h1>

        <div class="form-section">
            <div class="info-text">
                ğŸ” <strong>2026å¹´æœ€æ–°æ¬Šç›Š</strong>ï¼šæ”¯æ´åœ‹æ³°CUBE(å››å¤§æ¬Šç›Š+ç˜‹å¤§æ¸¯)ã€å°æ–°Richart(ä¸ƒå¤§åˆ†é¡)ã€ç‰å±±Unicard(ç™¾å¤§ç‰¹åº—)ã€ç‰å±±UBear(å½±éŸ³10%)ã€æ°¸è±DAWHO(3.5%)ã€‚
            </div>
            
            <div class="form-group">
                <label for="searchMerchant">æœå°‹é€šè·¯åç¨±</label>
                <div class="input-wrapper">
                    <input type="text" id="searchMerchant" placeholder="ä¾‹å¦‚ï¼šChatGPTã€Klookã€éº¥ç•¶å‹..." autocomplete="off">
                    <button id="clearSearch" class="clear-btn" onclick="clearSearch()">âœ•</button>
                    <div id="suggestionDropdown" class="suggestion-dropdown"></div>
                </div>
            </div>
            
            <div style="margin-top: 10px;">
                <label>å¿«é€Ÿåˆ†é¡</label>
                <div class="category-tags" id="categoryTags"></div>
            </div>
        </div>

        <div id="merchantResults" class="results-section">
            <div id="merchantContainer"></div>
        </div>
    </div>

    <div id="detailModal" class="detail-modal" onclick="if(event.target === this) closeDetailModal()">
        <div class="detail-content">
            <div class="detail-header">
                <div class="detail-title">
                    <h2 id="modalTitle">é€šè·¯åç¨±</h2>
                    <div id="modalType" style="color:#888; font-size:0.9em; margin-top:4px;">åˆ†é¡</div>
                </div>
                <button class="detail-close" onclick="closeDetailModal()">âœ•</button>
            </div>
            <div id="detailBody" class="detail-body"></div>
        </div>
    </div>

    <script>
        // === å¡ç‰‡åŸºæœ¬è³‡æ–™ ===
        const cardData = {
            unicard: {
                name: 'ç‰å±± Unicard',
                plansDetails: [
                    'ç°¡å–®é¸ï¼šæ–¹æ¡ˆ2.0% + åŸºæœ¬1% = 3%',
                    'ä»»æ„é¸ï¼šæ–¹æ¡ˆ2.5% + åŸºæœ¬1% = 3.5%',
                    'UPé¸ï¼šæ–¹æ¡ˆ3.5% + åŸºæœ¬1% = 4.5%'
                ],
                maxRate: 0.045
            },
            dawho: {
                name: 'æ°¸è± DAWHO',
                fixedRate: 0.035
            },
            ubear: {
                name: 'ç‰å±± UBear',
                baseRate: 0.01,
                // ç‰¹æ®Šè¦†è“‹: å½±éŸ³10%, ä¸€èˆ¬ç¶²è³¼3%
            },
            richart: {
                name: 'å°æ–° Richart',
                baseRate: 0.003
            },
            cube: {
                name: 'åœ‹æ³° CUBE',
                baseRate: 0.003
            }
        };

        // === æ“´å……å¾Œçš„é€šè·¯è³‡æ–™åº« (2026/2027) ===
        const merchantDatabase = {
            // === AI å·¥å…· ===
            'ChatGPT': { category: 'digital', type: 'AIå·¥å…·', cards: { cube: 0.03, richart: 0.033, ubear: 0.03, unicard: false, dawho: true } },
            'Claude': { category: 'digital', type: 'AIå·¥å…·', cards: { cube: 0.03, richart: 0.033, ubear: 0.03, unicard: false, dawho: true } },
            'Notion': { category: 'digital', type: 'AIå·¥å…·', cards: { cube: 0.03, richart: 0.033, ubear: 0.03, unicard: false, dawho: true } },
            'Canva': { category: 'digital', type: 'AIå·¥å…·', cards: { cube: 0.03, richart: 0.033, ubear: 0.03, unicard: false, dawho: true } },
            'Perplexity': { category: 'digital', type: 'AIå·¥å…·', cards: { cube: 0.03, richart: 0.033, ubear: 0.03, unicard: false, dawho: true } },
            'Cursor': { category: 'digital', type: 'AIå·¥å…·', cards: { cube: 0.03, ubear: 0.03, unicard: false, dawho: true } },
            'Midjourney': { category: 'digital', type: 'AIå·¥å…·', cards: { ubear: 0.03, dawho: true } }, // CUBE/Richart æœªæ˜åˆ—ï¼Œèµ°ä¸€èˆ¬æˆ–ç¶²è³¼

            // === å½±éŸ³å¨›æ¨‚ ===
            'Netflix': { category: 'entertainment', type: 'å½±éŸ³', cards: { ubear: 0.10, cube: 0.03, richart: 0.033, dawho: true, unicard: false } },
            'Disney+': { category: 'entertainment', type: 'å½±éŸ³', cards: { ubear: 0.10, cube: 0.03, richart: 0.033, dawho: true, unicard: false } },
            'Spotify': { category: 'entertainment', type: 'å½±éŸ³', cards: { cube: 0.03, ubear: 0.03, dawho: true, unicard: false } },
            'YouTube Premium': { category: 'entertainment', type: 'å½±éŸ³', cards: { cube: 0.03, ubear: 0.03, dawho: true, unicard: false } },
            'Nintendo': { category: 'entertainment', type: 'éŠæˆ²', cards: { ubear: 0.10, richart: 0.033, dawho: true } },
            'PlayStation': { category: 'entertainment', type: 'éŠæˆ²', cards: { ubear: 0.10, richart: 0.033, dawho: true } },
            'Steam': { category: 'entertainment', type: 'éŠæˆ²', cards: { richart: 0.033, ubear: 0.03, dawho: true } },

            // === ç¶²è³¼å¹³å° ===
            'è¦çš®è³¼ç‰©': { category: 'shopping', type: 'ç¶²è³¼', aliases:['è¦çš®'], cards: { richart: 0.033, unicard: true, cube: 0.03, ubear: 0.03, dawho: true } },
            'momoè³¼ç‰©ç¶²': { category: 'shopping', type: 'ç¶²è³¼', aliases:['momo'], cards: { unicard: true, richart: 0.033, cube: 0.03, ubear: 0.03, dawho: true } },
            'PChome': { category: 'shopping', type: 'ç¶²è³¼', aliases:['PChome 24h'], cards: { richart: 0.033, ubear: 0.03, cube: 0.03, dawho: true } },
            'Coupang': { category: 'shopping', type: 'ç¶²è³¼', aliases:['é…·æ¾'], cards: { unicard: true, richart: 0.033, cube: 0.03, ubear: 0.03, dawho: true } },
            'æ·˜å¯¶': { category: 'shopping', type: 'ç¶²è³¼', aliases:['Taobao'], cards: { unicard: true, richart: 0.033, cube: 0.03, ubear: 0.03, dawho: true } },
            'Amazon': { category: 'shopping', type: 'ç¶²è³¼', cards: { richart: 0.033, ubear: 0.03, dawho: true } },

            // === è¶…å•†é‡è²© ===
            '7-11': { category: 'supermarket', type: 'è¶…å•†', aliases: ['7-ELEVEN'], cards: { cube: 0.02, richart: 0.038, dawho: true } }, // Richart Pay 3.8%
            'å…¨å®¶': { category: 'supermarket', type: 'è¶…å•†', cards: { unicard: false, cube: 0.02, richart: 0.038, dawho: true } }, // Richart Pay 3.8%
            'å…¨è¯': { category: 'supermarket', type: 'è¶…å¸‚', aliases:['å…¨è¯ç¦åˆ©ä¸­å¿ƒ'], cards: { cube: 0.02, richart: 0.033, ubear: 0.01, dawho: true } }, // å…¨è¯Ubearé™åˆ¶å¤š
            'å®¶æ¨‚ç¦': { category: 'supermarket', type: 'é‡è²©', cards: { unicard: true, cube: 0.02, richart: 0.033, dawho: true } },
            'IKEA': { category: 'home', type: 'å±…å®¶', aliases:['å®œå®¶å®¶å±…'], cards: { cube: 0.02, richart: 0.038, dawho: true, unicard: true } }, // Richart Pay 3.8%
            'LOPIA': { category: 'supermarket', type: 'è¶…å¸‚', cards: { cube: 0.02, richart: 0.033, dawho: true } },
            'å”å‰è»»å¾·': { category: 'supermarket', type: 'è¶…å¸‚', cards: { richart: 0.033, dawho: true } },

            // === æ—…éŠèˆ‡äº¤é€š ===
            'Klook': { category: 'travel', type: 'æ—…éŠ', cards: { cube: 0.035, richart: 0.033, unicard: true, ubear: 0.03, dawho: true } }, // CUBEç˜‹å¤§æ¸¯3.5
            'KKday': { category: 'travel', type: 'æ—…éŠ', cards: { cube: 0.03, richart: 0.033, unicard: true, ubear: 0.03, dawho: true } },
            'Agoda': { category: 'travel', type: 'è¨‚æˆ¿', cards: { cube: 0.03, richart: 0.033, unicard: true, ubear: 0.03, dawho: true } },
            'Booking.com': { category: 'travel', type: 'è¨‚æˆ¿', cards: { cube: 0.03, richart: 0.033, unicard: true, ubear: 0.03, dawho: true } },
            'Trip.com': { category: 'travel', type: 'è¨‚æˆ¿', cards: { cube: 0.03, richart: 0.033, unicard: true, dawho: true } },
            'Airbnb': { category: 'travel', type: 'è¨‚æˆ¿', cards: { cube: 0.03, richart: 0.033, ubear: 0.03, dawho: true } },
            
            'é«˜éµ': { category: 'transport', type: 'äº¤é€š', aliases:['å°ç£é«˜éµ'], cards: { unicard: true, cube: 0.035, richart: 0.033, ubear: 0.03, dawho: true } }, // CUBEç˜‹å¤§æ¸¯3.5
            'å°éµ': { category: 'transport', type: 'äº¤é€š', aliases:['å°ç£éµè·¯'], cards: { unicard: true, cube: 0.035, richart: 0.033, ubear: 0.03, dawho: true } }, // CUBEç˜‹å¤§æ¸¯3.5
            'Uber': { category: 'transport', type: 'äº¤é€š', cards: { unicard: true, cube: 0.03, richart: 0.033, ubear: 0.03, dawho: true } },
            'yoxi': { category: 'transport', type: 'äº¤é€š', cards: { unicard: true, cube: 0.03, richart: 0.033, dawho: true } },
            'å°ç£å¤§è»ŠéšŠ': { category: 'transport', type: 'äº¤é€š', aliases:['55688'], cards: { unicard: true, cube: 0.03, richart: 0.038, dawho: true } }, // Richart Pay 3.8%

            // === èˆªç©ºå…¬å¸ ===
            'ä¸­è¯èˆªç©º': { category: 'airline', type: 'èˆªç©º', cards: { unicard: true, cube: 0.03, richart: 0.033, ubear: 0.03, dawho: true } },
            'é•·æ¦®èˆªç©º': { category: 'airline', type: 'èˆªç©º', cards: { unicard: true, cube: 0.03, richart: 0.033, ubear: 0.03, dawho: true } },
            'æ˜Ÿå®‡èˆªç©º': { category: 'airline', type: 'èˆªç©º', cards: { cube: 0.03, richart: 0.033, dawho: true } },
            'å°ç£è™èˆª': { category: 'airline', type: 'èˆªç©º', cards: { unicard: true, cube: 0.03, richart: 0.033, ubear: 0.03, dawho: true } },
            'æ¨‚æ¡ƒèˆªç©º': { category: 'airline', type: 'èˆªç©º', cards: { unicard: true, cube: 0.03, richart: 0.033, dawho: true } },
            'æ—¥æœ¬èˆªç©º': { category: 'airline', type: 'èˆªç©º', cards: { unicard: true, cube: 0.03, richart: 0.033, dawho: true } },

            // === ç™¾è²¨èˆ‡æ™‚å°š ===
            'æ–°å…‰ä¸‰è¶Š': { category: 'department', type: 'ç™¾è²¨', cards: { richart: 0.038, unicard: true, cube: 0.03, dawho: true } }, // Richart Pay 3.8%
            'é æ±ç™¾è²¨': { category: 'department', type: 'ç™¾è²¨', cards: { unicard: true, cube: 0.03, richart: 0.033, dawho: true } },
            'SOGO': { category: 'department', type: 'ç™¾è²¨', aliases:['é æ±SOGO'], cards: { richart: 0.033, cube: 0.03, dawho: true } },
            'å°åŒ—101': { category: 'department', type: 'ç™¾è²¨', cards: { unicard: true, cube: 0.03, richart: 0.033, dawho: true } },
            'LaLaport': { category: 'department', type: 'å•†å ´', cards: { unicard: true, cube: 0.03, richart: 0.033, dawho: true } },
            'UNIQLO': { category: 'fashion', type: 'æœé£¾', cards: { unicard: true, richart: 0.033, dawho: true, cube: 0.003 } }, // CUBEç„¡åˆ—è¡¨, èµ°0.3
            'ZARA': { category: 'fashion', type: 'æœé£¾', cards: { ubear: 0.03, richart: 0.033, dawho: true } },
            'å±ˆè‡£æ°': { category: 'drugstore', type: 'è—¥å¦', cards: { unicard: true, cube: 0.03, richart: 0.033, ubear: 0.03, dawho: true } },
            'åº·æ˜¯ç¾': { category: 'drugstore', type: 'è—¥å¦', cards: { unicard: true, cube: 0.03, richart: 0.033, ubear: 0.03, dawho: true } },

            // === é¤é£²å¤–é€ ===
            'Uber Eats': { category: 'food', type: 'å¤–é€', cards: { unicard: true, cube: 0.03, richart: 0.033, ubear: 0.03, dawho: true } },
            'foodpanda': { category: 'food', type: 'å¤–é€', cards: { unicard: true, cube: 0.03, richart: 0.033, ubear: 0.03, dawho: true } },
            'éº¥ç•¶å‹': { category: 'food', type: 'é¤é£²', cards: { cube: 0.03, richart: 0.033, dawho: true } },
            'ç‹å“ç˜‹Pay': { category: 'food', type: 'é¤é£²', cards: { unicard: true, richart: 0.033, dawho: true } },
            'é¥—è³“': { category: 'food', type: 'é¤é£²', cards: { unicard: true, richart: 0.033, dawho: true } },

            // === åŠ æ²¹ ===
            'ä¸­æ²¹': { category: 'gas', type: 'åŠ æ²¹', aliases:['å°ç£ä¸­æ²¹'], cards: { unicard: true, cube: 0.02, richart: 0.033, dawho: true } },

            // === æŒ‡å®šé«˜é›„ä½å®¿ (CUBEç˜‹å¤§æ¸¯) ===
            'åŸå¸‚å•†æ—…': { category: 'hotel-ks', type: 'é«˜é›„ä½å®¿', cards: { cube: 0.035, richart: 0.033, dawho: true } },
            'å’Œé€¸é£¯åº—': { category: 'hotel-ks', type: 'é«˜é›„ä½å®¿', cards: { cube: 0.035, richart: 0.033, dawho: true } },
            'éº—å°Šé…’åº—': { category: 'hotel-ks', type: 'é«˜é›„ä½å®¿', cards: { cube: 0.035, richart: 0.033, dawho: true } },
        };

        const categories = [
            { id: 'all', name: 'å…¨éƒ¨', emoji: 'ğŸª' },
            { id: 'digital', name: 'AI/æ•¸ä½', emoji: 'ğŸ¤–' },
            { id: 'shopping', name: 'ç¶²è³¼', emoji: 'ğŸ›ï¸' },
            { id: 'travel', name: 'æ—…éŠè¨‚æˆ¿', emoji: 'âœˆï¸' },
            { id: 'supermarket', name: 'è¶…å•†é‡è²©', emoji: 'ğŸ›’' },
            { id: 'department', name: 'ç™¾è²¨', emoji: 'ğŸ¬' },
            { id: 'food', name: 'é¤é£²å¤–é€', emoji: 'ğŸ”' },
            { id: 'transport', name: 'äº¤é€š', emoji: 'ğŸš•' },
            { id: 'entertainment', name: 'å½±éŸ³éŠæˆ²', emoji: 'ğŸ®' }
        ];

        let currentCategory = 'all';

        // === æ™ºèƒ½æ–¹æ¡ˆå»ºè­°é‚è¼¯ (2026ç‰ˆ) ===
        function getPlanSuggestion(cardKey, category, merchantName, type) {
            
            // 1. åœ‹æ³° CUBE æ–¹æ¡ˆåˆ¤æ–·
            if (cardKey === 'cube') {
                // å¼·åˆ¶å„ªå…ˆï¼šç˜‹å¤§æ¸¯ (é«˜é›„æŒ‡å®š)
                if (['é«˜éµ', 'å°éµ', 'å°ç£é«˜éµ', 'å°ç£éµè·¯', 'Klook'].includes(merchantName)) return 'åˆ‡æ›ï¼šç˜‹å¤§æ¸¯(3.5%) æˆ– è¶£æ—…è¡Œ(3%)';
                if (category === 'hotel-ks') return 'åˆ‡æ›ï¼šç˜‹å¤§æ¸¯';

                // å¼·åˆ¶å„ªå…ˆï¼šé›†ç²¾é¸
                if (['IKEA', 'å…¨è¯', 'å®¶æ¨‚ç¦', '7-11', 'å…¨å®¶', 'ä¸­æ²¹'].some(k => merchantName.includes(k))) return 'åˆ‡æ›ï¼šé›†ç²¾é¸';

                // ä¸€èˆ¬é¡åˆ¥
                if (category === 'digital' || type === 'AIå·¥å…·' || type === 'ç¶²è³¼') return 'åˆ‡æ›ï¼šç©æ•¸ä½';
                if (type === 'å½±éŸ³') return 'åˆ‡æ›ï¼šç©æ•¸ä½';
                
                if (category === 'department' || category === 'drugstore' || category === 'food') return 'åˆ‡æ›ï¼šæ¨‚éŸ¿è³¼';
                if (merchantName.includes('Uber Eats') || merchantName.includes('foodpanda')) return 'åˆ‡æ›ï¼šæ¨‚éŸ¿è³¼';

                if (category === 'travel' || category === 'airline' || type === 'äº¤é€š') return 'åˆ‡æ›ï¼šè¶£æ—…è¡Œ';
                
                return 'è«‹ç¢ºèªAPPæ¬Šç›Š';
            }

            // 2. å°æ–° Richart æ–¹æ¡ˆåˆ¤æ–·
            if (cardKey === 'richart') {
                // Payè‘—åˆ· (3.8%) å„ªå…ˆåˆ¤æ–·
                if (['7-11', 'å…¨å®¶', 'IKEA', 'æ–°å…‰ä¸‰è¶Š', 'å°ç£å¤§è»ŠéšŠ'].some(k => merchantName.includes(k))) return 'ç¶å®šå°æ–°Pay (Payè‘—åˆ·)';

                // ä¸ƒå¤§åˆ†é¡
                if (category === 'digital' || type === 'ç¶²è³¼' || type === 'AIå·¥å…·' || type === 'å½±éŸ³' || type === 'éŠæˆ²') return 'åˆ‡æ›ï¼šæ•¸è¶£åˆ·';
                if (category === 'travel' || category === 'airline' || merchantName.includes('Uber') || merchantName.includes('é«˜éµ')) return 'åˆ‡æ›ï¼šç©æ—…åˆ·';
                if (category === 'supermarket' || merchantName.includes('å°éµ') || merchantName.includes('yoxi')) return 'åˆ‡æ›ï¼šå¤©å¤©åˆ·';
                if (category === 'department' || type === 'æœé£¾' || merchantName.includes('IKEA')) return 'åˆ‡æ›ï¼šå¤§ç­†åˆ·';
                if (category === 'food' || category === 'gas' || type === 'æ¨‚åœ’' || type === 'KTV') return 'åˆ‡æ›ï¼šå¥½é¥—åˆ·';
                
                return 'è«‹ç¢ºèªAPPæ¬Šç›Š';
            }
            return null;
        }

        // === æ ¸å¿ƒé‹ç®— ===
        function calculateCardMetrics(cardKey, dbValue, category, merchantName, type) {
            const cardInfo = cardData[cardKey];
            let displayRate = 0;
            let details = [];
            let planName = null;

            // 1. Unicard
            if (cardKey === 'unicard') {
                if (dbValue === true) { // åªæœ‰åœ¨åˆ—è¡¨å…§æ‰çµ¦å›é¥‹
                    displayRate = 0.045; 
                    details = cardInfo.plansDetails;
                } else {
                    displayRate = 0.01; // éæŒ‡å®šé€šè·¯åŸºæœ¬å›é¥‹ (å‡è¨­1%)
                    details.push('éæŒ‡å®šé€šè·¯ï¼šåŸºæœ¬å›é¥‹');
                }
            } 
            // 2. DAWHO
            else if (cardKey === 'dawho') {
                displayRate = 0.035; 
                details.push('åœ‹å…§æ¶ˆè²»çµ±ä¸€ 3.5%');
            }
            // 3. UBear
            else if (cardKey === 'ubear') {
                if (dbValue) {
                     displayRate = dbValue; // å¯èƒ½æ˜¯ 0.10, 0.03, 0.01
                } else {
                     displayRate = 0.01;
                }
                
                if (displayRate === 0.10) details.push('æŒ‡å®šå¨›æ¨‚ 10%');
                if (displayRate === 0.03) details.push('ç¶²è³¼/è¡Œå‹•æ”¯ä»˜ 3%');
                if (displayRate === 0.01) details.push('ä¸€èˆ¬æ¶ˆè²» 1%');
            }
            // 4. CUBE & Richart
            else {
                if (typeof dbValue === 'number') {
                    displayRate = dbValue;
                } else {
                     displayRate = cardInfo.baseRate || 0.003;
                }
                
                planName = getPlanSuggestion(cardKey, category, merchantName, type);
                if (planName) {
                    details.push(`<span class="plan-alert">âš ï¸ ${planName}</span>`);
                }
            }

            return {
                rate: displayRate,
                name: cardInfo.name,
                details: details,
                planName: planName
            };
        }

        // === UI é‚è¼¯ ===
        function init() {
            renderCategories();
            document.getElementById('searchMerchant').addEventListener('keyup', handleSearch);
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.input-wrapper')) {
                    document.getElementById('suggestionDropdown').style.display = 'none';
                }
            });
            filterByCategory('all');
        }

        function renderCategories() {
            const html = categories.map(c => 
                `<div class="category-tag ${c.id === 'all' ? 'active' : ''}" 
                      onclick="filterByCategory('${c.id}')">${c.emoji} ${c.name}</div>`
            ).join('');
            document.getElementById('categoryTags').innerHTML = html;
        }

        function filterByCategory(catId) {
            currentCategory = catId;
            document.querySelectorAll('.category-tag').forEach(el => {
                el.classList.toggle('active', el.textContent.includes(categories.find(c=>c.id===catId).name));
            });
            const results = [];
            Object.entries(merchantDatabase).forEach(([name, info]) => {
                if (catId === 'all' || info.category === catId || (catId === 'hotel-ks' && info.category === 'hotel-ks')) {
                    results.push({ name, ...info });
                }
            });
            renderResults(results);
        }

        function handleSearch(e) {
            const val = e.target.value.trim().toLowerCase();
            document.getElementById('clearSearch').style.display = val ? 'flex' : 'none';
            if (!val) {
                document.getElementById('suggestionDropdown').style.display = 'none';
                filterByCategory(currentCategory);
                return;
            }
            const matches = [];
            Object.entries(merchantDatabase).forEach(([name, info]) => {
                let hit = name.toLowerCase().includes(val);
                if (info.aliases) hit = hit || info.aliases.some(a => a.toLowerCase().includes(val));
                if (hit) matches.push({ name, ...info });
            });
            const dropdown = document.getElementById('suggestionDropdown');
            if (matches.length > 0 && matches.length < 8) {
                dropdown.innerHTML = matches.map(m => 
                    `<div class="suggestion-item" onclick="selectMerchant('${m.name}')">
                        ${m.name.replace(new RegExp(val, 'gi'), '<span class="highlight">$&</span>')} 
                        <span style="font-size:0.8em; color:#999">(${m.type})</span>
                    </div>`
                ).join('');
                dropdown.style.display = 'block';
            } else {
                dropdown.style.display = 'none';
            }
            renderResults(matches);
        }

        function clearSearch() {
            const input = document.getElementById('searchMerchant');
            input.value = '';
            input.focus();
            document.getElementById('clearSearch').style.display = 'none';
            document.getElementById('suggestionDropdown').style.display = 'none';
            filterByCategory(currentCategory);
        }

        function selectMerchant(name) {
            document.getElementById('searchMerchant').value = name;
            document.getElementById('suggestionDropdown').style.display = 'none';
            const info = merchantDatabase[name];
            renderResults([{ name, ...info }]);
        }

        function renderResults(list) {
            const container = document.getElementById('merchantContainer');
            if (list.length === 0) {
                container.innerHTML = '<div style="text-align:center; padding:40px; color:#999">æ‰¾ä¸åˆ°ç›¸é—œé€šè·¯</div>';
                return;
            }

            container.innerHTML = list.map(item => {
                const cards = Object.entries(item.cards).map(([key, value]) => {
                    return calculateCardMetrics(key, value, item.category, item.name, item.type);
                }).sort((a, b) => b.rate - a.rate);

                const bestCard = cards[0];
                const badgeHTML = cards.slice(0, 3).map((c, idx) => 
                    `<span class="card-badge ${idx === 0 ? 'best' : ''}">
                        ${c.name} ${(c.rate * 100).toFixed(1)}%
                    </span>`
                ).join('');

                return `
                    <div class="merchant-list" onclick="openDetailModal('${item.name}')">
                        <div class="merchant-header">
                            <span class="merchant-name">${item.name}</span>
                            <span class="merchant-type">${item.type}</span>
                        </div>
                        <div class="card-badges-row">${badgeHTML}</div>
                        <div class="best-tip">
                            ğŸ’¡ æœ€é«˜ï¼š${bestCard.name} 
                            ${bestCard.planName ? `<span class="plan-hint">(${bestCard.planName.split('ï¼š')[1] || bestCard.planName})</span>` : ''} 
                            ${(bestCard.rate * 100).toFixed(1)}%
                            <span style="margin-left:auto; color:#2180a0;">æŸ¥çœ‹è©³æƒ… â†’</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function openDetailModal(name) {
            const info = merchantDatabase[name];
            document.getElementById('modalTitle').innerText = name;
            document.getElementById('modalType').innerText = info.type;

            const cards = Object.entries(info.cards).map(([key, value]) => {
                return calculateCardMetrics(key, value, info.category, name, info.type);
            }).sort((a, b) => b.rate - a.rate);

            const html = cards.map((c, idx) => {
                const isBest = idx === 0;
                return `
                    <div class="detail-card-item ${isBest ? 'best-card' : ''}">
                        <div class="detail-card-header">
                            <span>${isBest ? 'ğŸ† ' : ''}${c.name}</span>
                            <span style="${isBest ? 'color:#237804' : ''}">${isBest ? 'æœ€åˆ’ç®—' : ''}</span>
                        </div>
                        <div class="detail-card-body">
                            <div class="rate-row">
                                <span style="color:#666">å›é¥‹ç‡</span>
                                <span class="rate-val" style="color:${isBest ? 'var(--color-success)' : 'var(--color-primary)'}">${(c.rate * 100).toFixed(1)}%</span>
                            </div>
                            
                            ${c.details.length ? `
                                <div class="detail-plan-info">
                                    ${c.details.map(d => `<div style="margin-bottom:4px;">â€¢ ${d}</div>`).join('')}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('detailBody').innerHTML = html;
            document.getElementById('detailModal').classList.add('show');
        }

        function closeDetailModal() {
            document.getElementById('detailModal').classList.remove('show');
        }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>