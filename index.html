<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ä¿¡ç”¨å¡å›é¥‹æŸ¥è©¢ 2026</title>
    <style>
        /* === åŸºç¤è¨­å®š === */
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        :root {
            --color-primary: #2180a0;
            --color-primary-light: #e3f2fd;
            --color-bg: #f4f7f6;
            --color-surface: #ffffff;
            --color-text: #333333;
            --color-border: #e0e0e0;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.06);
            --radius-md: 12px;

            /* === å“ç‰Œè‰²å®šç¾© (æœ€çµ‚å®šæ¡ˆ) === */
            --brand-richart: #e01a22; /* å°æ–°ç´… */
            --brand-cube: #00AA4F;    /* åœ‹æ³°ç¶  */
            --brand-unicard: #1890ff; /* ç‰å±±è— */
            --brand-ubear: #e6b800;   /* ç‰å±±é»ƒ */
            --brand-dawho: #2d3436;   /* æ°¸è±é»‘ */
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            padding: 20px;
            padding-bottom: 100px; /* æ‰‹æ©Ÿåº•éƒ¨å°è¦½åˆ—å®‰å…¨è·é›¢ */
            line-height: 1.5;
        }

        .container { max-width: 600px; margin: 0 auto; }
        
        /* æ¨™é¡Œèˆ‡ Header */
        header { text-align: center; margin-bottom: 20px; }
        h1 { color: var(--color-primary); font-size: 1.5rem; font-weight: 800; margin-bottom: 5px; }

        /* === å“ç‰Œåœ“é» (æ ¸å¿ƒä¿®æ”¹) === */
        .brand-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            flex-shrink: 0;
            vertical-align: middle;
        }

        /* === å°è¦½åˆ— (Bottom Nav) === */
        .nav-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 8px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            margin-bottom: 20px;
            position: sticky;
            top: 10px;
            z-index: 100;
        }

        .nav-item {
            flex: 1; text-align: center; padding: 10px; cursor: pointer;
            border-radius: 8px; font-weight: 600; color: #999;
            transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 6px;
        }
        
        .nav-item.active { background-color: var(--color-primary-light); color: var(--color-primary); }

        @media (max-width: 768px) {
            .nav-tabs {
                position: fixed; bottom: 0; top: auto; left: 0; right: 0;
                margin-bottom: 0; border-radius: 0; border-top: 1px solid #eee;
                padding-bottom: max(10px, env(safe-area-inset-bottom)); z-index: 999;
            }
            .nav-item { flex-direction: column; font-size: 0.75rem; gap: 2px; padding: 6px; }
            body { padding-top: 10px; }
        }

        .tab-content { display: none; opacity: 0; animation: fadeIn 0.3s forwards; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { to { opacity: 1; } }

        /* === è¡¨å–®å€åŸŸ === */
        .form-section {
            background: var(--color-surface); padding: 20px;
            border-radius: var(--radius-md); margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
        }

        .info-alert {
            background: #fff8e1; border-left: 4px solid #ffc107;
            padding: 12px; border-radius: 6px; font-size: 0.9rem; color: #856404;
            margin-bottom: 15px;
        }

        .input-group { position: relative; margin-bottom: 15px; }
        label { display: block; margin-bottom: 6px; font-weight: 600; font-size: 0.9rem; color: #555; }
        
        input[type="text"], input[type="number"], select {
            width: 100%; padding: 12px 40px 12px 14px;
            border: 1px solid var(--color-border); border-radius: 10px;
            font-size: 16px; background: #fff; appearance: none;
        }
        input:focus, select:focus { outline: none; border-color: var(--color-primary); box-shadow: 0 0 0 3px rgba(33, 128, 160, 0.15); }

        .clear-btn {
            position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
            background: #ddd; border: none; border-radius: 50%;
            width: 20px; height: 20px; line-height: 20px; text-align: center;
            font-size: 12px; color: #fff; cursor: pointer; display: none;
        }

        .suggestion-list {
            position: absolute; top: 100%; left: 0; right: 0;
            background: #fff; border: 1px solid #eee; border-radius: 0 0 10px 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); z-index: 50;
            max-height: 250px; overflow-y: auto; display: none;
        }
        .suggestion-item { padding: 12px 16px; border-bottom: 1px solid #f9f9f9; cursor: pointer; }
        .suggestion-item:active { background: #f0f0f0; }

        .controls-row { display: flex; gap: 10px; margin-bottom: 15px; }
        .control-item { flex: 1; }
        
        .toggle-btn {
            display: flex; align-items: center; justify-content: center;
            padding: 0 12px; height: 46px; background: #fff;
            border: 1px solid var(--color-border); border-radius: 10px;
            cursor: pointer; font-size: 0.9rem; user-select: none; transition: all 0.2s;
        }
        .toggle-btn.active { background: var(--color-primary-light); border-color: var(--color-primary); color: var(--color-primary); font-weight: 700; }
        .toggle-btn input { display: none; }
        .toggle-btn::before {
            content: ''; display: inline-block; width: 16px; height: 16px;
            border: 2px solid #ccc; border-radius: 4px; margin-right: 6px;
            transition: all 0.2s;
        }
        .toggle-btn.active::before { border-color: var(--color-primary); background: var(--color-primary); }

        .tag-cloud { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        .tag {
            padding: 6px 14px; background: #fff; border: 1px solid var(--color-border);
            border-radius: 20px; font-size: 0.85rem; color: #555; cursor: pointer;
        }
        .tag.active { background: var(--color-primary); color: #fff; border-color: var(--color-primary); }

        /* === åˆ—è¡¨èˆ‡å¡ç‰‡æ¨£å¼ === */
        .merchant-card {
            background: #fff; padding: 16px; border-radius: 12px;
            margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center;
            border-left: 5px solid #ccc; box-shadow: var(--shadow-sm);
            cursor: pointer; transition: transform 0.1s;
        }
        .merchant-card:active { transform: scale(0.98); }
        .merchant-info h3 { font-size: 1.1rem; margin-bottom: 4px; }
        .merchant-cat { font-size: 0.8rem; background: #eee; padding: 2px 8px; border-radius: 4px; color: #666; }
        
        .rate-block { text-align: right; }
        .rate-val { font-size: 1.5rem; font-weight: 800; color: #333; }
        .card-name-row { font-size: 0.85rem; color: #666; display: flex; align-items: center; justify-content: flex-end; margin-top: 4px; }

        /* === è©¦ç®—çµæœ === */
        .calc-btn {
            width: 100%; padding: 14px; background: var(--color-primary); color: white;
            border: none; border-radius: 12px; font-size: 1.1rem; font-weight: 700;
            box-shadow: 0 4px 10px rgba(33, 128, 160, 0.3); margin-top: 10px; cursor: pointer;
        }
        .calc-btn:active { transform: scale(0.98); }

        .result-item {
            background: #fff; padding: 15px; border-radius: 12px;
            margin-bottom: 12px; border: 1px solid #eee; border-left: 5px solid #ccc;
            display: grid; grid-template-columns: 30px 1fr auto; align-items: center; gap: 10px;
        }
        .result-rank { font-weight: 700; color: #bbb; font-size: 0.9rem; text-align: center; }
        .result-main h4 { font-size: 1rem; margin-bottom: 2px; }
        .result-desc { font-size: 0.8rem; color: #777; }
        .result-money { font-weight: 800; font-size: 1.2rem; text-align: right; }
        .result-money small { display: block; font-size: 0.7rem; color: #999; font-weight: normal; }

        /* å† è»æ¨£å¼ */
        .result-item.winner {
            background: #fff; box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.05); z-index: 10;
        }
        .result-item.winner .result-rank { font-size: 1.2rem; }
        
        /* å“ç‰Œè‰²æ‡‰ç”¨é¡åˆ¥ */
        .theme-richart { border-left-color: var(--brand-richart) !important; }
        .theme-richart.winner .result-money, .theme-richart.winner .result-rank { color: var(--brand-richart); }

        .theme-cube { border-left-color: var(--brand-cube) !important; }
        .theme-cube.winner .result-money, .theme-cube.winner .result-rank { color: var(--brand-cube); }

        .theme-unicard { border-left-color: var(--brand-unicard) !important; }
        .theme-unicard.winner .result-money, .theme-unicard.winner .result-rank { color: var(--brand-unicard); }

        .theme-ubear { border-left-color: var(--brand-ubear) !important; }
        /* é»ƒè‰²æ–‡å­—å¤ªæ·ºï¼Œæ”¹ç”¨æ·±é‡‘è‰²ä»¥åˆ©é–±è®€ */
        .theme-ubear.winner .result-money, .theme-ubear.winner .result-rank { color: #b8860b; }

        .theme-dawho { border-left-color: var(--brand-dawho) !important; }
        .theme-dawho.winner .result-money, .theme-dawho.winner .result-rank { color: var(--brand-dawho); }

        /* === æ¬Šç›Šç¸½è¦½ === */
        .accordion-item {
            background: #fff; border-radius: 12px; margin-bottom: 12px;
            border: 1px solid #eee; overflow: hidden; border-left: 5px solid #ccc;
        }
        .accordion-header {
            padding: 16px; display: flex; align-items: center; justify-content: space-between;
            cursor: pointer; font-weight: 700; color: #444;
        }
        .accordion-title { display: flex; align-items: center; }
        .accordion-body { display: none; padding: 0; background: #fafafa; border-top: 1px solid #eee; }
        .accordion-body.open { display: block; }
        .benefit-row { padding: 12px 16px; border-bottom: 1px solid #eee; font-size: 0.95rem; }

        /* === Modal å½ˆçª— === */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6); z-index: 2000;
            display: none; align-items: center; justify-content: center;
            backdrop-filter: blur(5px); padding: 20px;
        }
        .modal-overlay.show { display: flex; }
        .modal-content {
            background: #fff; width: 100%; max-width: 500px;
            border-radius: 16px; max-height: 80vh; display: flex; flex-direction: column;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3); animation: popIn 0.3s;
        }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .modal-header { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h3 { color: var(--color-primary); margin: 0; }
        .modal-close { background: #f5f5f5; border: none; width: 30px; height: 30px; border-radius: 50%; font-size: 18px; cursor: pointer; }
        .modal-body { padding: 20px; overflow-y: auto; }
        
        .detail-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px; background: #f9f9f9; border-radius: 8px; margin-bottom: 8px;
        }
        .detail-row.best { background: #f0f7ff; border: 1px solid #cce5ff; }

    </style>
</head>
<body>

    <header>
        <h1>ğŸ’³ å›é¥‹æŸ¥è©¢ 2026</h1>
    </header>

    <div class="container">
        <div class="nav-tabs">
            <div class="nav-item active" onclick="switchTab('search')">
                <span>ğŸ”</span> é€šè·¯æœå°‹
            </div>
            <div class="nav-item" onclick="switchTab('overview')">
                <span>ğŸ“‹</span> æ¬Šç›Šç¸½è¦½
            </div>
            <div class="nav-item" onclick="switchTab('calculator')">
                <span>ğŸ’°</span> å›é¥‹è©¦ç®—
            </div>
        </div>

        <div id="tab-search" class="tab-content active">
            <div class="form-section">
                <div class="info-alert">
                    ğŸ”¥ <strong>2026 é‡é»</strong>ï¼šUnicard æœ€é«˜ 7.5%ã€UBear ç¶²è³¼ 10%ã€‚
                </div>
                
                <div class="input-group">
                    <label>æœå°‹å•†å®¶</label>
                    <input type="text" id="searchMerchant" placeholder="ä¾‹å¦‚ï¼šå…¨å®¶ã€é«˜éµã€è¦çš®..." autocomplete="off" inputmode="search" enterkeyhint="search">
                    <button id="clearSearchBtn" class="clear-btn" onclick="clearInput('searchMerchant')">âœ•</button>
                    <div id="searchSuggestion" class="suggestion-list"></div>
                </div>

                <div class="controls-row">
                    <div class="control-item">
                        <select id="searchUnicardScheme" onchange="triggerUpdate('search')">
                            <option value="any" selected>Unicard: ä»»æ„é¸ (3.5%)</option>
                            <option value="simple">Unicard: ç°¡å–®é¸ (3.0%)</option>
                            <option value="up">Unicard: UPé¸ (4.5%)</option>
                        </select>
                    </div>
                    <div class="toggle-btn" id="searchNewUserBtn" onclick="toggleNewUser('search')">
                        <input type="checkbox" id="searchNewUser">
                        <span>æˆ‘æ˜¯æ–°æˆ¶</span>
                    </div>
                </div>

                <div class="tag-cloud" id="quickTags"></div>
            </div>

            <div id="searchResults">
                <div style="text-align: center; color: #999; padding: 20px;">
                    ğŸ‘‡ è¼¸å…¥å•†å®¶åç¨±æˆ–é»æ“Šä¸Šæ–¹åˆ†é¡
                </div>
            </div>
        </div>

        <div id="tab-overview" class="tab-content">
            <div id="overviewContainer"></div>
        </div>

        <div id="tab-calculator" class="tab-content">
            <div class="form-section">
                <div class="input-group">
                    <label>æ¶ˆè²»é‡‘é¡ ($)</label>
                    <input type="number" id="calcAmount" placeholder="ä¾‹å¦‚ï¼š20000" inputmode="numeric">
                </div>
                <div class="input-group">
                    <label>æ¶ˆè²»é€šè·¯</label>
                    <input type="text" id="calcMerchant" placeholder="ä¾‹å¦‚ï¼šUber Eats" autocomplete="off" inputmode="search">
                    <button id="clearCalcBtn" class="clear-btn" onclick="clearInput('calcMerchant')">âœ•</button>
                    <div id="calcSuggestion" class="suggestion-list"></div>
                </div>
                
                <div class="controls-row">
                    <div class="control-item">
                        <select id="calcUnicardScheme" onchange="calculateRewards()">
                            <option value="any" selected>Unicard: ä»»æ„é¸</option>
                            <option value="simple">Unicard: ç°¡å–®é¸</option>
                            <option value="up">Unicard: UPé¸</option>
                        </select>
                    </div>
                    <div class="toggle-btn" id="calcNewUserBtn" onclick="toggleNewUser('calc')">
                        <input type="checkbox" id="calcNewUser">
                        <span>æˆ‘æ˜¯æ–°æˆ¶</span>
                    </div>
                </div>

                <button class="calc-btn" onclick="calculateRewards()">é–‹å§‹è©¦ç®—</button>
            </div>
            <div id="calcResults"></div>
        </div>
    </div>

    <div id="detailModal" class="modal-overlay" onclick="if(event.target === this) closeModal()">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">è©³ç´°è³‡è¨Š</h3>
                <button class="modal-close" onclick="closeModal()">âœ•</button>
            </div>
            <div id="modalBody" class="modal-body"></div>
        </div>
    </div>

    <script>
        // === è³‡æ–™åº«è¨­å®š (å“ç‰Œè‰²æ›´æ–°) ===
        const brandConfig = {
            'richart': { color: '#e01a22', class: 'theme-richart' }, /* ç´… */
            'cube':    { color: '#00AA4F', class: 'theme-cube' },    /* åœ‹æ³°ç¶  (æ›´æ–°) */
            'unicard': { color: '#1890ff', class: 'theme-unicard' }, /* ç‰å±±è— (æ›´æ–°) */
            'ubear':   { color: '#e6b800', class: 'theme-ubear' },   /* é»ƒ */
            'dawho':   { color: '#2d3436', class: 'theme-dawho' }    /* é»‘ */
        };

        const cardData = [
            {
                id: 'richart', name: 'å°æ–° Richart', note: 'éœ€æ¯æ—¥Appåˆ‡æ›æ¬Šç›Š',
                benefits: [
                    { name: 'ä¸€èˆ¬æ¶ˆè²»', rate: 0.003, desc: 'åœ‹å…§å¤– 0.3%', type: 'text' },
                    { name: 'Payè‘—åˆ·', rate: 0.038, tag: 'pay', desc: 'å°æ–°Pay(è¶…å•†/ç™¾è²¨) | IKEA | å°ç£å¤§è»ŠéšŠ', categories: { 'å°æ–°Pay':['7-11', 'å…¨å®¶', 'æ–°å…‰ä¸‰è¶Š'], 'å°ç£Pay':['éº¥ç•¶å‹', 'å…¨åœ‹é›»å­'], 'äº¤é€š':['å°ç£å¤§è»ŠéšŠ'] } },
                    { name: 'æ•¸è¶£åˆ·', rate: 0.033, tag: 'digital', desc: 'ç¶²è³¼ | éŠæˆ² | AIæœå‹™', categories: { 'ç¶²è³¼':['è¦çš®', 'momo', 'é…·æ¾', 'PChome', 'æ·˜å¯¶', 'Amazon'], 'å½±éŸ³':['Netflix', 'Disney+', 'Youtube', 'Steam'], 'AI':['ChatGPT', 'Claude'] } },
                    { name: 'ç©æ—…åˆ·', rate: 0.033, tag: 'travel', desc: 'æµ·å¤– | èˆªç©º | è¨‚æˆ¿', categories: { 'æµ·å¤–':['æµ·å¤–æ¶ˆè²»','æ—¥æœ¬','éŸ“åœ‹'], 'è¨‚æˆ¿':['Agoda','Booking','Klook','KKday'], 'äº¤é€š':['Uber','Grab','Suica'] } },
                    { name: 'å¤©å¤©åˆ·', rate: 0.033, tag: 'daily', desc: 'è¶…å•† | äº¤é€š | è—¥å¦', categories: { 'è¶…å•†':['å…¨å®¶','7-11','å®¶æ¨‚ç¦'], 'äº¤é€š':['é«˜éµ','å°éµ','Uber'], 'è—¥å¦':['å±ˆè‡£æ°','åº·æ˜¯ç¾'] } },
                    { name: 'å¥½é¥—åˆ·', rate: 0.033, tag: 'fun', desc: 'é¤é£² | å¤–é€ | åŠ æ²¹', categories: { 'å¤–é€':['Uber Eats','foodpanda'], 'é¤é£²':['åœ‹å…§é¤é£²','éº¥ç•¶å‹'], 'åŠ æ²¹':['ä¸­æ²¹'] } },
                    { name: 'LINE Pay', rate: 0.023, tag: 'line', desc: 'LINE Pay ç¶å®š (2.3%)', categories: { 'è¡Œå‹•æ”¯ä»˜':['LINE Pay'] } }
                ]
            },
            {
                id: 'cube', name: 'åœ‹æ³° CUBE', note: 'éœ€Appåˆ‡æ›æ–¹æ¡ˆ',
                benefits: [
                    { name: 'ä¸€èˆ¬æ¶ˆè²»', rate: 0.003, desc: 'ä¸€èˆ¬æ¶ˆè²» 0.3%', type: 'text' },
                    { name: 'ç©æ•¸ä½', rate: 0.03, tag: 'digital', desc: 'ç¶²è³¼ | ä¸²æµ | åœ‹éš›é›»å•†', categories: { 'ç¶²è³¼':['è¦çš®','momo','PChome'], 'å½±éŸ³':['Netflix','Disney+','Spotify'] } },
                    { name: 'æ¨‚éŸ¿è³¼', rate: 0.03, tag: 'fun', desc: 'ç™¾è²¨ | é¤é£² | å¤–é€ | è—¥å¦', categories: { 'ç™¾è²¨':['SOGO','æ–°å…‰ä¸‰è¶Š','é æ±ç™¾è²¨','å°åŒ—101'], 'å¤–é€':['Uber Eats','foodpanda'], 'è—¥å¦':['åº·æ˜¯ç¾','å±ˆè‡£æ°'] } },
                    { name: 'è¶£æ—…è¡Œ', rate: 0.03, tag: 'travel', desc: 'æµ·å¤– | äº¤é€š | è¨‚æˆ¿', categories: { 'æµ·å¤–':['æµ·å¤–æ¶ˆè²»','æ—¥æœ¬','éŸ“åœ‹'], 'äº¤é€š':['é«˜éµ','Uber','ä¸­æ²¹'], 'è¨‚æˆ¿':['Agoda','Klook'] } },
                    { name: 'é›†ç²¾é¸', rate: 0.02, tag: 'base', desc: 'è¶…å•† | é‡è²© | ä¸­æ²¹', categories: { 'è¶…å•†':['å…¨å®¶','7-11'], 'é‡è²©':['å…¨è¯','å®¶æ¨‚ç¦'], 'åŠ æ²¹':['ä¸­æ²¹'] } }
                ]
            },
            {
                id: 'unicard', name: 'ç‰å±± Unicard', note: 'ç°¡å–®3% / ä»»æ„3.5% / UP4.5%',
                benefits: [
                    { name: 'ä¸€èˆ¬æ¶ˆè²»', rate: 0.01, desc: 'ä¸€èˆ¬æ¶ˆè²» 1%', type: 'text' },
                    { name: 'ç™¾å¤§ç‰¹åº—', rate: 0, tag: 'list', desc: 'è¡Œå‹•æ”¯ä»˜ | äº¤é€š | ç™¾è²¨ | é¤é£²', categories: { 'Pay':['LINE Pay','è¡—å£','æ‚ éŠä»˜'], 'äº¤é€š':['é«˜éµ','å°éµ','Uber','ä¸­æ²¹'], 'ç™¾è²¨':['æ–°å…‰ä¸‰è¶Š','é æ±'], 'é¤é£²':['Uber Eats','foodpanda','éº¥ç•¶å‹'], 'ç¶²è³¼':['momo','è¦çš®','æ·˜å¯¶','é…·æ¾'], 'æ—…éŠ':['è¯èˆª','é•·æ¦®','Agoda','Klook'] } }
                ]
            },
            {
                id: 'ubear', name: 'ç‰å±± UBear', note: 'æŒ‡å®šç¶²è³¼3% (æ–°æˆ¶10%)',
                benefits: [
                    { name: 'ä¸€èˆ¬æ¶ˆè²»', rate: 0.01, desc: 'ä¸€èˆ¬æ¶ˆè²» 1%', type: 'text' },
                    { name: 'å½±éŸ³å¨›æ¨‚', rate: 0.10, tag: 'ent', desc: 'Netflix | Disney+ | Nintendo', categories: { 'å½±éŸ³':['Netflix','Disney+','Nintendo','PlayStation'] } },
                    { name: 'ç¶²è³¼/Pay', rate: 0.03, tag: 'net', desc: 'ç¶²è³¼ | è¡Œå‹•æ”¯ä»˜ | è¨‚æˆ¿', categories: { 'Pay':['LINE Pay','è¡—å£'], 'ç¶²è³¼':['PChome','momo','è¦çš®','é…·æ¾'], 'äº¤é€š':['é«˜éµ','å°éµ','Uber','55688'], 'è¨‚æˆ¿':['Agoda','Klook'] } }
                ]
            },
            {
                id: 'dawho', name: 'æ°¸è± DAWHO', note: 'åœ‹å…§3.5% / åœ‹å¤–4.5% (éœ€å¤§æˆ¶ç­‰ç´š)',
                benefits: [
                    { name: 'ä¸€èˆ¬æ¶ˆè²»', rate: 0.01, desc: 'åœ‹å…§1% / åœ‹å¤–2%', type: 'text' },
                    { name: 'åœ‹å…§å…¨é€šè·¯', rate: 0.035, tag: 'all', desc: 'å…¨é€šè·¯å«ä»»å‹™', type: 'text' },
                    { name: 'åœ‹å¤–å…¨é€šè·¯', rate: 0.045, tag: 'foreign', desc: 'åœ‹å¤–æ¶ˆè²»å«ä»»å‹™', type: 'text' }
                ]
            }
        ];

        // é—œéµå­—å°æ‡‰
        const aliasMap = {
            'å°ä¸ƒ': '7-11', 'uber': 'Uber', 'ubereats': 'Uber Eats', 'ç†Šè²“': 'foodpanda',
            'line': 'LINE Pay', 'å…¨è¯': 'å…¨è¯', 'å®¶æ¨‚ç¦': 'å®¶æ¨‚ç¦', 'é«˜éµ': 'é«˜éµ', 'å°éµ': 'å°éµ',
            'æ—¥æœ¬': 'æ—¥æœ¬', 'éŸ“åœ‹': 'éŸ“åœ‹', 'ä¸­æ²¹': 'ä¸­æ²¹', 'éº¥ç•¶å‹': 'éº¥ç•¶å‹'
        };

        const quickCategories = [
            { name: 'ğŸª è¶…å•†é‡è²©', kws: ['è¶…å•†', 'é‡è²©', 'å…¨è¯'] },
            { name: 'ğŸ” é¤é£²å¤–é€', kws: ['é¤é£²', 'å¤–é€', 'ç¾é£Ÿ'] },
            { name: 'ğŸ›ï¸ ç¶²è³¼å¹³å°', kws: ['ç¶²è³¼', 'é›»å•†', 'è¦çš®'] },
            { name: 'ğŸš„ äº¤é€šæ—…éŠ', kws: ['äº¤é€š', 'æ—…éŠ', 'é«˜éµ', 'æµ·å¤–'] },
            { name: 'ğŸ’³ è¡Œå‹•æ”¯ä»˜', kws: ['Pay', 'æ”¯ä»˜'] }
        ];

        let merchantIndex = {};
        let activeTag = null;

        // === åˆå§‹åŒ– ===
        function init() {
            buildIndex();
            renderOverview();
            renderQuickTags();

            setupInput('searchMerchant', 'searchSuggestion', 'clearSearchBtn', (val) => {
                if(!val && !activeTag) document.getElementById('searchResults').innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">ğŸ‘‡ è¼¸å…¥å•†å®¶åç¨±æˆ–é»æ“Šä¸Šæ–¹åˆ†é¡</div>';
                else if (val) {
                    activeTag = null; document.querySelectorAll('.tag').forEach(t => t.classList.remove('active'));
                    renderSearchResults(val);
                }
            });
            setupInput('calcMerchant', 'calcSuggestion', 'clearCalcBtn', null);
        }

        function buildIndex() {
            cardData.forEach(card => {
                card.benefits.forEach(b => {
                    if (b.categories) {
                        Object.entries(b.categories).forEach(([cat, list]) => {
                            list.forEach(m => {
                                const key = m.toLowerCase();
                                if (!merchantIndex[key]) merchantIndex[key] = { name: m, cat: cat, cards: [] };
                                merchantIndex[key].cards.push({
                                    id: card.id, name: card.name, 
                                    rate: b.rate, scheme: b.name, tag: b.tag
                                });
                            });
                        });
                    }
                });
            });
        }

        function setupInput(inputId, suggestId, clearId, callback) {
            const input = document.getElementById(inputId);
            const suggest = document.getElementById(suggestId);
            const clearBtn = document.getElementById(clearId);

            input.addEventListener('input', (e) => {
                const val = e.target.value.trim().toLowerCase();
                clearBtn.style.display = val ? 'block' : 'none';
                
                if (val) {
                    const matches = new Set();
                    Object.keys(aliasMap).forEach(k => { if(k.includes(val)) matches.add(aliasMap[k]); });
                    Object.keys(merchantIndex).forEach(k => { if(k.includes(val)) matches.add(merchantIndex[k].name); });
                    
                    const list = Array.from(matches).slice(0, 6);
                    if(list.length) {
                        suggest.innerHTML = list.map(m => `<div class="suggestion-item" onclick="pickSuggest('${inputId}', '${m}')">${m}</div>`).join('');
                        suggest.style.display = 'block';
                    } else suggest.style.display = 'none';
                    
                    if(callback) callback(val);
                } else {
                    suggest.style.display = 'none';
                    if(callback) callback('');
                }
            });

            input.addEventListener('keyup', (e) => { if(e.key === 'Enter') input.blur(); });
        }

        function pickSuggest(inputId, val) {
            const input = document.getElementById(inputId);
            input.value = val;
            document.getElementById(inputId === 'searchMerchant' ? 'searchSuggestion' : 'calcSuggestion').style.display = 'none';
            if (inputId === 'searchMerchant') renderSearchResults(val);
            else if (inputId === 'calcMerchant') calculateRewards();
        }

        function clearInput(inputId) {
            const input = document.getElementById(inputId);
            input.value = ''; input.focus(); input.dispatchEvent(new Event('input'));
        }

        function renderQuickTags() {
            document.getElementById('quickTags').innerHTML = quickCategories.map(c => 
                `<div class="tag" onclick="filterTag(this, '${c.name}')">${c.name}</div>`
            ).join('');
        }

        function filterTag(el, tagName) {
            const input = document.getElementById('searchMerchant');
            if (activeTag === tagName) {
                activeTag = null; el.classList.remove('active');
                input.value = ''; renderSearchResults('');
            } else {
                activeTag = tagName;
                document.querySelectorAll('.tag').forEach(t => t.classList.remove('active'));
                el.classList.add('active');
                input.value = ''; 
                renderSearchResults(null, tagName);
            }
        }

        function toggleNewUser(mode) {
            const chk = document.getElementById(`${mode}NewUser`);
            const btn = document.getElementById(`${mode}NewUserBtn`);
            chk.checked = !chk.checked;
            btn.classList.toggle('active', chk.checked);
            
            if (mode === 'search') triggerUpdate('search');
            else calculateRewards();
        }

        function triggerUpdate(mode) {
            if (mode === 'search') {
                const val = document.getElementById('searchMerchant').value;
                if (val || activeTag) renderSearchResults(val, activeTag);
            }
        }

        function getCardListForMerchant(merchantName, isNewUser, uniScheme) {
            const key = merchantName ? merchantName.toLowerCase() : '';
            let rawData = merchantIndex[key];
            
            if (!rawData && merchantName) {
                const fuzzy = Object.keys(merchantIndex).find(k => k.includes(key) || key.includes(k));
                if (fuzzy) rawData = merchantIndex[fuzzy];
            }

            let cards = rawData ? JSON.parse(JSON.stringify(rawData.cards)) : [];
            const isForeign = ['åœ‹å¤–','æ—¥æœ¬','éŸ“åœ‹','æµ·å¤–'].some(k => merchantName.includes(k));

            if (!cards.find(c => c.id === 'dawho')) {
                cards.push({ id: 'dawho', name: 'æ°¸è± DAWHO', rate: isForeign?0.045:0.035, scheme: isForeign?'åœ‹å¤–æ¶ˆè²»':'åœ‹å…§æ¶ˆè²»', tag: isForeign?'foreign':'all' });
            }
            if (!rawData) {
                cards.push({ id: 'unicard', name: 'ç‰å±± Unicard', rate: 0.01, scheme: 'ä¸€èˆ¬æ¶ˆè²»', tag: 'gen' });
                cards.push({ id: 'ubear', name: 'ç‰å±± UBear', rate: 0.01, scheme: 'ä¸€èˆ¬æ¶ˆè²»', tag: 'gen' });
                cards.push({ id: 'richart', name: 'å°æ–° Richart', rate: 0.003, scheme: 'ä¸€èˆ¬æ¶ˆè²»', tag: 'gen' });
                cards.push({ id: 'cube', name: 'åœ‹æ³° CUBE', rate: 0.003, scheme: 'ä¸€èˆ¬æ¶ˆè²»', tag: 'gen' });
            }

            cards.forEach(c => {
                if (c.id === 'unicard' && c.tag === 'list') {
                    let rate = 0.035, txt = 'ä»»æ„é¸';
                    if (uniScheme === 'simple') { rate = 0.03; txt = 'ç°¡å–®é¸'; }
                    if (uniScheme === 'up') { rate = 0.045; txt = 'UPé¸'; }
                    const newBonusList = ['line pay','uber eats','å®¶æ¨‚ç¦','éŸ“åœ‹','å…¨ç›ˆ'];
                    if (isNewUser && newBonusList.some(kw => merchantName.toLowerCase().includes(kw))) {
                        rate += 0.03; txt += ' + æ–°æˆ¶';
                    }
                    c.rate = rate; c.scheme = txt;
                }
                if (c.id === 'ubear' && c.tag === 'net' && isNewUser) {
                    c.rate = 0.10; c.scheme = 'ç¶²è³¼/Pay + æ–°æˆ¶';
                }
            });

            return cards.sort((a,b) => b.rate - a.rate);
        }

        function renderSearchResults(query, filterTag) {
            const container = document.getElementById('searchResults');
            let results = [];
            const isNew = document.getElementById('searchNewUser').checked;
            const uniScheme = document.getElementById('searchUnicardScheme').value;

            if (filterTag) {
                const keywords = quickCategories.find(c => c.name === filterTag).kws;
                const matchedKeys = Object.keys(merchantIndex).filter(k => keywords.some(kw => merchantIndex[k].cat.includes(kw)));
                results = matchedKeys.map(k => ({ name: merchantIndex[k].name, cat: merchantIndex[k].cat }));
            } else if (query) {
                results = [{ name: query, cat: 'æœå°‹çµæœ' }];
            } else {
                container.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">ğŸ‘‡ è¼¸å…¥å•†å®¶åç¨±æˆ–é»æ“Šä¸Šæ–¹åˆ†é¡</div>';
                return;
            }

            if (results.length === 0) {
                container.innerHTML = '<div style="text-align:center; padding:20px; color:#999;">æŸ¥ç„¡è³‡æ–™</div>';
                return;
            }

            container.innerHTML = results.map(r => {
                const cards = getCardListForMerchant(r.name, isNew, uniScheme);
                const best = cards[0];
                const color = brandConfig[best.id]?.color || '#ccc';
                const theme = brandConfig[best.id]?.class || '';
                const cleanCards = JSON.stringify(cards).replace(/"/g, '&quot;');
                
                return `
                    <div class="merchant-card ${theme}" onclick="showDetail('${r.name}', '${cleanCards}')">
                        <div class="merchant-info">
                            <h3>${r.name}</h3>
                            <span class="merchant-cat">${r.cat}</span>
                        </div>
                        <div class="rate-block">
                            <div class="rate-val">${(best.rate*100).toFixed(1)}%</div>
                            <div class="card-name-row">
                                <span class="brand-dot" style="background:${color}"></span>${best.name}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function calculateRewards() {
            const amount = parseFloat(document.getElementById('calcAmount').value);
            const merchant = document.getElementById('calcMerchant').value;
            const isNew = document.getElementById('calcNewUser').checked;
            const uniScheme = document.getElementById('calcUnicardScheme').value;

            if (!amount || !merchant) return;

            const cards = getCardListForMerchant(merchant, isNew, uniScheme);
            
            const results = cards.map(c => {
                let reward = Math.floor(amount * c.rate);
                let note = `å…¨é¡ ${(c.rate*100).toFixed(1)}%`;
                if (c.id === 'dawho' && amount > 16000 && !c.tag.includes('foreign')) note += ' (æ³¨æ„ä¸Šé™)';
                return { ...c, reward, note };
            }).sort((a,b) => b.reward - a.reward);

            document.getElementById('calcResults').innerHTML = results.map((r, idx) => {
                const isWinner = idx === 0;
                const theme = brandConfig[r.id]?.class || '';
                const trophy = isWinner ? 'ğŸ† ' : `<span style="color:#ccc; font-weight:400">#${idx+1}</span> `;
                
                return `
                    <div class="result-item ${isWinner ? 'winner '+theme : ''}">
                        <div class="result-rank">${trophy}</div>
                        <div class="result-main">
                            <h4>${r.name}</h4>
                            <div class="result-desc">${r.scheme}</div>
                        </div>
                        <div class="result-money">
                            $${r.reward.toLocaleString()}
                            <small>${r.note}</small>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(`tab-${id}`).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.querySelector(`.nav-item[onclick="switchTab('${id}')"]`).classList.add('active');
        }

        function renderOverview() {
            const container = document.getElementById('overviewContainer');
            container.innerHTML = cardData.map(card => {
                const color = brandConfig[card.id].color;
                const theme = brandConfig[card.id].class;
                return `
                    <div class="accordion-item ${theme}">
                        <div class="accordion-header" onclick="this.nextElementSibling.classList.toggle('open')">
                            <div class="accordion-title">
                                <span class="brand-dot" style="background:${color}"></span>
                                <span>${card.name}</span>
                            </div>
                            <span>â–¼</span>
                        </div>
                        <div class="accordion-body">
                            <div class="benefit-row" style="background:#fffcf5; color:#856404; font-size:0.85rem;">ğŸ’¡ ${card.note}</div>
                            ${card.benefits.map(b => `
                                <div class="benefit-row">
                                    <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                                        <strong>${b.name}</strong>
                                        <strong style="color:${color}">${(b.rate*100).toFixed(1)}%</strong>
                                    </div>
                                    <div style="font-size:0.85rem; color:#666;">${b.desc}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showDetail(title, cardsJson) {
            const cards = JSON.parse(cardsJson);
            document.getElementById('modalTitle').innerText = title + ' å›é¥‹è©³æƒ…';
            document.getElementById('modalBody').innerHTML = cards.map((c, i) => `
                <div class="detail-row ${i===0 ? 'best' : ''}">
                    <div>
                        <div style="font-weight:700">${c.name} ${i===0?'ğŸ‘‘':''}</div>
                        <div style="font-size:0.85rem; color:#666;">${c.scheme}</div>
                    </div>
                    <div style="text-align:right">
                        <div style="font-weight:800; color:${i===0? brandConfig[c.id].color :'#333'}">${(c.rate*100).toFixed(1)}%</div>
                    </div>
                </div>
            `).join('');
            document.getElementById('detailModal').classList.add('show');
        }

        function closeModal() { document.getElementById('detailModal').classList.remove('show'); }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
