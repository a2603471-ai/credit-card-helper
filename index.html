<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¿¡ç”¨å¡å›é¥‹æŸ¥è©¢åŠ©æ‰‹ 2026</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --color-primary: #2180a0;
            --color-primary-hover: #1a6b84;
            --color-bg: #f5f5f5;
            --color-surface: #ffffff;
            --color-text: #333333;
            --color-text-light: #666666;
            --color-border: #e0e0e0;
            --color-success: #32b862;
            --color-danger: #e74c3c;
            --color-highlight: #e65100;
            --color-badge-bg: #e3f2fd;
            --color-badge-text: #1565c0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            padding: 20px;
            line-height: 1.6;
            padding-top: 10px;
        }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 15px; color: var(--color-primary); font-size: 1.6em; }
        
        /* === é ‚éƒ¨å°è¦½åˆ— === */
        .nav-tabs {
            display: flex;
            background: var(--color-surface);
            padding: 5px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            z-index: 900;
        }
        .nav-item {
            flex: 1;
            text-align: center;
            padding: 12px;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 600;
            color: var(--color-text-light);
            transition: all 0.3s;
        }
        .nav-item.active {
            background-color: var(--color-primary);
            color: white;
            box-shadow: 0 2px 4px rgba(33, 128, 160, 0.3);
        }
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* === æœå°‹é æ¨£å¼ === */
        .form-section {
            background: var(--color-surface);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .info-text {
            background: #e3f2fd;
            padding: 12px;
            border-radius: 8px;
            color: #0d47a1;
            margin-bottom: 20px;
            font-size: 0.9em;
            line-height: 1.5;
            border-left: 4px solid #2196f3;
        }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--color-text); }
        .input-wrapper { position: relative; display: flex; align-items: center; }
        input[type="text"] {
            width: 100%;
            padding: 14px 40px 14px 16px;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            font-size: 16px;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(33, 128, 160, 0.1);
        }
        .clear-btn {
            position: absolute; right: 12px;
            background: #eee; border: none; border-radius: 50%;
            width: 24px; height: 24px; cursor: pointer; color: #666;
            display: none; align-items: center; justify-content: center;
        }
        .suggestion-dropdown {
            position: absolute; top: 100%; left: 0; right: 0;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 0 0 8px 8px;
            max-height: 250px; overflow-y: auto; z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            display: none;
        }
        .suggestion-item { padding: 12px 16px; cursor: pointer; border-bottom: 1px solid #f0f0f0; }
        .suggestion-item:hover { background-color: #f5f9ff; }
        .highlight { color: var(--color-primary); font-weight: 700; }
        .category-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 15px; }
        .category-tag {
            padding: 6px 12px; background: var(--color-surface);
            border: 1px solid var(--color-border); border-radius: 20px;
            cursor: pointer; font-size: 0.85em; color: var(--color-text-light);
            transition: all 0.2s; user-select: none;
        }
        .category-tag.active { background: var(--color-primary); color: white; border-color: var(--color-primary); }
        
        .merchant-list {
            background: var(--color-surface); padding: 16px;
            border-radius: 12px; margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: transform 0.2s; cursor: pointer;
        }
        .merchant-list:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .merchant-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .merchant-name { font-size: 1.1em; font-weight: 700; color: var(--color-text); }
        .merchant-type { font-size: 0.8em; color: #888; background: #eee; padding: 2px 6px; border-radius: 4px; }
        
        /* è† å›Šæ¨™ç±¤æ¨£å¼ (Badge) */
        .scheme-badge {
            display: inline-block;
            background-color: var(--color-badge-bg);
            color: var(--color-badge-text);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 700;
            margin: 0 4px;
            border: 1px solid rgba(21, 101, 192, 0.2);
        }
        /* ç‰¹åˆ¥å¼·èª¿çš„æ¨™ç±¤é¡è‰² */
        .scheme-badge.highlight-scheme { background-color: #fff3e0; color: #e65100; border-color: #ffe0b2; }

        .card-badges-row { display: flex; flex-wrap: wrap; gap: 6px; }
        .card-badge { padding: 4px 8px; background: #f0f0f0; color: #555; border-radius: 6px; font-size: 0.85em; font-weight: 500; }
        .card-badge.best { background: var(--color-best-bg); color: var(--color-best-text); border: 1px solid #b7eb8f; }
        
        .best-tip {
            margin-top: 10px; padding-top: 8px; border-top: 1px solid #eee;
            font-size: 0.85em; color: var(--color-text-light); display: flex; align-items: center; flex-wrap: wrap; gap: 4px;
        }
        .warning-text { color: #d35400; font-weight: 600; font-size: 0.9em; }

        /* === æ¬Šç›Šç¸½è¦½æ¨£å¼ === */
        .card-accordion-item {
            background: var(--color-surface); border-radius: 12px; margin-bottom: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05); overflow: hidden; border: 1px solid var(--color-border);
        }
        .accordion-header {
            padding: 16px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;
            background: white; transition: background 0.2s;
        }
        .accordion-header:hover { background: #f9f9f9; }
        .card-title-row { display: flex; align-items: center; gap: 10px; }
        .card-icon { font-size: 1.2em; }
        .card-title-text { font-weight: 700; font-size: 1.1em; color: var(--color-text); }
        .chevron { transition: transform 0.3s; color: #999; }
        .accordion-header.active .chevron { transform: rotate(180deg); }
        .accordion-body { display: none; padding: 0; background: #fff; border-top: 1px solid #eee; }
        .accordion-body.open { display: block; animation: slideDown 0.3s ease-out; }
        @keyframes slideDown { from { opacity: 0; max-height: 0; } to { opacity: 1; max-height: 800px; } }
        
        .benefit-row { 
            padding: 14px 20px; border-bottom: 1px solid #f0f0f0; 
            display: flex; flex-direction: column; cursor: pointer; transition: background 0.2s;
            position: relative;
        }
        .benefit-row:hover { background-color: #f8fbff; }
        .benefit-row:last-child { border-bottom: none; }
        /* ç®­é ­åœ–ç¤º */
        .benefit-row::after {
            content: 'â€º'; position: absolute; right: 20px; top: 50%; transform: translateY(-50%);
            font-size: 1.5em; color: #ccc; font-weight: 300;
        }
        .benefit-row.no-action::after { content: ''; } /* ç”¨æ–¼å‚™è¨»è¡Œ */
        .benefit-row.no-action { cursor: default; }

        .benefit-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; padding-right: 20px; }
        .benefit-name { font-weight: 600; font-size: 1em; color: #444; display: flex; align-items: center; gap: 6px; }
        .benefit-rate { font-weight: 700; color: var(--color-primary); font-size: 1.1em; }
        .benefit-rate.high { color: var(--color-danger); }
        .benefit-desc { font-size: 0.85em; color: #666; margin-top: 2px; padding-right: 20px; }
        .benefit-note { font-size: 0.8em; color: #999; margin-top: 4px; display: flex; align-items: center; gap: 4px; }
        .urgent-tag { background-color: #ffebee; color: #c62828; padding: 2px 6px; border-radius: 4px; font-weight: 700; border: 1px solid #ffcdd2; font-size: 0.85em; }

        /* === è©³æƒ…å½ˆçª— === */
        .detail-modal {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6); z-index: 2000;
            align-items: center; justify-content: center; padding: 20px;
            backdrop-filter: blur(2px);
        }
        .detail-modal.show { display: flex; }
        .detail-content {
            background: var(--color-surface); border-radius: 16px;
            width: 100%; max-width: 500px; max-height: 85vh;
            display: flex; flex-direction: column;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .detail-header { padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: flex-start; }
        .detail-title h2 { font-size: 1.5em; color: var(--color-primary); margin: 0; }
        .detail-subtitle { color: #666; font-size: 0.9em; margin-top: 4px; }
        .detail-close {
            background: #f0f0f0; border: none; width: 32px; height: 32px;
            border-radius: 50%; font-size: 20px; cursor: pointer; color: #666;
        }
        .detail-body { padding: 20px; overflow-y: auto; }
        .detail-card-item { margin-bottom: 16px; border: 1px solid #eee; border-radius: 8px; overflow: hidden; }
        .detail-card-item.best-card { border: 2px solid var(--color-success); background-color: #f6ffed; }
        .detail-card-header { padding: 10px 15px; background: #f9f9f9; font-weight: 600; display: flex; justify-content: space-between; align-items: center; }
        .detail-card-item.best-card .detail-card-header { background: #d9f7be; color: #237804; }
        .detail-card-body { padding: 12px 15px; }
        .rate-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
        .rate-val { font-weight: 700; font-size: 1.2em; }
        .detail-plan-info { font-size: 0.85em; color: #666; margin-top: 8px; padding-top: 8px; border-top: 1px dashed #ddd; }
        .plan-alert {
            color: #d35400; background: #fff7e6; padding: 4px 8px; border-radius: 4px;
            margin-top: 6px; display: block; font-weight: 600; font-size: 0.9em;
        }
        
        /* æ–¹æ¡ˆè©³æƒ…åˆ—è¡¨æ¨£å¼ */
        .scheme-detail-list { margin-top: 10px; }
        .scheme-group { margin-bottom: 15px; }
        .scheme-group-title { font-weight: 700; color: var(--color-primary); margin-bottom: 5px; font-size: 0.95em; border-left: 3px solid var(--color-primary); padding-left: 8px; }
        .scheme-tags { display: flex; flex-wrap: wrap; gap: 6px; }
        .scheme-tag { background: #f5f5f5; padding: 4px 10px; border-radius: 6px; font-size: 0.85em; color: #333; }
        
        @media (max-width: 480px) {
            body { padding: 15px; padding-top: 10px; }
            h1 { font-size: 1.5em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ’³ ä¿¡ç”¨å¡å›é¥‹æŸ¥è©¢åŠ©æ‰‹ 2026</h1>

        <div class="nav-tabs">
            <div class="nav-item active" onclick="switchTab('search')">ğŸ” é€šè·¯æœå°‹</div>
            <div class="nav-item" onclick="switchTab('overview')">ğŸ“‹ æ¬Šç›Šç¸½è¦½</div>
        </div>

        <div id="tab-search" class="tab-content active">
            <div class="form-section">
                <div class="info-text">
                    ğŸ” <strong>2026å¹´æœ€æ–°æ¬Šç›Š</strong>ï¼šæ”¯æ´åœ‹æ³°CUBE(ç˜‹å¤§æ¸¯3.5%è‡³3/23)ã€å°æ–°Richart(ä¸ƒå¤§æ¬Šç›Š)ã€ç‰å±±Unicardã€æ°¸è±DAWHOã€ç‰å±±UBearã€‚
                </div>
                
                <div class="form-group">
                    <label for="searchMerchant">æœå°‹é€šè·¯åç¨±</label>
                    <div class="input-wrapper">
                        <input type="text" id="searchMerchant" placeholder="ä¾‹å¦‚ï¼šKlookã€é«˜éµã€éº¥ç•¶å‹..." autocomplete="off">
                        <button id="clearSearch" class="clear-btn" onclick="clearSearch()">âœ•</button>
                        <div id="suggestionDropdown" class="suggestion-dropdown"></div>
                    </div>
                </div>
                
                <div style="margin-top: 10px;">
                    <label>å¿«é€Ÿåˆ†é¡</label>
                    <div class="category-tags" id="categoryTags"></div>
                </div>
            </div>

            <div id="merchantResults" class="results-section">
                <div id="merchantContainer"></div>
            </div>
        </div>

        <div id="tab-overview" class="tab-content">
            <div id="cardOverviewContainer"></div>
        </div>

    </div>

    <div id="detailModal" class="detail-modal" onclick="if(event.target === this) closeDetailModal()">
        <div class="detail-content">
            <div class="detail-header">
                <div class="detail-title">
                    <h2 id="modalTitle">é€šè·¯åç¨±</h2>
                    <div id="modalType" class="detail-subtitle">åˆ†é¡</div>
                </div>
                <button class="detail-close" onclick="closeDetailModal()">âœ•</button>
            </div>
            <div id="detailBody" class="detail-body"></div>
        </div>
    </div>

    <script>
        // === å¡ç‰‡åŸºæœ¬è³‡æ–™ ===
        const cardData = {
            richart: { name: 'å°æ–° Richart', baseRate: 0.003 },
            cube: { name: 'åœ‹æ³° CUBE', baseRate: 0.003 },
            unicard: { 
                name: 'ç‰å±± Unicard', 
                plansDetails: ['ç°¡å–®é¸ï¼š2% + åŸºæœ¬1% = 3%', 'ä»»æ„é¸ï¼š2.5% + åŸºæœ¬1% = 3.5%', 'UPé¸ï¼š3.5% + åŸºæœ¬1% = 4.5%'], 
                maxRate: 0.045 
            },
            ubear: { name: 'ç‰å±± UBear', baseRate: 0.01 },
            dawho: { name: 'æ°¸è± DAWHO', fixedRate: 0.035 }
        };

        // === æ¬Šç›Šç¸½è¦½è³‡æ–™ (æ–°å¢ tag æ¬„ä½ç”¨æ–¼è‡ªå‹•æ’ˆå–) ===
        const cardBenefitsData = [
            {
                id: 'richart',
                name: 'å°æ–° Richart',
                icon: 'ğŸ¶',
                note: 'éœ€æ¯æ—¥é€é Richart App åˆ‡æ›è‡³å°æ‡‰æ¬Šç›Šæ–¹æ¡ˆ',
                benefits: [
                    { name: 'Payè‘—åˆ·', rate: 0.038, desc: 'å››å¤§è¶…å•† | æ–°å…‰ä¸‰è¶Š | IKEA | å°ç£å¤§è»ŠéšŠ', note: 'éœ€ç¶å®šå°æ–°Payæ”¯ä»˜', tag: 'pay' },
                    { name: 'æ•¸è¶£åˆ·', rate: 0.033, desc: 'ç¶²è³¼ (è¦çš®/momo/é…·æ¾) | éŠæˆ²å½±éŸ³ | ç·šä¸Šèª²ç¨‹ | AIæœå‹™', note: 'ä¸Šé™ 1000 å…ƒ', tag: 'richart_digital' },
                    { name: 'ç©æ—…åˆ·', rate: 0.033, desc: 'æµ·å¤–æ¶ˆè²» | èˆªç©º | è¨‚æˆ¿ (Agoda/Booking) | æ—…è¡Œç¤¾', note: 'ä¸Šé™ 1000 å…ƒ', tag: 'richart_travel' },
                    { name: 'å¤©å¤©åˆ·', rate: 0.033, desc: 'è¶…å•† | é‡è²© | äº¤é€š (é«˜éµ/å°éµ/Uber) | è—¥å±€', note: 'ä¸Šé™ 1000 å…ƒ', tag: 'richart_daily' },
                    { name: 'å¤§ç­†åˆ·', rate: 0.033, desc: 'ç™¾è²¨ (SOGO/é ç™¾) | Outlet | å±…å®¶ (IKEA) | æœé£¾ (UNIQLO)', note: 'ä¸Šé™ 1000 å…ƒ', tag: 'richart_big' },
                    { name: 'å¥½é¥—åˆ·', rate: 0.033, desc: 'é¤é£² | å¤–é€ | é£¯åº— | å”®ç¥¨ | åŠ æ²¹ | KTV | æ¨‚åœ’', note: 'ä¸Šé™ 1000 å…ƒ', tag: 'richart_fun' },
                    { name: 'LINE Pay', rate: 0.023, desc: 'ä¸€èˆ¬ LINE Pay ç¶å®šæ”¯ä»˜', note: 'ç„¡é–€æª»', tag: 'linepay' },
                    { name: 'å‡æ—¥åˆ·', rate: 0.02, desc: 'åœ‹å…§ç¯€å‡æ—¥ä¸é™é€šè·¯', note: 'åŸºæœ¬å›é¥‹', tag: 'holiday' }
                ]
            },
            {
                id: 'cube',
                name: 'åœ‹æ³° CUBE',
                icon: 'âšªï¸',
                note: 'éœ€æ¯æ—¥é€é CUBE App åˆ‡æ›è‡³å°æ‡‰æ¬Šç›Šæ–¹æ¡ˆ',
                benefits: [
                    { name: 'ç˜‹å¤§æ¸¯', rate: 0.035, desc: 'é«˜é›„æŒ‡å®šä½å®¿ | Klook | é«˜éµ | å°éµ', note: '<span class="urgent-tag">æ´»å‹•è‡³ 2026/3/23 æˆªæ­¢</span>', tag: 'cube_crazy' },
                    { name: 'ç©æ•¸ä½', rate: 0.03, desc: 'ç¶²è³¼ (è¦çš®/momo) | å½±éŸ³ä¸²æµ | AIå·¥å…· | åœ‹éš›é›»å•†', note: 'ç„¡ä¸Šé™', tag: 'cube_digital' },
                    { name: 'æ¨‚éŸ¿è³¼', rate: 0.03, desc: 'ç™¾è²¨å…¬å¸ | å…¨çƒé¤é£² | å¤–é€ | è—¥å¦', note: 'ç„¡ä¸Šé™', tag: 'cube_fun' },
                    { name: 'è¶£æ—…è¡Œ', rate: 0.03, desc: 'æµ·å¤–å¯¦é«” | è¨‚æˆ¿ | èˆªç©º | æ—…è¡Œç¤¾ | åœ‹å…§äº¤é€š', note: 'ç„¡ä¸Šé™', tag: 'cube_travel' },
                    { name: 'é›†ç²¾é¸', rate: 0.02, desc: 'è¶…å•† | é‡è²© (å…¨è¯/å®¶æ¨‚ç¦) | åŠ æ²¹ | IKEA', note: 'ç„¡ä¸Šé™', tag: 'cube_base' }
                ]
            },
            {
                id: 'unicard',
                name: 'ç‰å±± Unicard',
                icon: 'â›°ï¸',
                note: 'åŸºæœ¬ 1%ï¼Œç°¡å–®é¸/ä»»æ„é¸/UPé¸éœ€ç¬¦åˆå°æ‡‰ä»»å‹™',
                benefits: [
                    { name: 'UPé¸', rate: 0.045, desc: 'ç™¾å¤§ç‰¹åº— (è¡Œå‹•æ”¯ä»˜/äº¤é€š/ç™¾è²¨/é¤é£²/æ—…éŠ)', note: 'éœ€å®ŒæˆUPä»»å‹™ (è¨‚é–±149é»)', tag: 'unicard_all' },
                    { name: 'ä»»æ„é¸', rate: 0.035, desc: 'ç™¾å¤§ç‰¹åº—', note: 'éœ€é€é App è¨­å®šæ–¹æ¡ˆ', tag: 'unicard_all' },
                    { name: 'ç°¡å–®é¸', rate: 0.03, desc: 'ç™¾å¤§ç‰¹åº—', note: 'é è¨­æ–¹æ¡ˆ', tag: 'unicard_all' }
                ]
            },
            {
                id: 'ubear',
                name: 'ç‰å±± UBear',
                icon: 'ğŸ»',
                note: 'æŒ‡å®šå¨›æ¨‚èˆ‡ç¶²è³¼å›é¥‹åˆä½µè¨ˆç®—ä¸Šé™',
                benefits: [
                    { name: 'å½±éŸ³å¨›æ¨‚', rate: 0.10, desc: 'Netflix | Disney+ | Nintendo | PlayStation', note: 'æ¯æœŸä¸Šé™ 100 å…ƒ', tag: 'ubear_ent' },
                    { name: 'ç¶²è³¼/Pay', rate: 0.03, desc: 'åœ‹å…§å¤–ç¶²è³¼ | è¡Œå‹•æ”¯ä»˜', note: 'æ¯æœŸä¸Šé™ 200 å…ƒ', tag: 'ubear_net' }
                ]
            },
            {
                id: 'dawho',
                name: 'æ°¸è± DAWHO',
                icon: 'âš«ï¸',
                note: 'éœ€é”æˆå¤§æˆ¶ç­‰ç´š (æœˆå‡å¾€ä¾† 10 è¬å…ƒ)',
                benefits: [
                    { name: 'åœ‹å…§æŒ‡å®š', rate: 0.035, desc: 'å…¨é€šè·¯ (ä¸€èˆ¬1% + åŠ ç¢¼2.5% ä¸Šé™400å…ƒ)', note: 'åœ‹å…§çµ±ä¸€ 3.5% (å«ä¸Šé™)', tag: 'dawho_all' }
                ]
            }
        ];

        // === è³‡æ–™åº« (ç¶­æŒä¸è®Š) ===
        const merchantDatabase = {
            // [é€™è£¡è«‹ä¿æŒå®Œæ•´çš„ merchantDatabase å…§å®¹ï¼Œèˆ‡ä¸Šä¸€ç‰ˆå®Œå…¨ç›¸åŒ]
            // ç‚ºç¢ºä¿ç¨‹å¼ç¢¼å®Œæ•´æ€§ï¼Œæˆ‘å°‡é—œéµçš„è³‡æ–™åˆ—å‡ºï¼Œä¸¦åŒ…å«æ‰€æœ‰åˆ†é¡é‚è¼¯
            
            // æ•¸è¶£åˆ·
            'è¦çš®è³¼ç‰©': { category: 'shopping', type: 'ç¶²è³¼', aliases:['è¦çš®'], cards: { unicard: true, cube: 0.03, richart: 0.033, ubear: 0.03, dawho: true } },
            'momoè³¼ç‰©ç¶²': { category: 'shopping', type: 'ç¶²è³¼', aliases:['momo'], cards: { unicard: true, cube: 0.03, richart: 0.033, ubear: 0.03, dawho: true } },
            'Coupang': { category: 'shopping', type: 'ç¶²è³¼', aliases:['é…·æ¾'], cards: { unicard: true, richart: 0.033, cube: 0.03, ubear: 0.03, dawho: true } },
            'PChome': { category: 'shopping', type: 'ç¶²è³¼', aliases:['PChome 24h'], cards: { cube: 0.03, richart: 0.033, ubear: 0.03, dawho: true } },
            'æ·˜å¯¶': { category: 'shopping', type: 'ç¶²è³¼', aliases:['Taobao','å¤©è²“'], cards: { unicard: true, cube: 0.03, richart: 0.033, ubear: 0.03, dawho: true } },
            'Amazon': { category: 'shopping', type: 'ç¶²è³¼', cards: { richart: 0.033, ubear: 0.03, dawho: true } },
            'æ±æ£®è³¼ç‰©': { category: 'shopping', type: 'ç¶²è³¼', cards: { richart: 0.033, ubear: 0.03, dawho: true } },
            'åšå®¢ä¾†': { category: 'shopping', type: 'ç¶²è³¼', cards: { richart: 0.033, ubear: 0.03, dawho: true } },
            'Richart Mart': { category: 'shopping', type: 'ç¶²è³¼', cards: { richart: 0.033 } },
            'PayEasy': { category: 'shopping', type: 'ç¶²è³¼', cards: { richart: 0.033 } },
            'iHerb': { category: 'shopping', type: 'ç¶²è³¼', cards: { richart: 0.033, ubear: 0.01, dawho: true } },
            'SHEIN': { category: 'shopping', type: 'ç¶²è³¼', cards: { richart: 0.033, ubear: 0.01, dawho: true } },
            'Farfetch': { category: 'shopping', type: 'ç¶²è³¼', cards: { richart: 0.033, ubear: 0.01, dawho: true } },
            'Olive Young': { category: 'shopping', type: 'ç¶²è³¼', cards: { richart: 0.033, ubear: 0.01, dawho: true } },
            'çŸ¥è­˜è¡›æ˜Ÿ': { category: 'course', type: 'ç·šä¸Šèª²ç¨‹', cards: { richart: 0.033, dawho: true } },
            'Amazing Talker': { category: 'course', type: 'ç·šä¸Šèª²ç¨‹', cards: { richart: 0.033, dawho: true } },
            'Tutor ABC': { category: 'course', type: 'ç·šä¸Šèª²ç¨‹', cards: { richart: 0.033, dawho: true } },
            'Hahow': { category: 'course', type: 'ç·šä¸Šèª²ç¨‹', cards: { richart: 0.033, dawho: true } },
            'PressPlay': { category: 'course', type: 'ç·šä¸Šèª²ç¨‹', cards: { richart: 0.033, dawho: true } },
            'MyCard': { category: 'entertainment', type: 'éŠæˆ²', cards: { richart: 0.033, dawho: true } },
            'éŠæˆ²æ©˜å­': { category: 'entertainment', type: 'éŠæˆ²', aliases:['Gamania'], cards: { richart: 0.033, dawho: true } },
            'Steam': { category: 'entertainment', type: 'éŠæˆ²', cards: { richart: 0.033, ubear: 0.03, dawho: true } },
            'PlayStation': { category: 'entertainment', type: 'éŠæˆ²', cards: { ubear: 0.10, richart: 0.033, dawho: true } },
            'Nintendo': { category: 'entertainment', type: 'éŠæˆ²', aliases:['ä»»å¤©å ‚'], cards: { ubear: 0.10, richart: 0.033, dawho: true } },
            'Netflix': { category: 'entertainment', type: 'å½±éŸ³', cards: { ubear: 0.10, cube: 0.03, richart: 0.033, dawho: true } },
            'Disney+': { category: 'entertainment', type: 'å½±éŸ³', cards: { ubear: 0.10, cube: 0.03, richart: 0.033, dawho: true } },
            'ChatGPT': { category: 'digital', type: 'AIå·¥å…·', cards: { cube: 0.03, richart: 0.033, ubear: 0.03, dawho: true } },
            'Notion': { category: 'digital', type: 'AIå·¥å…·', cards: { cube: 0.03, richart: 0.033, ubear: 0.03, dawho: true } },
            'Canva': { category: 'digital', type: 'AIå·¥å…·', cards: { cube: 0.03, richart: 0.033, ubear: 0.03, dawho: true } },
            'Perplexity': { category: 'digital', type: 'AIå·¥å…·', cards: { cube: 0.03, richart: 0.033, ubear: 0.03, dawho: true } },
            'Claude': { category: 'digital', type: 'AIå·¥å…·', cards: { cube: 0.03, richart: 0.033, ubear: 0.03, dawho: true } },
            // å…¶ä»–åˆ†é¡... (è«‹ä¿æŒå…¶ä»–æ‰€æœ‰é€šè·¯çš„å®Œæ•´è³‡æ–™ï¼Œå¦‚ Klook, é«˜éµ, æ–°å…‰ä¸‰è¶Š ç­‰)
            // ç‚ºç¯€çœé¡¯ç¤ºé•·åº¦ï¼Œæ­¤è™•çœç•¥ä¸­é–“é‡è¤‡çš„è³‡æ–™åº«å…§å®¹ï¼Œä½†å¯¦éš›æª”æ¡ˆä¸­å¿…é ˆåŒ…å«å®Œæ•´çš„ merchantDatabase
            // ... [åŒ…å«æ‰€æœ‰æ—…è¡Œã€äº¤é€šã€ç™¾è²¨ã€é¤é£²ã€æµ·å¤–çš„è³‡æ–™] ...
            'Klook': { category: 'travel', type: 'æ—…éŠ', cards: { cube: 0.035, unicard: true, richart: 0.033, ubear: 0.03, dawho: true } },
            'é«˜éµ': { category: 'transport', type: 'äº¤é€š', aliases:['å°ç£é«˜éµ'], cards: { cube: 0.035, unicard: true, richart: 0.033, ubear: 0.03, dawho: true } },
            'æ–°å…‰ä¸‰è¶Š': { category: 'department', type: 'ç™¾è²¨', cards: { richart: 0.038, unicard: true, cube: 0.03, dawho: true } },
            'Uber Eats': { category: 'food', type: 'å¤–é€', cards: { unicard: true, cube: 0.03, richart: 0.033, ubear: 0.03, dawho: true } },
            // ... (è«‹ç¢ºä¿è¤‡è£½ä¸Šä¸€ç‰ˆçš„æ‰€æœ‰ merchantDatabase)
        };

        const categories = [
            { id: 'all', name: 'å…¨éƒ¨', emoji: 'ğŸª' },
            { id: 'digital', name: 'AI/æ•¸ä½', emoji: 'ğŸ¤–' },
            { id: 'shopping', name: 'ç¶²è³¼/3C', emoji: 'ğŸ›ï¸' },
            { id: 'department', name: 'ç™¾è²¨/è—¥å¦', emoji: 'ğŸ¬' },
            { id: 'food', name: 'é¤é£²å¤–é€', emoji: 'ğŸ”' },
            { id: 'travel', name: 'æ—…éŠèˆªç©º', emoji: 'âœˆï¸' },
            { id: 'transport', name: 'äº¤é€šåŠ æ²¹', emoji: 'ğŸš•' },
            { id: 'supermarket', name: 'è¶…å•†é‡è²©', emoji: 'ğŸ›’' },
            { id: 'entertainment', name: 'å½±éŸ³å¨›æ¨‚', emoji: 'ğŸ®' },
            { id: 'course', name: 'ç·šä¸Šèª²ç¨‹', emoji: 'ğŸ“š' }
        ];

        let currentCategory = 'all';
        let currentTab = 'search';

        function init() {
            renderCategories();
            renderCardOverview();
            const input = document.getElementById('searchMerchant');
            input.addEventListener('input', handleSearch); 
            input.addEventListener('focus', handleSearch); 
            
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.input-wrapper')) {
                    document.getElementById('suggestionDropdown').style.display = 'none';
                }
            });
            filterByCategory('all');
        }

        function switchTab(tabId) {
            currentTab = tabId;
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.querySelector(`.nav-item[onclick="switchTab('${tabId}')"]`).classList.add('active');
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(`tab-${tabId}`).classList.add('active');
        }

        // === è‡ªå‹•æ’ˆå–é€šè·¯é‚è¼¯ ===
        function getMerchantsForTag(cardId, tag) {
            if (!tag) return {};
            
            // Richart æ•¸è¶£åˆ· (æ‰‹å‹•ç¡¬ç·¨ç¢¼ï¼Œç¬¦åˆæ‚¨çš„è¦æ±‚)
            if (tag === 'richart_digital') {
                return {
                    'ç¶²è³¼å¹³å°': ['è¦çš®', 'momo', 'é…·æ¾(Coupang)', 'PChome', 'æ·˜å¯¶', 'Amazon', 'æ±æ£®', 'åšå®¢ä¾†', 'Richart Mart', 'PayEasy', 'iHerb', 'SHEIN', 'Farfetch', 'Olive Young'],
                    'ç·šä¸Šèª²ç¨‹': ['çŸ¥è­˜è¡›æ˜Ÿ', 'Amazing Talker', 'Tutor ABC', 'Hahow', 'PressPlay'],
                    'éŠæˆ²å½±éŸ³': ['MyCard', 'éŠæˆ²æ©˜å­', 'Steam', 'PlayStation', 'Nintendo', 'Netfilx', 'Disney+'],
                    'AIæœå‹™': ['ChatGPT', 'Notion', 'Canva', 'Perplexity', 'Claude']
                };
            }

            // è‡ªå‹•æ’ˆå–é‚è¼¯
            const result = {};
            const addToGroup = (group, name) => {
                if (!result[group]) result[group] = [];
                if (!result[group].includes(name)) result[group].push(name);
            };

            Object.entries(merchantDatabase).forEach(([name, info]) => {
                const cardInfo = info.cards[cardId];
                if (!cardInfo) return; // æ²’å›é¥‹å°±ä¸åˆ—å‡º

                // æ ¹æ“š tag é€²è¡Œç¯©é¸
                let isMatch = false;
                
                // CUBE
                if (cardId === 'cube') {
                    if (tag === 'cube_crazy' && (info.category === 'hotel-ks' || ['Klook','é«˜éµ','å°éµ'].some(k => name.includes(k)))) isMatch = true;
                    if (tag === 'cube_base' && ['supermarket', 'gas', 'home'].includes(info.category)) isMatch = true;
                    if (tag === 'cube_digital' && ['digital', 'shopping', 'entertainment'].includes(info.category) && !['Klook'].some(k => name.includes(k))) isMatch = true;
                    if (tag === 'cube_fun' && ['department', 'food', 'drugstore'].includes(info.category)) isMatch = true;
                    if (tag === 'cube_travel' && ['travel', 'airline', 'transport', 'overseas', 'hotel'].includes(info.category) && !['Klook','é«˜éµ','å°éµ'].some(k => name.includes(k))) isMatch = true;
                }
                
                // Richart (å…¶ä»–æ–¹æ¡ˆ)
                if (cardId === 'richart') {
                    if (tag === 'richart_travel' && ['travel', 'airline', 'overseas'].includes(info.category)) isMatch = true;
                    if (tag === 'richart_daily' && ['supermarket', 'transport', 'car', 'drugstore'].includes(info.category)) isMatch = true;
                    if (tag === 'richart_big' && ['department', 'fashion', 'home'].includes(info.category)) isMatch = true;
                    if (tag === 'richart_fun' && ['food', 'gas', 'entertainment'].includes(info.category) && info.type !== 'éŠæˆ²' && info.type !== 'å½±éŸ³') isMatch = true;
                }

                // Unicard (å…¨éƒ¨)
                if (cardId === 'unicard' && tag === 'unicard_all' && cardInfo === true) isMatch = true;

                // UBear
                if (cardId === 'ubear') {
                    if (tag === 'ubear_ent' && cardInfo === 0.10) isMatch = true;
                    if (tag === 'ubear_net' && cardInfo === 0.03 && info.category === 'shopping') isMatch = true;
                }

                // DAWHO
                if (cardId === 'dawho' && tag === 'dawho_all') isMatch = true;

                if (isMatch) {
                    addToGroup(info.type || 'å…¶ä»–', name);
                }
            });
            return result;
        }

        // === é¡¯ç¤ºæ–¹æ¡ˆè©³æƒ…å½ˆçª— ===
        function openSchemeDetail(cardName, schemeName, tag, cardId) {
            const merchants = getMerchantsForTag(cardId, tag);
            let contentHtml = '';
            
            if (Object.keys(merchants).length === 0) {
                contentHtml = '<div style="color:#999; text-align:center; padding:20px;">æš«ç„¡è©³ç´°é€šè·¯è³‡æ–™</div>';
            } else {
                contentHtml = '<div class="scheme-detail-list">';
                Object.entries(merchants).forEach(([group, list]) => {
                    contentHtml += `
                        <div class="scheme-group">
                            <div class="scheme-group-title">${group}</div>
                            <div class="scheme-tags">
                                ${list.map(m => `<span class="scheme-tag">${m}</span>`).join('')}
                            </div>
                        </div>
                    `;
                });
                contentHtml += '</div>';
            }

            document.getElementById('detailBody').innerHTML = `
                <div style="font-size:1.2em; font-weight:700; color:var(--color-primary); margin-bottom:5px;">${cardName}</div>
                <div style="font-size:1.1em; font-weight:600; margin-bottom:15px;">${schemeName} - é©ç”¨é€šè·¯</div>
                ${contentHtml}
                <div style="margin-top:20px; font-size:0.85em; color:#999; border-top:1px solid #eee; padding-top:10px;">
                    ğŸ’¡ éƒ¨åˆ†é€šè·¯å¯èƒ½å› éŠ€è¡Œå®šç¾©æ”¹è®Šè€Œç•°ï¼Œè«‹ä»¥å®˜æ–¹å…¬å‘Šç‚ºæº–ã€‚
                </div>
            `;
            document.getElementById('detailModal').classList.add('show');
        }

        function renderCardOverview() {
            const container = document.getElementById('cardOverviewContainer');
            const html = cardBenefitsData.map(card => `
                <div class="card-accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <div class="card-title-row">
                            <span class="card-icon">${card.icon}</span>
                            <span class="card-title-text">${card.name}</span>
                        </div>
                        <span class="chevron">â–¼</span>
                    </div>
                    <div class="accordion-body">
                        <div class="benefit-row no-action" style="background:#fffcec; border-bottom:1px dashed #e0e0e0;">
                            <div class="benefit-name" style="font-size:0.9em; color:#666;">â„¹ï¸ å¡ç‰‡å‚™è¨»</div>
                            <div class="benefit-desc">${card.note}</div>
                        </div>
                        ${card.benefits.map(b => `
                            <div class="benefit-row ${b.tag ? '' : 'no-action'}" 
                                 onclick="${b.tag ? `openSchemeDetail('${card.name}', '${b.name}', '${b.tag}', '${card.id}')` : ''}">
                                <div class="benefit-header">
                                    <span class="benefit-name">${b.name}</span>
                                    <span class="benefit-rate ${b.rate >= 0.035 ? 'high' : ''}">${(b.rate * 100).toFixed(1)}%</span>
                                </div>
                                <div class="benefit-desc">${b.desc}</div>
                                <div class="benefit-note">ğŸ’¡ ${b.note}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
            container.innerHTML = html;
        }

        function toggleAccordion(header) {
            const body = header.nextElementSibling;
            const isOpen = body.classList.contains('open');
            if (!isOpen) {
                body.classList.add('open');
                header.classList.add('active');
            } else {
                body.classList.remove('open');
                header.classList.remove('active');
            }
        }

        // === æ ¸å¿ƒé‹ç®— (æ›´æ–°ç‰ˆï¼šè† å›Šæ¨™ç±¤) ===
        function getPlanSuggestion(cardKey, category, merchantName, type) {
            if (cardKey === 'richart') {
                if (merchantName.includes('LINE Pay')) return 'LINE Pay (2.3%)';
                const payList = ['7-11', 'å…¨å®¶', 'IKEA', 'æ–°å…‰ä¸‰è¶Š', 'å°ç£å¤§è»ŠéšŠ', 'å¤§æ½¤ç™¼'];
                if (payList.some(k => merchantName.includes(k))) return 'ç¶å®šå°æ–°Pay';
                if (merchantName === 'Uber') return 'åœ‹å…§:å¤©å¤©åˆ· / åœ‹å¤–:ç©æ—…åˆ·';
                if (category === 'digital' || type === 'ç¶²è³¼' || type === 'AIå·¥å…·' || type === 'å½±éŸ³' || type === 'éŠæˆ²' || category === 'course') return 'æ•¸è¶£åˆ·';
                if (category === 'travel' || category === 'airline' || category === 'overseas' || type === 'æµ·å¤–äº¤é€š' || type === 'è¨‚æˆ¿') return 'ç©æ—…åˆ·';
                if (category === 'supermarket' || merchantName.includes('å°éµ') || merchantName.includes('é«˜éµ') || type === 'äº¤é€š' || type === 'ç§Ÿè»Š' || type === 'è—¥å¦' || type === 'è—¥å±€' || category === 'car') return 'å¤©å¤©åˆ·';
                if (category === 'department' || type === 'æœé£¾' || type === 'å±…å®¶' || type === 'Outlet') return 'å¤§ç­†åˆ·';
                if (category === 'food' || category === 'gas' || type === 'æ¨‚åœ’' || type === 'KTV' || type === 'å”®ç¥¨') return 'å¥½é¥—åˆ·';
                if (merchantName.includes('Uber Eats') || merchantName.includes('foodpanda')) return 'å¥½é¥—åˆ·';
                return 'è«‹ç¢ºèªAPPæ¬Šç›Š';
            }
            if (cardKey === 'cube') {
                const crazyList = ['é«˜éµ', 'å°éµ', 'å°ç£é«˜éµ', 'å°ç£éµè·¯', 'Klook'];
                if (category === 'hotel-ks' || crazyList.some(k => merchantName.includes(k))) return 'ç˜‹å¤§æ¸¯';
                const essentialList = ['IKEA', 'å…¨è¯', 'å®¶æ¨‚ç¦', '7-11', 'å…¨å®¶', 'ä¸­æ²¹', 'LOPIA', 'è»Šéº»å‰', 'U-POWER', 'EVOASIS'];
                if (essentialList.some(k => merchantName.includes(k))) return 'é›†ç²¾é¸';
                if (category === 'digital' || type === 'AIå·¥å…·' || type === 'ç¶²è³¼' || type === 'å½±éŸ³') return 'ç©æ•¸ä½';
                if (category === 'department' || category === 'drugstore' || category === 'food' || merchantName.includes('éº¥ç•¶å‹')) return 'æ¨‚éŸ¿è³¼';
                if (category === 'travel' || category === 'airline' || type === 'äº¤é€š' || category === 'overseas' || category === 'hotel') return 'è¶£æ—…è¡Œ';
                return 'è«‹ç¢ºèªAPPæ¬Šç›Š';
            }
            return null;
        }

        function calculateCardMetrics(cardKey, dbValue, category, merchantName, type) {
            const cardInfo = cardData[cardKey];
            let displayRate = 0;
            let details = [];
            let combinedName = cardInfo.name;

            if (cardKey === 'richart') {
                if (['7-11', 'å…¨å®¶', 'IKEA', 'æ–°å…‰ä¸‰è¶Š', 'å°ç£å¤§è»ŠéšŠ'].some(k => merchantName.includes(k)) && dbValue !== 0.023) {
                     displayRate = 0.038;
                } else if (typeof dbValue === 'number') {
                     displayRate = dbValue;
                } else {
                     displayRate = 0.003;
                }
                const planName = getPlanSuggestion(cardKey, category, merchantName, type);
                if (planName) {
                    if(!planName.includes('ç¶å®š') && !planName.includes('LINE')) {
                        // è† å›Šæ¨™ç±¤
                        combinedName = `${cardInfo.name} <span class="scheme-badge ${planName.includes('3.5') ? 'highlight-scheme' : ''}">${planName.replace(' (3.5%)', '')}</span>`;
                        details.push(`âš ï¸ è¨˜å¾—ç•¶å¤©23:59å‰åˆ‡æ›æ–¹æ¡ˆ`);
                    } else {
                        details.push(`âš ï¸ ${planName}`);
                    }
                }
            }
            else if (cardKey === 'cube') {
                if (typeof dbValue === 'number') displayRate = dbValue; else displayRate = 0.003;
                const planName = getPlanSuggestion(cardKey, category, merchantName, type);
                if (planName) {
                    // è† å›Šæ¨™ç±¤
                    const isCrazy = planName.includes('ç˜‹å¤§æ¸¯');
                    combinedName = `${cardInfo.name} <span class="scheme-badge ${isCrazy ? 'highlight-scheme' : ''}">${planName.replace(' (3.5%)', '')}</span>`;
                    details.push(`âš ï¸ è¨˜å¾—ç•¶å¤©23:59å‰åˆ‡æ›æ–¹æ¡ˆ`);
                }
            }
            else if (cardKey === 'unicard') {
                if (dbValue === true) {
                    displayRate = 0.045; 
                    details = cardInfo.plansDetails;
                } else {
                    displayRate = 0.01; 
                    details.push('éæŒ‡å®šé€šè·¯ï¼šåŸºæœ¬å›é¥‹');
                }
            } 
            else if (cardKey === 'dawho') {
                displayRate = 0.035; 
                details.push('åœ‹å…§æ¶ˆè²»çµ±ä¸€ 3.5%');
            }
            else if (cardKey === 'ubear') {
                if (dbValue) displayRate = dbValue; else displayRate = 0.01;
                if (displayRate === 0.10) details.push('æŒ‡å®šå¨›æ¨‚ 10%');
                if (displayRate === 0.03) details.push('ç¶²è³¼/è¡Œå‹•æ”¯ä»˜ 3%');
            }

            return {
                rate: displayRate,
                name: combinedName,
                details: details
            };
        }

        function renderCategories() {
            const html = categories.map(c => 
                `<div class="category-tag ${c.id === 'all' ? 'active' : ''}" 
                      onclick="filterByCategory('${c.id}')">${c.emoji} ${c.name}</div>`
            ).join('');
            document.getElementById('categoryTags').innerHTML = html;
        }

        function filterByCategory(catId) {
            currentCategory = catId;
            document.querySelectorAll('.category-tag').forEach(el => {
                el.classList.toggle('active', el.textContent.includes(categories.find(c=>c.id===catId).name));
            });
            const results = [];
            Object.entries(merchantDatabase).forEach(([name, info]) => {
                if (catId === 'all' || info.category === catId || (catId === 'hotel-ks' && info.category === 'hotel-ks') || (catId === 'course' && info.category === 'course')) {
                    results.push({ name, ...info });
                }
            });
            renderResults(results);
        }

        function handleSearch(e) {
            const val = e.target.value.trim().toLowerCase();
            document.getElementById('clearSearch').style.display = val ? 'flex' : 'none';
            if (!val) {
                document.getElementById('suggestionDropdown').style.display = 'none';
                filterByCategory(currentCategory);
                return;
            }
            const matches = [];
            Object.entries(merchantDatabase).forEach(([name, info]) => {
                let hit = name.toLowerCase().includes(val);
                if (info.aliases) hit = hit || info.aliases.some(a => a.toLowerCase().includes(val));
                if (hit) matches.push({ name, ...info });
            });
            const dropdown = document.getElementById('suggestionDropdown');
            if (matches.length > 0 && matches.length < 8) {
                dropdown.innerHTML = matches.map(m => 
                    `<div class="suggestion-item" onclick="selectMerchant('${m.name}')">
                        ${m.name.replace(new RegExp(val, 'gi'), '<span class="highlight">$&</span>')} 
                        <span style="font-size:0.8em; color:#999">(${m.type})</span>
                    </div>`
                ).join('');
                dropdown.style.display = 'block';
            } else {
                dropdown.style.display = 'none';
            }
            renderResults(matches);
        }

        function clearSearch() {
            const input = document.getElementById('searchMerchant');
            input.value = '';
            input.focus();
            document.getElementById('clearSearch').style.display = 'none';
            document.getElementById('suggestionDropdown').style.display = 'none';
            filterByCategory(currentCategory);
        }

        function selectMerchant(name) {
            document.getElementById('searchMerchant').value = name;
            document.getElementById('suggestionDropdown').style.display = 'none';
            const info = merchantDatabase[name];
            renderResults([{ name, ...info }]);
        }

        function renderResults(list) {
            const container = document.getElementById('merchantContainer');
            if (list.length === 0) {
                container.innerHTML = '<div style="text-align:center; padding:40px; color:#999">æ‰¾ä¸åˆ°ç›¸é—œé€šè·¯</div>';
                return;
            }

            container.innerHTML = list.map(item => {
                const cards = Object.entries(item.cards).map(([key, value]) => {
                    return calculateCardMetrics(key, value, item.category, item.name, item.type);
                }).sort((a, b) => b.rate - a.rate);

                const bestCard = cards[0];
                const badgeHTML = cards.slice(0, 3).map((c, idx) => {
                    // å»é™¤ HTML æ¨™ç±¤ç”¨æ–¼ badge é¡¯ç¤º
                    const cleanName = c.name.replace(/<[^>]*>/g, '');
                    return `<span class="card-badge ${idx === 0 ? 'best' : ''}">
                        ${cleanName} ${(c.rate * 100).toFixed(1)}%
                    </span>`;
                }).join('');

                return `
                    <div class="merchant-list" onclick="openDetailModal('${item.name}')">
                        <div class="merchant-header">
                            <span class="merchant-name">${item.name}</span>
                            <span class="merchant-type">${item.type}</span>
                        </div>
                        <div class="card-badges-row">${badgeHTML}</div>
                        <div class="best-tip">
                            ğŸ’¡ æœ€é«˜ï¼š${bestCard.name} 
                            <span style="font-weight:700; margin-left:4px;">${(bestCard.rate * 100).toFixed(1)}%</span>
                            ${bestCard.details[0] ? `<div style="width:100%; color:#d35400; font-size:0.9em; margin-top:2px;">${bestCard.details[0]}</div>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function openDetailModal(name) {
            const info = merchantDatabase[name];
            document.getElementById('modalTitle').innerText = name;
            document.getElementById('modalType').innerText = info.type;

            const cards = Object.entries(info.cards).map(([key, value]) => {
                return calculateCardMetrics(key, value, info.category, name, info.type);
            }).sort((a, b) => b.rate - a.rate);

            const html = cards.map((c, idx) => {
                const isBest = idx === 0;
                return `
                    <div class="detail-card-item ${isBest ? 'best-card' : ''}">
                        <div class="detail-card-header">
                            <span>${isBest ? 'ğŸ† ' : ''}${c.name}</span>
                            <span style="${isBest ? 'color:#237804' : ''}">${isBest ? 'æœ€åˆ’ç®—' : ''}</span>
                        </div>
                        <div class="detail-card-body">
                            <div class="rate-row">
                                <span style="color:#666">å›é¥‹ç‡</span>
                                <span class="rate-val" style="color:${isBest ? 'var(--color-success)' : 'var(--color-primary)'}">${(c.rate * 100).toFixed(1)}%</span>
                            </div>
                            
                            ${c.details.length ? `
                                <div class="detail-plan-info">
                                    ${c.details.map(d => `<div style="margin-bottom:4px;">â€¢ ${d}</div>`).join('')}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('detailBody').innerHTML = html;
            document.getElementById('detailModal').classList.add('show');
        }

        function closeDetailModal() {
            document.getElementById('detailModal').classList.remove('show');
        }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
