<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¿¡ç”¨å¡å›é¥‹æŸ¥è©¢åŠ©æ‰‹ 2026</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --color-primary: #2180a0;
            --color-primary-hover: #1a6b84;
            --color-bg: #f5f5f5;
            --color-surface: #ffffff;
            --color-text: #333333;
            --color-text-light: #666666;
            --color-border: #e0e0e0;
            --color-success: #2e7d32;
            --color-success-bg: #e8f5e9;
            --color-success-border: #a5d6a7;
            --color-danger: #e74c3c;
            --color-badge-bg: #e3f2fd;
            --color-badge-text: #1565c0;
            --tag-bg: #f0f2f5;
            --tag-text: #444;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            padding: 20px;
            line-height: 1.6;
            padding-top: 10px;
            padding-bottom: 80px;
        }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 15px; color: var(--color-primary); font-size: 1.6em; }
        
        /* === å°è¦½åˆ— === */
        .nav-tabs {
            display: flex; background: var(--color-surface); padding: 5px;
            border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 20px; position: sticky; top: 0; z-index: 900;
        }
        .nav-item {
            flex: 1; text-align: center; padding: 12px; cursor: pointer;
            border-radius: 8px; font-weight: 600; color: var(--color-text-light); transition: all 0.2s;
        }
        .nav-item.active { background-color: var(--color-primary); color: white; box-shadow: 0 2px 4px rgba(33, 128, 160, 0.3); }
        .tab-content { display: none; animation: fadeIn 0.2s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* === æœå°‹èˆ‡è¼¸å…¥å€å¡Š === */
        .form-section {
            background: var(--color-surface); padding: 20px;
            border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .info-text {
            background: #e3f2fd; padding: 12px; border-radius: 8px; color: #0d47a1;
            margin-bottom: 20px; font-size: 0.9em; line-height: 1.5; border-left: 4px solid #2196f3;
        }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--color-text); }
        .input-wrapper { position: relative; display: flex; align-items: center; }
        input[type="text"], input[type="number"], select {
            width: 100%; padding: 14px 40px 14px 16px; border: 1px solid var(--color-border);
            border-radius: 8px; font-size: 16px; background: #fff;
        }
        input:focus, select:focus { outline: none; border-color: var(--color-primary); box-shadow: 0 0 0 3px rgba(33, 128, 160, 0.1); }
        .clear-btn {
            position: absolute; right: 12px; background: #eee; border: none; border-radius: 50%;
            width: 24px; height: 24px; cursor: pointer; color: #666; display: none; align-items: center; justify-content: center;
        }
        .suggestion-dropdown {
            position: absolute; top: 100%; left: 0; right: 0; background: var(--color-surface);
            border: 1px solid var(--color-border); border-radius: 0 0 8px 8px;
            max-height: 250px; overflow-y: auto; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: none;
        }
        .suggestion-item { padding: 12px 16px; cursor: pointer; border-bottom: 1px solid #f0f0f0; }
        .suggestion-item:hover { background-color: #f5f9ff; }

        /* === å•†å®¶åˆ—è¡¨ (æœå°‹çµæœ) === */
        .merchant-list {
            background: var(--color-surface); padding: 16px; border-radius: 12px; margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: transform 0.2s; cursor: pointer;
            border: 1px solid transparent; display: flex; justify-content: space-between; align-items: center;
        }
        .merchant-list:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); border-color: var(--color-primary); }
        .merchant-name { font-size: 1.2em; font-weight: 700; color: var(--color-text); }
        .merchant-type { font-size: 0.9em; color: #888; background: #eee; padding: 2px 8px; border-radius: 12px; margin-left: 8px; }
        .merchant-best-info { text-align: right; }
        .best-rate { color: var(--color-success); font-weight: 800; font-size: 1.3em; }
        .best-card-name { font-size: 0.9em; color: #666; }

        /* === æ¬Šç›Šç¸½è¦½ (Accordion) === */
        .card-accordion-item {
            background: var(--color-surface); border-radius: 12px; margin-bottom: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05); overflow: hidden; border: 1px solid var(--color-border);
        }
        .accordion-header {
            padding: 16px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;
            background: white; transition: background 0.2s;
        }
        .card-title-row { display: flex; align-items: center; gap: 10px; }
        .card-icon { font-size: 1.2em; }
        .card-title-text { font-weight: 700; font-size: 1.1em; color: var(--color-text); }
        .chevron { transition: transform 0.3s; color: #999; }
        .accordion-header.active .chevron { transform: rotate(180deg); }
        .accordion-body { display: none; padding: 0; background: #fff; border-top: 1px solid #eee; }
        .accordion-body.open { display: block; animation: slideDown 0.3s ease-out; }
        @keyframes slideDown { from { opacity: 0; max-height: 0; } to { opacity: 1; max-height: 3000px; } }
        
        .benefit-row { padding: 14px 20px; border-bottom: 1px solid #f0f0f0; display: flex; flex-direction: column; position: relative; }
        .benefit-row:not(.no-action):hover { background-color: #f8fbff; cursor: pointer; }
        .benefit-row:not(.no-action)::after { content: 'â€º'; position: absolute; right: 20px; top: 50%; transform: translateY(-50%); font-size: 1.5em; color: #ccc; }
        .benefit-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; padding-right: 20px; }
        .benefit-name { font-weight: 600; font-size: 1em; color: #444; }
        .benefit-rate { font-weight: 700; color: var(--color-primary); font-size: 1.1em; }
        .benefit-rate.high { color: var(--color-danger); }
        .benefit-desc { font-size: 0.85em; color: #666; margin-top: 2px; padding-right: 20px; }
        .benefit-note { font-size: 0.8em; color: #999; margin-top: 4px; }
        .urgent-text { color: #c62828; font-weight: 700; background: #ffebee; padding: 1px 4px; border-radius: 4px; }

        /* === å½ˆçª—é€šç”¨æ¨£å¼ === */
        .detail-modal {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6); z-index: 2000; justify-content: center; padding: 20px;
            backdrop-filter: blur(2px); 
        }
        .detail-modal.show { display: flex; align-items: center; }
        .detail-content {
            background: var(--color-surface); border-radius: 16px; width: 100%; max-width: 500px;
            display: flex; flex-direction: column; box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            max-height: 85vh;
        }
        .detail-header { padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: flex-start; }
        .detail-title h2 { font-size: 1.5em; color: var(--color-primary); margin: 0; }
        .detail-close { background: #f0f0f0; border: none; width: 32px; height: 32px; border-radius: 50%; font-size: 20px; cursor: pointer; color: #666; }
        .detail-body { padding: 20px; overflow-y: auto; }

        /* === æ¬Šç›Šç¸½è¦½å½ˆçª— (å„ªåŒ–æ¨™ç±¤æ¨£å¼) === */
        .detail-category-group { margin-bottom: 20px; }
        .detail-category-title { 
            font-size: 0.95em; font-weight: 700; color: var(--color-text); margin-bottom: 10px; 
            padding-left: 8px; border-left: 4px solid var(--color-primary);
        }
        .scheme-list-container { display: flex; flex-wrap: wrap; gap: 8px; }
        .scheme-list-item { 
            background: var(--tag-bg); padding: 6px 12px; border-radius: 20px; 
            font-size: 0.9em; color: var(--tag-text); border: 1px solid #e0e0e0; display: inline-block;
        }

        /* === æ’åå½ˆçª— (ç¶ è‰²æ–¹æ¡† + è† å›Šæ¨™ç±¤) === */
        .detail-card-item { margin-bottom: 12px; border: 1px solid #eee; border-radius: 12px; overflow: hidden; }
        .detail-card-item.best-card { border: 2px solid var(--color-success-border); background-color: var(--color-success-bg); }
        .detail-card-header { padding: 12px 15px; background: #f9f9f9; font-weight: 600; display: flex; justify-content: space-between; align-items: center; }
        .detail-card-item.best-card .detail-card-header { background: #c8e6c9; color: var(--color-success); }
        .detail-card-body { padding: 15px; }
        .rate-val { font-weight: 800; font-size: 1.4em; }
        .detail-card-item.best-card .rate-val { color: var(--color-success); }
        .scheme-badge {
            display: inline-block; background-color: var(--color-badge-bg); color: var(--color-badge-text);
            padding: 3px 10px; border-radius: 12px; font-size: 0.85em; font-weight: 700;
            border: 1px solid rgba(21, 101, 192, 0.2);
        }
        .scheme-badge.crazy { background-color: #ffebee; color: #c62828; border-color: #ffcdd2; }
        .scheme-badge.new-user { background-color: #fff3e0; color: #e65100; border-color: #ffe0b2; }
        .plan-warning { color: var(--color-danger); font-weight: 600; font-size: 0.9em; margin-top: 8px; display: flex; align-items: center; padding-top: 8px; border-top: 1px dashed rgba(0,0,0,0.1); }
        .plan-warning::before { content: 'âš ï¸'; margin-right: 4px; }

        /* === å¿«é€Ÿåˆ†é¡æŒ‰éˆ• === */
        .category-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 15px; }
        .category-tag {
            padding: 8px 16px; background: var(--color-surface);
            border: 1px solid var(--color-border); border-radius: 20px;
            cursor: pointer; font-size: 0.9em; color: var(--color-text); font-weight: 500;
            transition: all 0.2s; user-select: none;
        }
        .category-tag:hover { border-color: var(--color-primary); color: var(--color-primary); background: #e3f2fd; }
        .category-tag.active { background: var(--color-primary); color: white; border-color: var(--color-primary); }

        /* === è©¦ç®—çµæœæ¨£å¼ === */
        .calc-result-item { margin-bottom: 15px; padding: 15px; background: white; border: 1px solid #eee; border-radius: 12px; }
        .calc-result-item.winner { border: 2px solid var(--color-success-border); background: var(--color-success-bg); }
        .calc-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .calc-money { font-size: 1.4em; font-weight: 800; color: var(--color-text); }
        .calc-result-item.winner .calc-money { color: var(--color-success); }
        .calc-detail { font-size: 0.85em; color: #666; background: rgba(0,0,0,0.03); padding: 8px; border-radius: 6px; margin-top: 8px; font-family: monospace; }
        .toggle-container { display: flex; align-items: center; margin-top: 10px; cursor: pointer; }
        .toggle-checkbox { width: 18px; height: 18px; margin-right: 8px; }
        .limit-reached { color: var(--color-danger); font-size: 0.8em; margin-left: 6px; font-weight: bold; }
        .upgrade-tip { background-color: #fff3e0; color: #e65100; padding: 8px 12px; border-radius: 8px; font-size: 0.9em; margin-top: 8px; font-weight: 600; border: 1px solid #ffe0b2; }

        @media (max-width: 480px) {
            body { padding: 15px; padding-top: 10px; }
            h1 { font-size: 1.5em; }
            .category-tag { padding: 6px 12px; font-size: 0.85em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ’³ ä¿¡ç”¨å¡å›é¥‹æŸ¥è©¢åŠ©æ‰‹ 2026</h1>

        <div class="nav-tabs">
            <div class="nav-item active" onclick="switchTab('search')">ğŸ” é€šè·¯æœå°‹</div>
            <div class="nav-item" onclick="switchTab('overview')">ğŸ“‹ æ¬Šç›Šç¸½è¦½</div>
            <div class="nav-item" onclick="switchTab('calculator')">ğŸ’° å›é¥‹è©¦ç®—</div>
        </div>

        <div id="tab-search" class="tab-content active">
            <div class="form-section">
                <div class="info-text">
                    ğŸ” <strong>2026å¹´æ¬Šç›Š</strong>ï¼šåœ‹æ³°CUBE(ç˜‹å¤§æ¸¯3.5%)ã€Richart(3.8%)ã€Unicard(æ–°æˆ¶7.5%)ã€UBear(æ–°æˆ¶10%)ã€æ°¸è±DAWHOã€‚
                </div>
                
                <div class="form-group">
                    <label for="searchMerchant">æœå°‹é€šè·¯åç¨±</label>
                    <div class="input-wrapper">
                        <input type="text" id="searchMerchant" placeholder="ä¾‹å¦‚ï¼šå…¨å®¶ã€é«˜éµã€è¦çš®ã€ZARA..." autocomplete="off">
                        <button id="clearSearch" class="clear-btn" onclick="clearSearch()">âœ•</button>
                        <div id="suggestionDropdown" class="suggestion-dropdown"></div>
                    </div>
                </div>
                
                <div style="margin-top: 15px;">
                    <label>å¿«é€Ÿåˆ†é¡æœå°‹</label>
                    <div class="category-tags" id="quickCategoryTags"></div>
                </div>
            </div>

            <div id="merchantResults" class="results-section">
                <div id="merchantContainer"></div>
            </div>
        </div>

        <div id="tab-overview" class="tab-content">
            <div id="cardOverviewContainer"></div>
        </div>

        <div id="tab-calculator" class="tab-content">
            <div class="form-section">
                <div class="form-group">
                    <label>æ¶ˆè²»é‡‘é¡ (TWD)</label>
                    <input type="number" id="calcAmount" placeholder="ä¾‹å¦‚ï¼š20000" inputmode="numeric">
                </div>
                <div class="form-group">
                    <label>æ¶ˆè²»é€šè·¯</label>
                    <div class="input-wrapper">
                        <input type="text" id="calcMerchant" placeholder="ä¾‹å¦‚ï¼šè¦çš®è³¼ç‰©" autocomplete="off">
                        <div id="calcSuggestionDropdown" class="suggestion-dropdown"></div>
                    </div>
                </div>
                <div class="form-group" id="unicardSchemeDiv" style="display:none;">
                    <label>ç‰å±± Unicard æ–¹æ¡ˆ</label>
                    <select id="calcUnicardScheme">
                        <option value="up">UPé¸ (3.5% + åŠ ç¢¼)</option>
                        <option value="any">ä»»æ„é¸ (2.5% + åŠ ç¢¼)</option>
                        <option value="simple">ç°¡å–®é¸ (2.0% + åŠ ç¢¼)</option>
                    </select>
                </div>
                <label class="toggle-container">
                    <input type="checkbox" id="calcNewUser" class="toggle-checkbox">
                    <span>æˆ‘æ˜¯è©²å¡æ–°æˆ¶ ğŸ£ (UBear / Unicard)</span>
                </label>
                <button onclick="calculateRewards()" style="width:100%; padding:12px; background:var(--color-primary); color:white; border:none; border-radius:8px; font-weight:700; margin-top:15px; font-size:1.1em;">é–‹å§‹è©¦ç®—</button>
            </div>
            <div id="calcResults"></div>
        </div>

    </div>

    <div id="detailModal" class="detail-modal" onclick="if(event.target === this) closeDetailModal()">
        <div class="detail-content">
            <div class="detail-header">
                <div class="detail-title">
                    <h2 id="modalTitle">æ–¹æ¡ˆè©³æƒ…</h2>
                </div>
                <button class="detail-close" onclick="closeDetailModal()">âœ•</button>
            </div>
            <div id="detailBody" class="detail-body"></div>
        </div>
    </div>

    <script>
        // === æ ¸å¿ƒè³‡æ–™ï¼šæ¬Šç›Šç¸½è¦½ ===
        const cardBenefitsData = [
            {
                id: 'richart', name: 'å°æ–° Richart', icon: 'ğŸ¶', note: 'éœ€æ¯æ—¥é€é Richart App åˆ‡æ›è‡³å°æ‡‰æ¬Šç›Šæ–¹æ¡ˆ',
                benefits: [
                    { name: 'Payè‘—åˆ·', rate: 0.038, desc: 'å°æ–°Pay(è¶…å•†/ç™¾è²¨) | IKEA | å°ç£å¤§è»ŠéšŠ', note: 'ç„¡ä¸Šé™', tag: 'pay', categories: { 'å°æ–°Pay':['7-11', 'å…¨å®¶ä¾¿åˆ©å•†åº—', 'æ–°å…‰ä¸‰è¶Š', 'Richart Mart', 'åº·æ˜¯ç¾', 'IKEA', 'NET'], 'å°ç£Pay':['ç¥è…¦', 'ç‡¦å¤', 'å…¨åœ‹é›»å­', 'éº¥ç•¶å‹', 'ç¾å»‰ç¤¾', 'å¤§æ¨¹è—¥å±€', 'æä¸€é†«ç™‚'], 'äº¤é€š':['å°ç£å¤§è»ŠéšŠ'] } },
                    { name: 'æ•¸è¶£åˆ·', rate: 0.033, desc: 'ç¶²è³¼ | éŠæˆ²å½±éŸ³ | ç·šä¸Šèª²ç¨‹ | AIæœå‹™', note: 'ç„¡ä¸Šé™', tag: 'digital', categories: { 'ç¶²è³¼å¹³å°':['è¦çš®è³¼ç‰©', 'momoè³¼ç‰©ç¶²', 'é…·æ¾(Coupang)', 'PChome', 'æ·˜å¯¶', 'Amazon', 'æ±æ£®', 'åšå®¢ä¾†', 'Richart Mart', 'PayEasy', 'iHerb', 'SHEIN', 'Farfetch', 'Olive Young'], 'ç·šä¸Šèª²ç¨‹':['çŸ¥è­˜è¡›æ˜Ÿ', 'Amazing Talker', 'Tutor ABC', 'Hahow', 'PressPlay'], 'éŠæˆ²å½±éŸ³':['MyCard', 'éŠæˆ²æ©˜å­', 'Steam', 'PlayStation', 'Nintendo', 'Netfilx', 'Disney+'], 'AIæœå‹™':['ChatGPT', 'Notion', 'Canva', 'Perplexity', 'Claude'] } },
                    { name: 'ç©æ—…åˆ·', rate: 0.033, desc: 'æµ·å¤– | èˆªç©º | è¨‚æˆ¿ | æ—…è¡Œç¤¾', note: 'ç„¡ä¸Šé™', tag: 'travel', categories: { 'æµ·å¤–æ¶ˆè²»':['æµ·å¤–æ¶ˆè²»(å«å¯¦é«”)'], 'è¨‚æˆ¿å¹³å°':['Klook', 'KKday', 'Agoda', 'Booking.com', 'Trip.com', 'Airbnb', 'Hotels.com', 'Expedia'], 'æµ·å¤–äº¤é€š':['Uber', 'Grab', 'SUICA', 'ICOCA', 'PASMO', 'WOWPASS', 'AIRSIM'], 'æ—…è¡Œç¤¾':['é›„ç…æ—…éŠ', 'æ˜“éŠç¶²', 'æ±å—æ—…éŠ', 'å¯æ¨‚æ—…éŠ', 'é•·æ±å‡æœŸ', 'äº”ç¦æ—…éŠ', 'å–œé´»å‡æœŸ', 'æ˜“é£›æ—…éŠ', 'ç‡¦æ˜Ÿæ—…éŠ', 'åŠ åˆ©åˆ©æ—…è¡Œç¤¾', 'é³³å‡°åœ‹éš›æ—…è¡Œç¤¾', 'å±±å¯Œæ—…éŠ', 'è¡Œå¥æ—…éŠ'], 'èˆªç©ºå…¬å¸':['ä¸­è¯èˆªç©º', 'é•·æ¦®èˆªç©º', 'æ˜Ÿå®‡èˆªç©º', 'å°ç£è™èˆª', 'åœ‹æ³°èˆªç©º', 'è¯ä¿¡èˆªç©º', 'ç«‹æ¦®èˆªç©º', 'æ¨‚æ¡ƒèˆªç©º', 'é˜¿è¯é…‹èˆªç©º', 'äºæ´²èˆªç©º', 'é…·èˆª', 'æ·æ˜Ÿèˆªç©º', 'æ–°åŠ å¡èˆªç©º', 'æ—¥æœ¬èˆªç©º', 'è¶Šæ·èˆªç©º'] } },
                    { name: 'å¤©å¤©åˆ·', rate: 0.033, desc: 'è¶…å•†é‡è²© | äº¤é€š | åœè»Š | è—¥å±€', note: 'ç„¡ä¸Šé™', tag: 'daily', categories: { 'è¶…å•†é‡è²©(å°æ–°Pay)':['7-11', 'å…¨å®¶', 'å®¶æ¨‚ç¦', 'å¤§è²·å®¶', 'å”å‰è»»å¾·', 'LOPIA'], 'é€šå‹¤äº¤é€š':['å°ç£éµè·¯', 'å°ç£é«˜éµ', 'å°ç£å¤§è»ŠéšŠ', 'Yoxi', 'Uber'], 'åœè»Šç§Ÿè»Š':['å˜Ÿå˜Ÿæˆ¿', 'è»Šéº»å‰', 'åŸå¸‚è»Šæ—…', 'ViViPark', 'USPACE', 'UDRIVE', 'iRent', 'å’Œé‹ç§Ÿè»Š', 'æ ¼ä¸Šç§Ÿè»Š'], 'è—¥å¦è—¥å±€':['å¯¶é›…', 'åº·æ˜¯ç¾', 'å±ˆè‡£æ°', 'æä¸€é†«ç™‚', 'å¤§æ¨¹è—¥å±€', 'ä¸ä¸è—¥å±€', 'ä½‘å…¨ä¿å¥', 'å¥åº·äººç”Ÿ'] } },
                    { name: 'å¤§ç­†åˆ·', rate: 0.033, desc: 'ç™¾è²¨ | Outlet | å±…å®¶ | æ™‚å°š', note: 'ç„¡ä¸Šé™', tag: 'big', categories: { 'æŒ‡å®šç™¾è²¨':['æ–°å…‰ä¸‰è¶Š', 'é æ±ç™¾è²¨', 'é æ±SOGO', 'æ¼¢ç¥å·¨è›‹', 'æ¼¢ç¥ç™¾è²¨', 'å¾®é¢¨', 'å°åŒ—101', 'é æ±å·¨åŸ', 'å»£ä¸‰SOGO', 'å—ç´¡è³¼ç‰©ä¸­å¿ƒ', 'èª å“ç”Ÿæ´»', 'äº¬ç«™', 'ä¸‰å‰µç”Ÿæ´»', 'å¤¢æ™‚ä»£', 'çµ±ä¸€æ™‚ä»£', 'ä¸­å‹ç™¾è²¨', 'LaLaport'], 'æŒ‡å®šOutlet':['MITSUI OUTLET PARK', 'è¯æ³°åå“åŸ', 'SKM Park Outlets'], 'å±…å®¶è£ä¿®':['IKEA', 'ç‰¹åŠ›å±‹', 'HOLA', 'å®œå¾—åˆ©', 'ç‘ªé»‘å®¶å±…'], 'æ™‚å°šå“å‘³':['UNIQLO', 'GU', 'ZARA', 'NET', 'lululemon'] } },
                    { name: 'å¥½é¥—åˆ·', rate: 0.033, desc: 'é¤é£² | å¤–é€ | åŠ æ²¹ | å¨›æ¨‚', note: 'ç„¡ä¸Šé™', tag: 'fun', categories: { 'é¤é£²å¤–é€':['åœ‹å…§é¤é£²', 'ç‹å“ç˜‹Pay', 'Uber Eats', 'Foodpanda'], 'åŠ æ²¹å……é›»':['å°ç£ä¸­æ²¹-ç›´ç‡Ÿç«™', 'å°äºç›´ç‡Ÿ', 'å…¨åœ‹åŠ æ²¹', 'EVOASIS', 'EVALUE'], 'å±•æ¼”è³¼ç¥¨':['æ‹“å…ƒå”®ç¥¨', 'KKTIX', 'å¹´ä»£å”®ç¥¨', 'å¯¬å®å”®ç¥¨', 'OPENTIX', 'FunNow'], 'æŒ‡å®šKTV':['éŒ¢æ«ƒ', 'å¥½æ¨‚è¿ª', 'ONCOR', 'sing!go', 'äº«æº«é¦¨'], 'æŒ‡å®šæ¨‚åœ’':['ç¾©å¤§éŠæ¨‚ä¸–ç•Œ', 'éº—å¯¶æ¨‚åœ’', 'å…­ç¦æ‘', 'ä¹æ—æ–‡åŒ–æ‘', 'åŠæ¹–å±±', 'X-Park', 'åœ‹ç«‹æµ·æ´‹ç”Ÿç‰©åšç‰©é¤¨', 'é é›„æµ·æ´‹å…¬åœ’', 'å°äººåœ‹'], 'æŒ‡å®šé£¯åº—':['æ™¶è¯', 'é›²æœ—', 'è¬è±ª', 'ç…™æ³¢', 'è€çˆº', 'ç¦è¯', 'æ¼¢ä¾†', 'å›æ‚…', 'æ´²éš›', 'å¯’æ²'] } },
                    { name: 'LINE Pay', rate: 0.023, desc: 'ä¸€èˆ¬ LINE Pay ç¶å®šæ”¯ä»˜', note: 'ç„¡é–€æª»', tag: 'line', categories: { 'è¡Œå‹•æ”¯ä»˜':['LINE Pay'] } },
                    { name: 'å‡æ—¥åˆ·', rate: 0.02, desc: 'åœ‹å…§ç¯€å‡æ—¥ä¸é™é€šè·¯', note: 'åŸºæœ¬å›é¥‹', categories: {} }
                ]
            },
            {
                id: 'cube', name: 'åœ‹æ³° CUBE', icon: 'âšªï¸', note: 'éœ€æ¯æ—¥é€é CUBE App åˆ‡æ›è‡³å°æ‡‰æ¬Šç›Šæ–¹æ¡ˆ',
                benefits: [
                    { name: 'ç˜‹å¤§æ¸¯', rate: 0.035, desc: 'æŒ‡å®šé«˜é›„ä½å®¿ | Klook | é«˜éµ | å°éµ', note: '<span class="urgent-text">2026/3/23 æˆªæ­¢</span>', tag: 'crazy', categories: { 'æŒ‡å®šé«˜é›„ä½å®¿':['åŸå¸‚å•†æ—…', 'å’Œé€¸é£¯åº—', 'æ—…å±…æ–‡æ—…', 'ç§èŠ¯æ—…åº—', 'å¤å„ªæ—…å±…', 'è¯åœ’å¤§é£¯åº—', 'æ·çµ²æ—…', 'éº—å°Šé…’åº—', 'å¸•å¯éº—é…’åº—', 'éˆæ€¡å¤§é£¯åº—'], 'æ—…éŠå¹³å°':['Klook'], 'æŒ‡å®šäº¤é€š':['å°ç£é«˜éµ', 'å°ç£éµè·¯å±€'] } },
                    { name: 'ç©æ•¸ä½', rate: 0.03, desc: 'ç¶²è³¼ | å½±éŸ³ | AI | åœ‹éš›é›»å•†', note: 'ç„¡ä¸Šé™', tag: 'digital', categories: { 'AIå·¥å…·':['ChatGPT', 'Canva', 'Claude', 'Cursor', 'Duolingo', 'Gamma', 'Gemini', 'Notion', 'Perplexity', 'Speak'], 'åœ‹éš›é›»å•†':['æ·˜å¯¶', 'å¤©è²“', 'Coupang é…·æ¾'], 'ç¶²è³¼å¹³å°':['è¦çš®è³¼ç‰©', 'momoè³¼ç‰©ç¶²', 'PChome 24hè³¼ç‰©', 'å°æ¨¹è³¼'], 'æ•¸ä½ä¸²æµ':['Apple åª’é«”æœå‹™', 'Google Play', 'Disney+', 'Netflix', 'Spotify', 'YouTube Premium', 'Max'] } },
                    { name: 'æ¨‚éŸ¿è³¼', rate: 0.03, desc: 'ç™¾è²¨å…¬å¸ | å…¨çƒé¤é£² | å¤–é€ | è—¥å¦', note: 'ç„¡ä¸Šé™', tag: 'fun', categories: { 'åœ‹å…§ç™¾è²¨':['é æ±SOGO', 'é æ±Garden City', 'æ–°å…‰ä¸‰è¶Š', 'é æ±ç™¾è²¨', 'å°åŒ—101', 'BELLAVITA', 'å¾®é¢¨å»£å ´', 'çµ±ä¸€æ™‚ä»£', 'èª å“ç”Ÿæ´»', 'ATT 4 FUN', 'äº¬ç«™', 'ç¾éº—è¯', 'NOKEå¿ æ³°æ¨‚ç”Ÿæ´»', 'å¤§è‘‰é«˜å³¶å±‹', 'Mitsui Shopping Park LaLaport', 'å®åŒ¯å»£å ´', 'å°èŒ‚', 'å¤§æ±Ÿ', 'Big City', 'ä¸­å‹', 'å»£ä¸‰SOGO', 'å—ç´¡', 'è€æ–¯å»£å ´', 'å¤¢æ™‚ä»£', 'æ¼¢ç¥ç™¾è²¨', 'æ¼¢ç¥å·¨è›‹', 'æ–°æœˆå»£å ´', 'CITYLINK', 'ç§€æ³°ç”Ÿæ´»', 'ç’°çƒè³¼ç‰©ä¸­å¿ƒ', 'å¤ªå¹³æ´‹ç™¾è²¨', 'è¯æ³°åå“åŸ', 'SKM Park', 'MITSUI OUTLET PARK'], 'åœ‹å…§é¤é£²':['åœ‹å…§é¤é£²', 'éº¥ç•¶å‹'], 'å¤–é€å¹³å°':['Uber Eats', 'foodpanda'], 'åœ‹å…§è—¥å¦':['å±ˆè‡£æ°', 'åº·æ˜¯ç¾'] } },
                    { name: 'è¶£æ—…è¡Œ', rate: 0.03, desc: 'æµ·å¤–å¯¦é«” | è¨‚æˆ¿ | èˆªç©º | æ—…è¡Œç¤¾ | åœ‹å…§äº¤é€š', note: 'ç„¡ä¸Šé™', tag: 'travel', categories: { 'æµ·å¤–æ¶ˆè²»':['æµ·å¤–å¯¦é«”æ¶ˆè²»'], 'æµ·å¤–äº¤é€š':['SUICA', 'PASMO', 'ICOCA', 'Uber', 'Grab'], 'æŒ‡å®šæ¨‚åœ’':['æ±äº¬è¿ªå£«å°¼', 'å“ˆåˆ©æ³¢ç‰¹å½±åŸ', 'å¤§é˜ªç’°çƒå½±åŸ'], 'æ—…éŠè¨‚æˆ¿':['Klook', 'KKday', 'Agoda', 'Airbnb', 'Booking.com', 'Trip.com'], 'åœ‹å…§æ—…è¡Œç¤¾':['é›„ç…', 'æ˜“éŠç¶²', 'å¯æ¨‚', 'æ±å—', 'äº”ç¦', 'ç‡¦æ˜Ÿ', 'å±±å¯Œ', 'é•·æ±å‡æœŸ', 'é³³å‡°', 'æ˜“é£›ç¶²', 'ç†æƒ³æ—…éŠ', 'æ°¸åˆ©', 'ä¸‰è³€'], 'åœ‹å…§äº¤é€š':['å°ç£é«˜éµ', 'å°ç£å¤§è»ŠéšŠ', 'yoxi', 'iRent', 'å’Œé‹ç§Ÿè»Š', 'æ ¼ä¸Šç§Ÿè»Š', 'Uber'], 'æŒ‡å®šèˆªç©º':['ä¸­è¯èˆªç©º', 'é•·æ¦®èˆªç©º', 'æ˜Ÿå®‡èˆªç©º', 'å°ç£è™èˆª', 'åœ‹æ³°èˆªç©º', 'æ¨‚æ¡ƒèˆªç©º', 'é˜¿è¯é…‹èˆªç©º', 'é…·èˆª', 'æ·æ˜Ÿèˆªç©º', 'æ—¥æœ¬èˆªç©º', 'äºæ´²èˆªç©º', 'è¯åˆèˆªç©º', 'æ–°åŠ å¡èˆªç©º', 'ANAå…¨æ—¥ç©º', 'è¶Šæ·èˆªç©º', 'å¤§éŸ“èˆªç©º', 'é”ç¾èˆªç©º', 'åœŸè€³å…¶èˆªç©º', 'æ³•åœ‹èˆªç©º', 'å¡é”èˆªç©º'], 'æŒ‡å®šä½å®¿':['åœ‹å…§é£¯åº—', 'æ˜Ÿé‡é›†åœ˜', 'å…¨çƒè¿ªå£«å°¼é£¯åº—', 'æ±æ©«INN'] } },
                    { name: 'é›†ç²¾é¸', rate: 0.02, desc: 'è¶…å•† | é‡è²© | åŠ æ²¹ | IKEA', note: 'ç„¡ä¸Šé™', tag: 'base', categories: { 'å……é›»åœè»Š':['U-POWER', 'EVOASIS', 'EVALUE', 'TAIL', 'iCharging', 'è»Šéº»å‰', 'uTagGo'], 'ç”Ÿæ´»å±…å®¶':['IKEA'], 'é‡è²©è¶…å¸‚':['å®¶æ¨‚ç¦', 'å…¨è¯ç¦åˆ©ä¸­å¿ƒ', 'LOPIAå°ç£'], 'æŒ‡å®šåŠ æ²¹':['å°ç£ä¸­æ²¹-ç›´ç‡Ÿç«™'], 'æŒ‡å®šè¶…å•†':['7-ELEVEN', 'å…¨å®¶ä¾¿åˆ©å•†åº—'] } }
                ]
            },
            {
                id: 'unicard', name: 'ç‰å±± Unicard', icon: 'â›°ï¸', note: 'ç°¡å–®é¸ 2% / ä»»æ„é¸ 2.5% / UPé¸ 3.5% (éœ€149é»è¨‚é–±)',
                benefits: [
                    { 
                        name: 'ç™¾å¤§ç‰¹åº—åå–®', rate: 0, tag: 'list', type: 'modal',
                        desc: 'é»æ“ŠæŸ¥çœ‹å®Œæ•´ç™¾å¤§ç‰¹åº— (UPé¸3.5%)', 
                        categories: {
                            'è¡Œå‹•æ”¯ä»˜': ['ç‰å±±Wallet', 'LINE Pay', 'å…¨æ”¯ä»˜', 'è¡—å£æ”¯ä»˜', 'æ‚ éŠä»˜', 'å…¨ç›ˆ+PAY', 'iPASS MONEY', 'icash Pay'],
                            'åŠ æ²¹äº¤é€š': ['å°ç£ä¸­æ²¹-ç›´ç‡Ÿç«™', '55688', 'å°ç£éµè·¯', 'å°ç£é«˜éµ', 'Uber', 'Yoxi'],
                            'åœ‹å…§ç™¾è²¨': ['æ–°å…‰ä¸‰è¶Š', 'é æ±ç™¾è²¨', 'æ¼¢ç¥ç™¾è²¨', 'å¾®é¢¨', 'å°åŒ—101', 'è¯æ³°åå“åŸ', 'ä¸‰äº•OUTLET', 'äº¬ç«™', 'ç¾éº—è¯', 'èª å“', 'ç§€æ³°', 'LaLaport', 'çµ±é ˜', 'çµ±ä¸€æ™‚ä»£', 'æ˜‡æ†æ˜Œ', 'é‡‡ç›Ÿ'],
                            'é¤é£²ç¾é£Ÿ': ['Uber Eats', 'foodpanda', 'EZTABLE', 'ç‹å“ç˜‹Pay', 'é¥—è³“', 'ç“¦åŸ', 'ä¹¾æ¯', 'æ¼¢ä¾†ç¾é£Ÿ', 'é¼ç‹', 'çˆ­é®®'],
                            'èˆªç©ºæ—…éŠ': ['ä¸­è¯èˆªç©º', 'é•·æ¦®èˆªç©º', 'æ—¥æœ¬èˆªç©º', 'å°ç£è™èˆª', 'æ¨‚æ¡ƒèˆªç©º', 'é…·èˆª', 'Trip.com', 'Booking.com', 'Hotels.com', 'AsiaYo', 'Expedia', 'KKday', 'Klook', 'é›„ç…', 'å¯æ¨‚', 'æ±å—', 'Agoda'],
                            'ç²¾é¸å•†å®¶': ['Appleç›´ç‡Ÿåº—', 'å°ç±³å°ç£', 'å…¨åœ‹é›»å­', 'ç‡¦å¤', 'è¿ªå¡å„‚'],
                            'ç”Ÿæ´»æ¡è²·': ['å®¶æ¨‚ç¦', 'å±ˆè‡£æ°', 'åº·æ˜¯ç¾', 'ç‰¹åŠ›å±‹', 'HOLA', 'hoi', 'UNIQLO', 'NET', 'å¤§æ¨¹è—¥å±€', 'ä¸ä¸è—¥å¦'],
                            'é›»å•†å¹³å°': ['momoè³¼ç‰©ç¶²', 'è¦çš®è³¼ç‰©', 'æ·˜å¯¶', 'Coupangé…·æ¾'],
                            'åœ‹å¤–å¯¦é«”': ['æ—¥æœ¬', 'éŸ“åœ‹', 'æ³°åœ‹', 'è¶Šå—', 'æ–°åŠ å¡', 'é¦¬ä¾†è¥¿äº', 'è²å¾‹è³“', 'ä¸­åœ‹', 'é¦™æ¸¯', 'æ¾³é–€', 'ç¾åœ‹', 'åŠ æ‹¿å¤§', 'è‹±åœ‹', 'æ³•åœ‹', 'å¾·åœ‹', 'ç¾©å¤§åˆ©', 'æ¾³æ´²'],
                            'ESGæ¶ˆè²»': ['ç‰¹æ–¯æ‹‰', 'Gogoro', 'YouBike']
                        },
                        note: 'é»æ“ŠæŸ¥çœ‹è©³æƒ…'
                    },
                    { name: 'UPé¸', rate: 0.035, desc: 'ç™¾å¤§ç‰¹åº— (éœ€149é»è¨‚é–±)', type: 'text', note: 'éœ€å®ŒæˆUPä»»å‹™' },
                    { name: 'ä»»æ„é¸', rate: 0.025, desc: 'ç™¾å¤§ç‰¹åº— (éœ€è¨­å®š8å®¶)', type: 'text', note: 'éœ€é€é App è¨­å®š' },
                    { name: 'ç°¡å–®é¸', rate: 0.02, desc: 'ç™¾å¤§ç‰¹åº— (é è¨­æ–¹æ¡ˆ)', type: 'text', note: 'æ ¸å¡å³äº«' },
                    { 
                        name: 'æ–°æˆ¶å›é¥‹', rate: 0.03, tag: 'new', type: 'modal',
                        desc: 'äº”å¤§æŒ‡å®šé€šè·¯ +3%', 
                        categories: { 'æŒ‡å®šé€šè·¯': ['LINE Pay', 'Uber Eats', 'å®¶æ¨‚ç¦', 'éŸ“åœ‹', 'å…¨ç›ˆ+PAY'] },
                        note: '<span class="urgent-text">æ–°æˆ¶+3% (æœ€é«˜6.5%~7.5%)</span>' 
                    }
                ]
            },
            {
                id: 'ubear', name: 'ç‰å±± UBear', icon: 'ğŸ»', note: 'æŒ‡å®šå¨›æ¨‚ 10% / ç¶²è³¼ 3% (æ–°æˆ¶ç¶²è³¼ +7% = 10%)',
                benefits: [
                    { name: 'å½±éŸ³å¨›æ¨‚', rate: 0.10, tag: 'ent', desc: 'Netflix | Disney+ | Nintendo | PlayStation', categories: { 'å½±éŸ³å¨›æ¨‚': ['Netflix', 'Disney+', 'Nintendo', 'PlayStation', 'KKBOX', 'iTunes', 'Google Play', 'Funnow'] }, note: 'æ¯æœŸä¸Šé™$100 (å¯åˆ·$1,000)' },
                    { name: 'ç¶²è³¼/Pay', rate: 0.03, tag: 'net', desc: 'ç¶²è³¼ | è¡Œå‹•æ”¯ä»˜ | äº¤é€šè¨‚æˆ¿ | å¤–é€', 
                      categories: { 
                        'è¡Œå‹•æ”¯ä»˜': ['LINE Pay', 'è¡—å£æ”¯ä»˜', 'æ‚ éŠä»˜', 'OPENéŒ¢åŒ…', 'icash Pay', 'å…¨ç›ˆ+PAY', 'å…¨æ”¯ä»˜', 'æ©˜å­æ”¯ä»˜', 'skm pay', 'ä¸­æ²¹Pay', 'ç‰å±±Wallet', 'Pi æ‹éŒ¢åŒ…', 'æ­ä»˜å¯¶', 'PayPal', 'Hami Pay'],
                        'ç·šä¸Šè³¼ç‰©': ['PChome', 'momoè³¼ç‰©ç¶²', 'è¦çš®è³¼ç‰©', 'Coupangé…·æ¾', 'Yahoo', 'æ·˜å¯¶', 'éœ²å¤©', 'åšå®¢ä¾†', 'ç”Ÿæ´»å¸‚é›†', 'æ¾æœè³¼ç‰©', 'èª å“ç¶²è·¯', 'friDayè³¼ç‰©', 'udnå”®ç¥¨ç¶²', 'GOMAJI', 'æ¨‚å¤©å¸‚å ´', 'å±ˆè‡£æ°ç·šä¸Š', 'åº·æ˜¯ç¾ç·šä¸Š', 'å®¶æ¨‚ç¦ç·šä¸Š', 'ç¥è…¦', 'ç‡¦å¤ç·šä¸Š', 'Appleå®˜ç¶²', 'å°ç±³å°ç£', 'è¿ªå¡å„‚ç·šä¸Š', 'æ‹“å…ƒ', 'ZARA', 'H&M', 'GU', 'UNIQLO', 'Lativ', 'ZALORA', 'Pinkoi'],
                        'äº¤é€šè¨‚æˆ¿': ['55688', 'Uber', 'å°ç£é«˜éµT-EX', 'å°ç£éµè·¯ç·šä¸Š', 'æ˜“éŠç¶²', 'Agoda', 'Hotels.com', 'Expedia', 'Klook', 'KKday', 'Booking.com', 'Airbnb', 'ä¸­è¯èˆªç©º', 'é•·æ¦®èˆªç©º', 'å°ç£è™èˆª'],
                        'å¤–é€å¹³å°': ['Uber Eats', 'foodpanda', 'foodomo', 'lalamove', 'ä½ è¨‚']
                      },
                      note: '' 
                    },
                    { name: 'æ–°æˆ¶åŠ ç¢¼', rate: 0.07, tag: 'bonus', type: 'text', desc: '[æ–°æˆ¶] ç¶²è³¼/PayåŠ ç¢¼ +7% (ä¸Šé™$2,142)', note: 'åƒ…é™æ–°æˆ¶ï¼Œç¶²è³¼/Payé€šè·¯', categories: {} }
                ]
            },
            {
                id: 'dawho', name: 'æ°¸è± DAWHO', icon: 'âš«ï¸', note: 'åœ‹å…§ 3.5% / åœ‹å¤– 4.5% (éœ€å¤§æˆ¶ç­‰ç´š)',
                benefits: [
                    { name: 'åœ‹å…§å…¨é€šè·¯', rate: 0.035, desc: 'å…¨é€šè·¯ç„¡è…¦åˆ· (å«ä»»å‹™)', tag: 'all', type: 'text', note: 'ä¸Šé™$16,000' },
                    { name: 'æ‚ éŠå¡', rate: 0.03, desc: 'æ‚ éŠå¡è‡ªå‹•åŠ å€¼', tag: 'easy', type: 'text', note: 'ä¸Šé™$3,333' }
                ]
            }
        ];

        // === è³‡æ–™æ­£è¦åŒ–å­—å…¸ (Normalization Map) ===
        const normalizationMap = {
            'å…¨å®¶': 'å…¨å®¶ä¾¿åˆ©å•†åº—', '7-11': '7-ELEVEN', 'å°ä¸ƒ': '7-ELEVEN',
            'è¦çš®': 'è¦çš®è³¼ç‰©', 'uber': 'Uber', 'é«˜éµ': 'å°ç£é«˜éµ', 'å°éµ': 'å°ç£éµè·¯',
            'ä¸­æ²¹': 'å°ç£ä¸­æ²¹-ç›´ç‡Ÿç«™', 'line': 'LINE Pay', 'linepay': 'LINE Pay',
            'ubereats': 'Uber Eats', 'foodpanda': 'foodpanda', 'ç†Šè²“': 'foodpanda',
            'å…¨è¯': 'å…¨è¯ç¦åˆ©ä¸­å¿ƒ', 'å®¶æ¨‚ç¦': 'å®¶æ¨‚ç¦', 'momo': 'momoè³¼ç‰©ç¶²',
            'pchome': 'PChome 24hè³¼ç‰©', 'klook': 'Klook', 'kkday': 'KKday',
            'uniqlo': 'UNIQLO', 'ikea': 'IKEA'
        };
        const aliasMap = { ...normalizationMap, 'è‚¯å¾·åŸº': 'åœ‹å…§é¤é£²', 'æ˜Ÿå·´å…‹': 'åœ‹å…§é¤é£²', 'éº¥ç•¶å‹': 'éº¥ç•¶å‹' };

        // === å¿«é€Ÿåˆ†é¡æŒ‰éˆ• ===
        const quickFilters = [
            { name: 'ğŸª è¶…å•†é‡è²©', keywords: ['è¶…å•†', 'é‡è²©', 'è¶…å¸‚'] },
            { name: 'ğŸ” é¤é£²å¤–é€', keywords: ['é¤é£²', 'å¤–é€', 'ç¾é£Ÿ'] },
            { name: 'ğŸ›ï¸ ç¶²è³¼å¹³å°', keywords: ['ç¶²è³¼', 'é›»å•†', 'ç·šä¸Šè³¼ç‰©'] },
            { name: 'ğŸš„ äº¤é€šæ—…éŠ', keywords: ['äº¤é€š', 'æ—…éŠ', 'è¨‚æˆ¿', 'èˆªç©º', 'æ—…è¡Œç¤¾', 'é«˜éµ', 'å°éµ'] },
            { name: 'ğŸ’³ è¡Œå‹•æ”¯ä»˜', keywords: ['è¡Œå‹•æ”¯ä»˜', 'Pay'] },
            { name: 'ğŸ¬ å½±éŸ³å¨›æ¨‚', keywords: ['å½±éŸ³', 'å¨›æ¨‚', 'éŠæˆ²', 'KTV', 'æ¨‚åœ’'] },
            { name: 'ğŸ¬ ç™¾è²¨è—¥å¦', keywords: ['ç™¾è²¨', 'Outlet', 'è—¥å¦', 'è—¥å±€'] }
        ];

        let globalMerchantDB = {};
        let activeFilter = null;

        function init() {
            generateMerchantDB();
            renderCardOverview();
            renderQuickFilters();
            
            // Listeners
            document.getElementById('searchMerchant').addEventListener('input', handleSearchInput);
            document.getElementById('calcMerchant').addEventListener('input', handleCalcSearchInput);
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.input-wrapper')) {
                    document.getElementById('suggestionDropdown').style.display = 'none';
                    document.getElementById('calcSuggestionDropdown').style.display = 'none';
                }
            });
            // Show/Hide Unicard Scheme Select
            document.getElementById('calcMerchant').addEventListener('input', (e) => {
                const val = e.target.value.toLowerCase();
                // ç°¡å–®åˆ¤æ–·ï¼šè‹¥æœå°‹åˆ° Unicard ç›¸é—œé€šè·¯ï¼Œå¯è€ƒæ…®é¡¯ç¤º
                document.getElementById('unicardSchemeDiv').style.display = 'block'; 
            });
        }

        // === 1. è‡ªå‹•ç”Ÿæˆå•†å®¶è³‡æ–™åº« ===
        function generateMerchantDB() {
            globalMerchantDB = {};
            cardBenefitsData.forEach(card => {
                card.benefits.forEach(benefit => {
                    if (benefit.categories) {
                        Object.entries(benefit.categories).forEach(([catName, list]) => {
                            list.forEach(rawMerchant => {
                                const merchant = normalizationMap[rawMerchant] || rawMerchant;
                                const key = merchant.toLowerCase();
                                if (!globalMerchantDB[key]) {
                                    globalMerchantDB[key] = { name: merchant, category: catName, cards: [] };
                                }
                                
                                let rate = benefit.rate;
                                let note = benefit.note;
                                let scheme = benefit.name;

                                // æ–°æˆ¶é‚è¼¯ (Unicard)
                                if (card.id === 'unicard' && benefit.name === 'ç™¾å¤§ç‰¹åº—åå–®') {
                                    rate = 0.035; scheme = 'UPé¸'; // é è¨­ UP (3.5%)
                                    const newBonusBenefit = card.benefits.find(b => b.tag === 'new');
                                    if (newBonusBenefit) {
                                        const newBonusList = Object.values(newBonusBenefit.categories).flat();
                                        if (newBonusList.some(nm => rawMerchant.includes(nm) || merchant.includes(nm))) {
                                            rate = 0.065; note = 'å«æ–°æˆ¶åŠ ç¢¼ (ä¸Šé™$16,666)'; scheme = 'UPé¸+æ–°æˆ¶';
                                        } else note = 'ä¸Šé™$142,857';
                                    }
                                }
                                // UBear: ä¸€èˆ¬æŸ¥è©¢é¡¯ç¤ºæ¨™æº–è²»ç‡ï¼Œè©¦ç®—æ‰è™•ç†æ–°æˆ¶
                                if (card.id === 'ubear' && benefit.tag === 'net') {
                                    note = 'ä¸Šé™$7,500 (æ–°æˆ¶å¦è¨ˆ)';
                                }
                                if (card.id === 'richart') note = 'ç„¡ä¸Šé™';
                                if (card.id === 'cube') note = 'ç„¡ä¸Šé™';

                                if (!globalMerchantDB[key].cards.some(c => c.cardName === card.name && c.scheme === scheme)) {
                                    globalMerchantDB[key].cards.push({
                                        cardId: card.id, cardName: card.name, rate: rate, scheme: scheme, note: note, tag: benefit.tag
                                    });
                                }
                            });
                        });
                    }
                });
            });
        }

        // === 2. æœå°‹èˆ‡ç¯©é¸ ===
        function renderQuickFilters() {
            document.getElementById('quickCategoryTags').innerHTML = quickFilters.map(f => 
                `<div class="category-tag" onclick="applyCategoryFilter('${f.name}')">${f.name}</div>`
            ).join('');
        }
        function applyCategoryFilter(filterName) {
            const tags = document.querySelectorAll('.category-tag');
            if (activeFilter === filterName) {
                activeFilter = null; tags.forEach(t => t.classList.remove('active'));
                document.getElementById('merchantContainer').innerHTML = ''; return;
            }
            activeFilter = filterName; tags.forEach(t => t.classList.toggle('active', t.textContent === filterName));
            const filter = quickFilters.find(f => f.name === filterName);
            const matched = Object.values(globalMerchantDB).filter(d => filter.keywords.some(kw => d.category.includes(kw)));
            document.getElementById('merchantContainer').innerHTML = matched.length ? matched.map(d => generateMerchantCardHTML(d.name)).join('') : '<div style="text-align:center; padding:20px; color:#999;">ç„¡è³‡æ–™</div>';
        }
        function handleSearchInput(e) {
            const val = e.target.value.trim().toLowerCase();
            const dropdown = document.getElementById('suggestionDropdown');
            document.getElementById('clearSearch').style.display = val ? 'flex' : 'none';
            if (!val) { dropdown.style.display = 'none'; return; }
            let matches = new Set();
            for (const [alias, real] of Object.entries(aliasMap)) if (alias.includes(val)) matches.add(real);
            Object.keys(globalMerchantDB).forEach(k => { if(k.includes(val)) matches.add(globalMerchantDB[k].name); });
            const results = Array.from(matches).slice(0, 10);
            dropdown.innerHTML = results.length ? results.map(n => `<div class="suggestion-item" onclick="selectMerchant('${n}')">${n}</div>`).join('') : '<div class="suggestion-item" style="color:#999;">ç„¡ç›¸é—œè³‡æ–™</div>';
            dropdown.style.display = 'block';
        }
        function selectMerchant(name) {
            document.getElementById('searchMerchant').value = name;
            document.getElementById('suggestionDropdown').style.display = 'none';
            document.getElementById('merchantContainer').innerHTML = generateMerchantCardHTML(name);
        }
        function clearSearch() {
            document.getElementById('searchMerchant').value = '';
            document.getElementById('merchantContainer').innerHTML = '';
            document.getElementById('clearSearch').style.display = 'none';
            activeFilter = null; document.querySelectorAll('.category-tag').forEach(t => t.classList.remove('active'));
        }
        function generateMerchantCardHTML(name) {
            const key = name.toLowerCase();
            let data = globalMerchantDB[key];
            if (!data) {
                const fuzzy = Object.keys(globalMerchantDB).find(k => k.includes(key) || key.includes(k));
                if (fuzzy) data = globalMerchantDB[fuzzy];
            }
            let cards = data ? [...data.cards] : [];
            if (!cards.find(c => c.cardId === 'dawho')) cards.push({ cardId: 'dawho', cardName: 'æ°¸è± DAWHO', rate: 0.035, scheme: 'åœ‹å…§å…¨é€šè·¯', note: 'ä¸Šé™$16,000', tag: 'all' });
            cards.sort((a, b) => b.rate - a.rate);
            const best = cards[0];
            return `
                <div class="merchant-list" onclick='openRankingModal(${JSON.stringify(cards)}, "${data ? data.name : name}")'>
                    <div><div class="merchant-name">${data ? data.name : name}</div>${data ? `<span class="merchant-type">${data.category}</span>` : ''}</div>
                    <div class="merchant-best-info"><div class="best-rate">${(best.rate * 100).toFixed(1)}%</div><div class="best-card-name">ğŸ† ${best.cardName}</div></div>
                </div>
            `;
        }
        function openRankingModal(cards, merchantName) {
            const body = document.getElementById('detailBody');
            document.getElementById('modalTitle').innerText = `${merchantName} å›é¥‹æ’å`;
            const html = cards.map((c, idx) => {
                const isBest = idx === 0;
                let badgeClass = 'scheme-badge';
                if (c.tag === 'crazy') badgeClass += ' crazy'; if (c.rate >= 0.07) badgeClass += ' new-user';
                const warningHtml = (isBest && (c.cardId === 'richart' || c.cardId === 'cube')) ? `<div class="plan-warning">éœ€åˆ‡æ›è‡³ã€Œ${c.scheme}ã€</div>` : '';
                return `
                    <div class="detail-card-item ${isBest ? 'best-card' : ''}">
                        <div class="detail-card-header"><span>${isBest ? 'ğŸ† ' : ''}${c.cardName}</span><span>${(c.rate * 100).toFixed(1)}%</span></div>
                        <div class="detail-card-body">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <span class="${badgeClass}">${c.scheme}</span>
                                <span style="font-size:0.9em; color:#666;">${c.note.replace(/<[^>]*>/g, '')}</span>
                            </div>
                            ${warningHtml}
                        </div>
                    </div>
                `;
            }).join('');
            body.innerHTML = html;
            document.getElementById('detailModal').classList.add('show');
        }

        // === 3. è©¦ç®—åŠŸèƒ½ ===
        function handleCalcSearchInput(e) {
            const val = e.target.value.trim().toLowerCase();
            const dropdown = document.getElementById('calcSuggestionDropdown');
            if (!val) { dropdown.style.display = 'none'; return; }
            let matches = new Set();
            for (const [alias, real] of Object.entries(aliasMap)) if (alias.includes(val)) matches.add(real);
            Object.keys(globalMerchantDB).forEach(k => { if(k.includes(val)) matches.add(globalMerchantDB[k].name); });
            const results = Array.from(matches).slice(0, 5);
            dropdown.innerHTML = results.map(n => `<div class="suggestion-item" onclick="selectCalcMerchant('${n}')">${n}</div>`).join('');
            dropdown.style.display = 'block';
        }
        function selectCalcMerchant(name) {
            document.getElementById('calcMerchant').value = name;
            document.getElementById('calcSuggestionDropdown').style.display = 'none';
        }
        function calculateRewards() {
            const amount = parseFloat(document.getElementById('calcAmount').value);
            const merchantInput = document.getElementById('calcMerchant').value.trim();
            const isNewUser = document.getElementById('calcNewUser').checked;
            const unicardScheme = document.getElementById('calcUnicardScheme').value; // up, any, simple
            const container = document.getElementById('calcResults');

            if (!amount || !merchantInput) { container.innerHTML = '<div style="color:red; text-align:center;">è«‹è¼¸å…¥é‡‘é¡èˆ‡é€šè·¯</div>'; return; }

            const key = merchantInput.toLowerCase();
            let data = globalMerchantDB[key];
            if (!data) {
                const fuzzy = Object.keys(globalMerchantDB).find(k => k.includes(key) || key.includes(k));
                if (fuzzy) data = globalMerchantDB[fuzzy];
            }
            let cards = data ? [...data.cards] : [];
            if (!cards.find(c => c.cardId === 'dawho')) cards.push({ cardId: 'dawho', cardName: 'æ°¸è± DAWHO', scheme: 'åœ‹å…§å…¨é€šè·¯', tag: 'all' });

            const results = cards.map(c => {
                let reward = 0, detailText = '', limitReached = false, upgradeTip = '';
                
                // Richart / CUBE (ç„¡ä¸Šé™)
                if (c.cardId === 'richart' || c.cardId === 'cube') {
                    reward = amount * c.rate; detailText = `$${amount} Ã— ${(c.rate*100).toFixed(1)}% = $${Math.floor(reward)}`;
                }
                // DAWHO (3.5% limit 16000)
                else if (c.cardId === 'dawho') {
                    const cap = 16000;
                    if (amount <= cap) { reward = amount * 0.035; detailText = `$${amount} Ã— 3.5% = $${Math.floor(reward)}`; }
                    else { 
                        reward = (cap * 0.035) + ((amount - cap) * 0.01); 
                        detailText = `($${cap}Ã—3.5% = $${Math.floor(cap*0.035)}) + ($${amount-cap}Ã—1% = $${Math.floor((amount-cap)*0.01)})`; 
                        limitReached = true;
                    }
                }
                // UBear
                else if (c.cardId === 'ubear' && c.tag === 'net') {
                    const newUserCap = 2142, bonusCap = 7500;
                    if (isNewUser) {
                        // æ–°æˆ¶: 10% (2142) -> 3% (7500) -> 1%
                        let t1 = Math.min(amount, newUserCap);
                        let t2 = Math.min(Math.max(0, amount - t1), bonusCap - t1);
                        let t3 = Math.max(0, amount - t1 - t2);
                        reward = (t1 * 0.10) + (t2 * 0.03) + (t3 * 0.01);
                        detailText = `($${t1}Ã—10%=$${Math.floor(t1*0.1)}) + ($${t2}Ã—3%=$${Math.floor(t2*0.03)}) + ($${t3}Ã—1%=$${Math.floor(t3*0.01)})`;
                        if (amount > newUserCap) limitReached = true;
                    } else {
                        // èˆŠæˆ¶: 3% (7500) -> 1%
                        let t1 = Math.min(amount, bonusCap);
                        let t2 = Math.max(0, amount - bonusCap);
                        reward = (t1 * 0.03) + (t2 * 0.01);
                        detailText = `($${t1}Ã—3%=$${Math.floor(t1*0.03)}) + ($${t2}Ã—1%=$${Math.floor(t2*0.01)})`;
                        if (amount > bonusCap) limitReached = true;
                    }
                }
                // Unicard
                else if (c.cardId === 'unicard' && c.tag === 'list') {
                    let schemeRate = 0.02, cap = 50000; // default Simple
                    let schemeName = 'ç°¡å–®é¸';
                    
                    if (unicardScheme === 'up') { schemeRate = 0.035; cap = 142857; schemeName = 'UPé¸'; }
                    else if (unicardScheme === 'any') { schemeRate = 0.025; cap = 50000; schemeName = 'ä»»æ„é¸'; }

                    // æ–°æˆ¶åŠ ç¢¼åˆ¤æ–·
                    const newBonusList = ['line pay', 'uber eats', 'å®¶æ¨‚ç¦', 'éŸ“åœ‹', 'å…¨ç›ˆ'];
                    const isNewBonus = newBonusList.some(kw => merchantInput.toLowerCase().includes(kw));
                    const newUserCap = 16666;

                    if (isNewUser && isNewBonus) {
                        let t1 = Math.min(amount, newUserCap); // Scheme+3% (max 16666)
                        let t2 = Math.min(Math.max(0, amount - t1), cap - t1); // Scheme
                        let t3 = Math.max(0, amount - t1 - t2); // 1%
                        
                        let finalRate1 = schemeRate + 0.03;
                        reward = (t1 * finalRate1) + (t2 * schemeRate) + (t3 * 0.01);
                        detailText = `($${t1}Ã—${(finalRate1*100).toFixed(1)}%=$${Math.floor(t1*finalRate1)}) + ($${t2}Ã—${(schemeRate*100).toFixed(1)}%=$${Math.floor(t2*schemeRate)}) + ($${t3}Ã—1%=$${Math.floor(t3*0.01)})`;
                        c.scheme = schemeName + "+æ–°æˆ¶";
                        if (amount > newUserCap) limitReached = true;
                    } else {
                        let t1 = Math.min(amount, cap);
                        let t2 = Math.max(0, amount - cap);
                        reward = (t1 * schemeRate) + (t2 * 0.01);
                        detailText = `($${t1}Ã—${(schemeRate*100).toFixed(1)}%=$${Math.floor(t1*schemeRate)}) + ($${t2}Ã—1%=$${Math.floor(t2*0.01)})`;
                        c.scheme = schemeName;
                        if (amount > cap) limitReached = true;
                    }

                    // UP Upgrade Tip
                    if (unicardScheme !== 'up' && amount > 15000) {
                         upgradeTip = '<div class="upgrade-tip">ğŸ’¡ æ¶ˆè²»æ»¿ 1.5 è¬ï¼Œå»ºè­°è¨‚é–±å‡ç´š [UPé¸] å›é¥‹æœ€é«˜ï¼</div>';
                    }
                }
                else {
                    reward = amount * c.rate; detailText = `$${amount} Ã— ${(c.rate*100).toFixed(1)}% = $${Math.floor(reward)}`;
                }
                return { ...c, reward: Math.floor(reward), detail: detailText, limitReached, upgradeTip };
            });

            results.sort((a, b) => b.reward - a.reward);
            container.innerHTML = results.map((res, idx) => `
                <div class="calc-result-item ${idx===0 ? 'winner' : ''}">
                    <div class="calc-header">
                        <span style="font-weight:700;">${idx+1}. ${res.cardName} (${res.scheme})</span>
                        <span class="calc-money">$${res.reward}</span>
                    </div>
                    <div style="font-size:0.9em; color:${idx===0?'var(--color-success)':'#555'};">
                        å¹³å‡å›é¥‹ç‡ï¼š${((res.reward/amount)*100).toFixed(2)}%
                        ${res.limitReached ? '<span class="limit-reached">(å·²é”ä¸Šé™)</span>' : ''}
                    </div>
                    <div class="calc-detail">${res.detail}</div>
                    ${res.upgradeTip || ''}
                </div>
            `).join('');
        }

        // === æ¬Šç›Šç¸½è¦½é¡¯ç¤º ===
        function renderCardOverview() {
            document.getElementById('cardOverviewContainer').innerHTML = cardBenefitsData.map((card, idx) => `
                <div class="card-accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <div class="card-title-row"><span class="card-icon">${card.icon}</span><span class="card-title-text">${card.name}</span></div><span class="chevron">â–¼</span>
                    </div>
                    <div class="accordion-body">
                        <div class="benefit-row no-action" style="background:#fffcec;"><div class="benefit-desc">${card.note}</div></div>
                        ${renderBenefits(card, idx)}
                    </div>
                </div>
            `).join('');
        }
        function renderBenefits(card, cardIndex) {
            return card.benefits.map((b, bIndex) => {
                if (b.type === 'text') return `<div class="benefit-row no-action"><div class="benefit-header"><span class="benefit-name">${b.name}</span><span class="benefit-rate">${(b.rate * 100).toFixed(1)}%</span></div><div class="benefit-desc">${b.desc}</div></div>`;
                return `<div class="benefit-row" onclick="openSchemeList(${cardIndex}, ${bIndex})"><div class="benefit-header"><span class="benefit-name">${b.name}</span><span class="benefit-rate">${(b.rate * 100).toFixed(1)}%</span></div><div class="benefit-desc">${b.desc}</div></div>`;
            }).join('');
        }
        function openSchemeList(cardIndex, benefitIndex) {
            const benefit = cardBenefitsData[cardIndex].benefits[benefitIndex];
            document.getElementById('modalTitle').innerText = `${cardBenefitsData[cardIndex].name} - ${benefit.name}`;
            let htmlContent = `<div style="margin-bottom:15px; font-size:0.9em; color:#666;">${benefit.note}</div>`;
            if (benefit.categories) {
                Object.entries(benefit.categories).forEach(([categoryName, items]) => {
                    htmlContent += `<div class="detail-category-group"><div class="detail-category-title">${categoryName}</div><div class="scheme-list-container">${items.map(item => `<span class="scheme-list-item">${item}</span>`).join('')}</div></div>`;
                });
            }
            document.getElementById('detailBody').innerHTML = htmlContent;
            document.getElementById('detailModal').classList.add('show');
        }
        function toggleAccordion(header) {
            const body = header.nextElementSibling;
            const isOpen = body.classList.contains('open');
            if(!isOpen) { body.classList.add('open'); header.classList.add('active'); } else { body.classList.remove('open'); header.classList.remove('active'); }
        }
        function switchTab(tabId) {
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.querySelector(`.nav-item[onclick="switchTab('${tabId}')"]`).classList.add('active');
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(`tab-${tabId}`).classList.add('active');
        }
        function closeDetailModal() { document.getElementById('detailModal').classList.remove('show'); }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
