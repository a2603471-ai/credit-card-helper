<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ä¿¡ç”¨å¡å›é¥‹æŸ¥è©¢åŠ©æ‰‹ 2026</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --color-primary: #2180a0;
            --color-bg: #f5f5f5;
            --color-surface: #ffffff;
            --color-text: #333333;
            --color-border: #e0e0e0;
            --color-success: #2e7d32;
            
            /* === å“ç‰Œè‰²å®šç¾© === */
            --brand-richart: #e01a22;
            --brand-cube: #00AA4F;
            --brand-unicard: #1890ff;
            --brand-ubear: #e6b800;
            --brand-dawho: #2d3436;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            padding: 20px;
            line-height: 1.6;
            padding-bottom: 90px;
            -webkit-tap-highlight-color: transparent;
        }
        
        .container { max-width: 800px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 15px; color: var(--color-primary); font-size: 1.5em; font-weight: 800; }

        /* === å°è¦½åˆ— === */
        .nav-tabs {
            display: flex; background: var(--color-surface); padding: 5px;
            border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 20px; position: sticky; top: 10px; z-index: 900;
        }
        .nav-item {
            flex: 1; text-align: center; padding: 10px; cursor: pointer;
            border-radius: 8px; font-weight: 600; color: #999;
            display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px;
        }
        .nav-icon { font-size: 1.2em; display: none; }
        .nav-item.active { background-color: var(--color-primary); color: white; }

        @media (max-width: 768px) {
            .nav-tabs {
                position: fixed; bottom: 0; left: 0; right: 0; top: auto;
                margin-bottom: 0; border-radius: 0; padding: 8px 5px env(safe-area-inset-bottom) 5px;
                background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
                border-top: 1px solid #eee; box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            }
            .nav-item { background: transparent !important; color: #999; font-size: 0.75rem; }
            .nav-item.active { color: var(--color-primary); }
            .nav-icon { display: block; }
            body { padding: 15px; padding-bottom: 100px; }
        }

        .tab-content { display: none; animation: fadeIn 0.3s ease-out; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* === è¡¨å–®å€åŸŸ === */
        .form-section {
            background: var(--color-surface); padding: 16px;
            border-radius: 12px; margin-bottom: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .info-text {
            background: #e3f2fd; padding: 10px; border-radius: 8px; color: #0d47a1;
            margin-bottom: 12px; font-size: 0.85em; border-left: 4px solid #2196f3;
        }
        .form-group { margin-bottom: 12px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9em; }
        input[type="text"], input[type="number"], select {
            width: 100%; padding: 12px; border: 1px solid var(--color-border);
            border-radius: 10px; font-size: 16px; background: #fff;
        }
        .input-wrapper { position: relative; display: flex; align-items: center; }
        .clear-btn {
            position: absolute; right: 8px; background: #ddd; border: none; border-radius: 50%;
            width: 24px; height: 24px; cursor: pointer; color: #fff; display: none;
            font-size: 12px; z-index: 5;
        }

        .controls-row { display: flex; gap: 8px; margin-bottom: 12px; }
        .control-group { flex: 1; }
        .toggle-btn {
            display: flex; align-items: center; justify-content: center; height: 46px;
            background: #fff; border: 1px solid var(--color-border); border-radius: 10px;
            cursor: pointer; font-size: 0.9em; flex: 1; transition: 0.2s;
        }
        .toggle-btn.active { background: #e3f2fd; border-color: var(--color-primary); color: var(--color-primary); font-weight: 700; }
        .suggestion-dropdown {
            position: absolute; top: 100%; left: 0; right: 0; background: #fff;
            border: 1px solid var(--color-border); border-radius: 0 0 10px 10px;
            max-height: 200px; overflow-y: auto; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: none;
        }
        .suggestion-item { padding: 12px; cursor: pointer; border-bottom: 1px solid #f5f5f5; }

        /* === æœå°‹çµæœåˆ—è¡¨ === */
        .merchant-list {
            background: #fff; padding: 14px; border-radius: 12px; margin-bottom: 10px;
            display: flex; justify-content: space-between; align-items: center;
            border-left: 5px solid #ccc; box-shadow: 0 2px 4px rgba(0,0,0,0.03);
        }
        .card-theme-richart { border-left-color: var(--brand-richart) !important; }
        .card-theme-cube { border-left-color: var(--brand-cube) !important; }
        .card-theme-unicard { border-left-color: var(--brand-unicard) !important; }
        .card-theme-ubear { border-left-color: var(--brand-ubear) !important; }
        .card-theme-dawho { border-left-color: var(--brand-dawho) !important; }

        .merchant-name { font-size: 1em; font-weight: 700; }
        .best-rate { color: var(--color-primary); font-weight: 800; font-size: 1.3em; }
        .best-card-name { font-size: 0.8em; color: #666; display: flex; align-items: center; justify-content: flex-end; gap: 4px; }
        .card-icon-shape { width: 10px; height: 10px; border-radius: 50%; display: inline-block; }
        .scheme-badge {
            background-color: #e3f2fd; color: var(--color-primary); border: 1px solid #b3e5fc;
            padding: 2px 8px; border-radius: 10px; font-size: 0.75em; font-weight: 700;
        }
        .scheme-badge.new-user { background-color: #fff3e0; color: #e65100; border-color: #ffe0b2; }

        /* === è©¦ç®—çµæœæ¨£å¼ === */
        .calc-result-item { 
            margin-bottom: 10px; padding: 14px; background: white; 
            border: 1px solid #eee; border-radius: 12px; border-left: 5px solid #ccc;
        }
        .calc-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .calc-money { 
            font-size: 1.4em; font-weight: 800; color: #333; 
            text-align: right; white-space: nowrap; flex-shrink: 0; margin-left: 10px;
        }
        .winner .calc-money { font-size: 1.6em; }
        
        .winner.card-theme-richart .calc-money { color: var(--brand-richart); }
        .winner.card-theme-cube .calc-money { color: var(--brand-cube); }
        .winner.card-theme-unicard .calc-money { color: var(--brand-unicard); }
        .winner.card-theme-ubear .calc-money { color: #b8860b; }
        .winner.card-theme-dawho .calc-money { color: var(--brand-dawho); }

        /* æ‹†å–®å»ºè­°æ¡† */
        .split-box {
            margin-top: 10px; padding: 10px; background: #f1f8e9;
            border: 1px dashed #aed581; border-radius: 8px; color: #33691e; font-size: 0.85em;
        }
        .split-title { font-weight: 800; margin-bottom: 4px; display: flex; align-items: center; gap: 4px; }

        /* === å½ˆçª—å„ªåŒ– === */
        .detail-modal {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6); z-index: 2000; justify-content: center; align-items: center; padding: 20px;
        }
        .detail-modal.show { display: flex; }
        .detail-content {
            background: #fff; border-radius: 16px; width: 100%; max-width: 450px;
            max-height: 80vh; display: flex; flex-direction: column; overflow: hidden;
        }
        .detail-header { padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; }
        .detail-body { padding: 15px; overflow-y: auto; }
        .detail-card-item { margin-bottom: 10px; border: 1px solid #eee; border-radius: 10px; border-left: 4px solid #ccc; }
        .detail-card-header { padding: 8px 12px; background: #f9f9f9; font-size: 0.9em; font-weight: 700; display: flex; justify-content: space-between; }
        .detail-card-body { padding: 10px 12px; font-size: 0.85em; } /* æ‰‹æ©Ÿå­—é«”ç¸®å°é¿å…æ“æ“  */

        .category-tags { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 10px; }
        .category-tag { padding: 6px 12px; background: #fff; border: 1px solid #ddd; border-radius: 20px; font-size: 0.8em; cursor: pointer; }
        .category-tag.active { background: var(--color-primary); color: #fff; border-color: var(--color-primary); }

        .action-btn { width: 100%; padding: 14px; background: var(--color-primary); color: #fff; border: none; border-radius: 12px; font-weight: 700; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ’³ ä¿¡ç”¨å¡å›é¥‹æŸ¥è©¢ 2026</h1>

        <div class="nav-tabs">
            <div class="nav-item active" onclick="switchTab('search')"><span class="nav-icon">ğŸ”</span><span>é€šè·¯æœå°‹</span></div>
            <div class="nav-item" onclick="switchTab('overview')"><span class="nav-icon">ğŸ“‹</span><span>æ¬Šç›Šç¸½è¦½</span></div>
            <div class="nav-item" onclick="switchTab('calculator')"><span class="nav-icon">ğŸ’°</span><span>å›é¥‹è©¦ç®—</span></div>
        </div>

        <div id="tab-search" class="tab-content active">
            <div class="form-section">
                <div class="info-text">âœ¨ <strong>2026 æ–°æˆ¶åŠ ç¢¼</strong>ï¼šUnicard æœ€é«˜ 7.5%ã€UBear ç¶²è³¼ 10%ã€‚</div>
                <div class="form-group">
                    <div class="input-wrapper">
                        <input type="text" id="searchMerchant" placeholder="è¼¸å…¥å•†å®¶ (å¦‚ï¼šå…¨å®¶ã€é«˜éµ)..." autocomplete="off">
                        <button id="clearSearchBtn" class="clear-btn" onclick="clearSearch('searchMerchant', 'clearSearchBtn', true)">âœ•</button>
                        <div id="suggestionDropdown" class="suggestion-dropdown"></div>
                    </div>
                </div>
                <div class="controls-row">
                    <div class="control-group">
                        <select id="searchUnicardScheme" onchange="debouncedReSearch()">
                            <option value="any" selected>Unicard: ä»»æ„é¸ (3.5%)</option>
                            <option value="simple">Unicard: ç°¡å–®é¸ (3.0%)</option>
                            <option value="up">Unicard: UPé¸ (4.5%)</option>
                        </select>
                    </div>
                    <div class="toggle-btn" id="searchNewUserBtn" onclick="toggleSearchNewUser()">
                        <input type="checkbox" id="searchNewUser" style="display:none"><span>æˆ‘æ˜¯æ–°æˆ¶</span>
                    </div>
                </div>
                <div class="category-tags" id="quickCategoryTags"></div>
            </div>
            <div id="merchantContainer"></div>
        </div>

        <div id="tab-overview" class="tab-content"><div id="cardOverviewContainer"></div></div>

        <div id="tab-calculator" class="tab-content">
            <div class="form-section">
                <div class="form-group"><label>æ¶ˆè²»é‡‘é¡</label><input type="number" id="calcAmount" placeholder="è¼¸å…¥é‡‘é¡" inputmode="numeric"></div>
                <div class="form-group">
                    <label>æ¶ˆè²»é€šè·¯</label>
                    <div class="input-wrapper">
                        <input type="text" id="calcMerchant" placeholder="è¼¸å…¥é€šè·¯ (å¦‚ï¼šè¦çš®)">
                        <button id="clearCalcBtn" class="clear-btn" onclick="clearSearch('calcMerchant', 'clearCalcBtn', false)">âœ•</button>
                        <div id="calcSuggestionDropdown" class="suggestion-dropdown"></div>
                    </div>
                </div>
                <div class="controls-row">
                    <div class="control-group">
                        <select id="calcUnicardScheme">
                            <option value="any" selected>Unicard: ä»»æ„é¸</option>
                            <option value="simple">Unicard: ç°¡å–®é¸</option>
                            <option value="up">Unicard: UPé¸</option>
                        </select>
                    </div>
                    <div class="toggle-btn" id="calcNewUserBtn" onclick="toggleCalcNewUser()">
                        <input type="checkbox" id="calcNewUser" style="display:none"><span>æˆ‘æ˜¯æ–°æˆ¶</span>
                    </div>
                </div>
                <button onclick="calculateRewards()" class="action-btn">é–‹å§‹è©¦ç®—</button>
            </div>
            <div id="calcResults"></div>
        </div>
    </div>

    <div id="detailModal" class="detail-modal" onclick="if(event.target === this) closeDetailModal()">
        <div class="detail-content">
            <div class="detail-header"><h2 id="modalTitle" style="font-size:1.2rem">æ’å</h2><button onclick="closeDetailModal()" style="border:none; background:none; font-size:1.5rem">âœ•</button></div>
            <div id="detailBody" class="detail-body"></div>
        </div>
    </div>

    <script>
        const formatMoney = (num) => '$' + Math.floor(num).toLocaleString();
        const formatRate = (num) => (num * 100).toFixed(1).replace('.0', '') + '%';
        const debounce = (f, d=300) => { let t; return (...a) => { clearTimeout(t); t=setTimeout(()=>f(...a),d); } };

        const brandColorMap = {
            'richart': { class: 'card-theme-richart', color: '#e01a22' },
            'cube': { class: 'card-theme-cube', color: '#00AA4F' },
            'unicard': { class: 'card-theme-unicard', color: '#1890ff' },
            'ubear': { class: 'card-theme-ubear', color: '#e6b800' },
            'dawho': { class: 'card-theme-dawho', color: '#2d3436' }
        };

        const cardBenefitsData = [
            {
                id: 'richart', name: 'å°æ–° Richart', note: 'éœ€æ¯æ—¥ App åˆ‡æ›æ¬Šç›Š (ç„¡ä¸Šé™)',
                benefits: [
                    { name: 'ä¸€èˆ¬æ¶ˆè²»', rate: 0.003, desc: 'åœ‹å…§å¤–ä¸€èˆ¬æ¶ˆè²»', type: 'text', note: '0.3%', cap: Infinity },
                    { name: 'Payè‘—åˆ·', rate: 0.038, desc: 'ç¶å®šå°æ–°Pay', note: '3.8%', tag: 'pay', cap: Infinity, categories: { 'è¡Œå‹•æ”¯ä»˜':['7-11','å…¨å®¶','æ–°å…‰ä¸‰è¶Š','IKEA','NET','éº¥ç•¶å‹'] } },
                    { name: 'LINE Pay', rate: 0.023, desc: 'LINE Pay ç¶å®šæ”¯ä»˜', note: '2.3%', tag: 'line', cap: Infinity, categories: { 'æ”¯ä»˜':['LINE Pay'] } },
                    { name: 'å‡æ—¥åˆ·', rate: 0.02, desc: 'åœ‹å…§ç¯€å‡æ—¥æ¶ˆè²»', note: '2%', tag: 'holiday', cap: Infinity },
                    { name: 'æ•¸è¶£åˆ·', rate: 0.033, desc: 'ç¶²è³¼ | éŠæˆ² | AI', note: '3.3%', tag: 'digital', cap: Infinity, categories: { 'ç¶²è³¼':['è¦çš®','momo','PChome','æ·˜å¯¶','Amazon','Coupang','åšå®¢ä¾†'], 'å½±éŸ³':['Netflix','Disney+','Youtube','Spotify','ChatGPT'] } },
                    { name: 'ç©æ—…åˆ·', rate: 0.033, desc: 'æµ·å¤– | èˆªç©º | è¨‚æˆ¿', note: '3.3%', tag: 'travel', cap: Infinity, categories: { 'æ—…éŠ':['æµ·å¤–æ¶ˆè²»','æ—¥æœ¬','éŸ“åœ‹','Klook','Agoda','Booking','è¯èˆª','é•·æ¦®','æ˜Ÿå®‡','Uber'] } },
                    { name: 'å¤©å¤©åˆ·', rate: 0.033, desc: 'è¶…å•†é‡è²© | äº¤é€š', note: '3.3%', tag: 'daily', cap: Infinity, categories: { 'æ—¥å¸¸':['å…¨å®¶','7-11','å®¶æ¨‚ç¦','é«˜éµ','å°éµ','Uber','yoxi','å±ˆè‡£æ°','åº·æ˜¯ç¾','å¯¶é›…'] } },
                    { name: 'å¤§ç­†åˆ·', rate: 0.033, desc: 'ç™¾è²¨ | Outlet | å±…å®¶', note: '3.3%', tag: 'big', cap: Infinity, categories: { 'ç™¾è²¨':['æ–°å…‰ä¸‰è¶Š','é æ±SOGO','å·¨åŸ','æ¼¢ç¥','101','è¯æ³°åå“åŸ','ä¸‰äº•OUTLET','IKEA','ç‰¹åŠ›å±‹','UNIQLO','GU'] } },
                    { name: 'å¥½é¥—åˆ·', rate: 0.033, desc: 'é¤é£² | å¤–é€ | åŠ æ²¹', note: '3.3%', tag: 'fun', cap: Infinity, categories: { 'é¤é£²':['åœ‹å…§é¤é£²','Uber Eats','foodpanda','ä¸­æ²¹ç›´ç‡Ÿ','éŒ¢æ«ƒ','å¥½æ¨‚è¿ª'] } }
                ]
            },
            {
                id: 'cube', name: 'åœ‹æ³° CUBE', note: 'éœ€æ¯æ—¥ App åˆ‡æ›æ–¹æ¡ˆ (ç„¡ä¸Šé™)',
                benefits: [
                    { name: 'ä¸€èˆ¬æ¶ˆè²»', rate: 0.003, desc: 'ä¸€èˆ¬æ¶ˆè²» (ç„¡ä¸Šé™)', type: 'text', note: '0.3%', cap: Infinity },
                    { name: 'ç˜‹å¤§æ¸¯', rate: 0.035, desc: 'é«˜é›„ä½å®¿ | Klook | é«˜éµå°éµ', note: '3.5%', tag: 'crazy', cap: Infinity, categories: { 'æŒ‡å®š':['Klook','é«˜éµ','å°éµ'] } },
                    { name: 'ç©æ•¸ä½', rate: 0.03, desc: 'ç¶²è³¼ | å½±éŸ³ | AI', note: '3%', tag: 'digital', cap: Infinity, categories: { 'ç¶²è³¼':['è¦çš®','momo','PChome','æ·˜å¯¶','Coupang'], 'å½±éŸ³':['Netflix','Disney+','Spotify','Apple','Google Play'] } },
                    { name: 'æ¨‚éŸ¿è³¼', rate: 0.03, desc: 'ç™¾è²¨ | é¤é£² | å¤–é€ | è—¥å¦', note: '3%', tag: 'fun', cap: Infinity, categories: { 'ç”Ÿæ´»':['æ–°å…‰ä¸‰è¶Š','SOGO','é æ±ç™¾è²¨','101','åœ‹å…§é¤é£²','éº¥ç•¶å‹','Uber Eats','foodpanda','åº·æ˜¯ç¾','å±ˆè‡£æ°'] } },
                    { name: 'è¶£æ—…è¡Œ', rate: 0.03, desc: 'æµ·å¤– | è¨‚æˆ¿ | èˆªç©º | äº¤é€š', note: '3%', tag: 'travel', cap: Infinity, categories: { 'æ—…éŠ':['æµ·å¤–å¯¦é«”','æ—¥æœ¬','éŸ“åœ‹','Klook','Agoda','Booking','Airbnb','è¯èˆª','é•·æ¦®','æ˜Ÿå®‡','é«˜éµ','Uber','yoxi','ä¸­æ²¹ç›´ç‡Ÿ'] } },
                    { name: 'é›†ç²¾é¸', rate: 0.02, desc: 'è¶…å•† | é‡è²© | åŠ æ²¹ | IKEA', note: '2%', tag: 'base', cap: Infinity, categories: { 'ç²¾é¸':['7-11','å…¨å®¶','å…¨è¯','å®¶æ¨‚ç¦','ä¸­æ²¹ç›´ç‡Ÿ','IKEA'] } }
                ]
            },
            {
                id: 'unicard', name: 'ç‰å±± Unicard', note: 'ç°¡å–®/ä»»æ„/UP (åŠ ç¢¼ä¸Šé™åˆ· 4è¬ ~ 14è¬)',
                benefits: [
                    { name: 'ä¸€èˆ¬æ¶ˆè²»', rate: 0.01, desc: 'ä¸€èˆ¬æ¶ˆè²»', type: 'text', note: '1%', cap: Infinity, categories: {} },
                    { name: 'UPé¸', rate: 0.045, desc: 'ç™¾å¤§ç‰¹åº— (éœ€149é»è¨‚é–±)', note: 'ä¸€èˆ¬1% + UPé¸3.5% (ä¸Šé™åˆ·$142,857)', tag: 'list', cap: 142857, categories: { 'ç™¾å¤§':['LINE Pay','è¡—å£','å…¨æ”¯ä»˜','é«˜éµ','å°éµ','ä¸­æ²¹ç›´ç‡Ÿ','æ–°å…‰ä¸‰è¶Š','é æ±','Uber Eats','foodpanda','éº¥ç•¶å‹','momo','è¦çš®','æ·˜å¯¶','Coupang','æ—¥æœ¬','éŸ“åœ‹','Agoda','Klook','å®¶æ¨‚ç¦','å±ˆè‡£æ°','UNIQLO'] } },
                    { name: 'ä»»æ„é¸', rate: 0.035, desc: 'ç™¾å¤§ç‰¹åº— (éœ€è¨­å®š8å®¶)', note: 'ä¸€èˆ¬1% + ä»»æ„é¸2.5% (ä¸Šé™åˆ·$400,000)', tag: 'list', cap: 400000 },
                    { name: 'ç°¡å–®é¸', rate: 0.03, desc: 'ç™¾å¤§ç‰¹åº—', note: 'ä¸€èˆ¬1% + ç°¡å–®é¸2% (ä¸Šé™åˆ·$500,000)', tag: 'list', cap: 500000 },
                    { name: 'æ–°æˆ¶å›é¥‹', rate: 0.03, tag: 'new', note: 'æ–°æˆ¶+3% (ä¸Šé™åˆ·$14,667)', cap: 14667 }
                ]
            },
            {
                id: 'ubear', name: 'ç‰å±± UBear', note: 'å¨›æ¨‚10% / ç¶²è³¼3% (ç¶²è³¼ä¸Šé™åˆ· $7,500)',
                benefits: [
                    { name: 'ä¸€èˆ¬æ¶ˆè²»', rate: 0.01, desc: 'ä¸€èˆ¬æ¶ˆè²»', type: 'text', note: '1%', cap: Infinity, categories: {} },
                    { name: 'å½±éŸ³å¨›æ¨‚', rate: 0.10, desc: 'Netflix | Disney+ | Nintendo', note: '10% (ä¸Šé™åˆ·$1000)', tag: 'ent', cap: 1000, categories: { 'å½±éŸ³':['Netflix','Disney+','Nintendo','PlayStation','KKBOX','iTunes','Google Play'] } },
                    { name: 'ç¶²è³¼/Pay', rate: 0.03, desc: 'ç¶²è³¼ | è¡Œå‹•æ”¯ä»˜', note: 'ä¸€èˆ¬1% + ç¶²è³¼2% (ä¸Šé™åˆ·$7500)', tag: 'net', cap: 7500, categories: { 'ç¶²è³¼':['LINE Pay','è¡—å£','æ‚ éŠä»˜','OPENéŒ¢åŒ…','icash Pay','PChome','momo','è¦çš®','Coupang','æ·˜å¯¶','åšå®¢ä¾†','Uber','é«˜éµ','å°éµ','Uber Eats','foodpanda'] } },
                    { name: 'æ–°æˆ¶åŠ ç¢¼', rate: 0.07, tag: 'bonus', note: 'æ–°æˆ¶+7% (ä¸Šé™åˆ·$2142)', cap: 2142 }
                ]
            },
            {
                id: 'dawho', name: 'æ°¸è± DAWHO', note: 'å¤§æˆ¶ç­‰ç´šï¼šåœ‹å…§3.5%/åœ‹å¤–4.5% (ä¸Šé™åˆ· 1.6 è¬)',
                benefits: [
                    { name: 'ä¸€èˆ¬æ¶ˆè²»', rate: 0.01, desc: 'ä¸€èˆ¬æ¶ˆè²»', type: 'text', note: '1%', cap: Infinity, categories: {} },
                    { name: 'åœ‹å…§å…¨é€šè·¯', rate: 0.035, desc: 'åœ‹å…§åŠ ç¢¼', note: 'ä¸€èˆ¬1% + ä»»å‹™2.5% (ä¸Šé™åˆ·$16,000)', tag: 'all', cap: 16000, categories: { 'å…¨é€šè·¯':['åœ‹å…§æ¶ˆè²»'] } },
                    { name: 'åœ‹å¤–å…¨é€šè·¯', rate: 0.045, desc: 'åœ‹å¤–åŠ ç¢¼', note: 'ä¸€èˆ¬2% + ä»»å‹™2.5% (ä¸Šé™åˆ·$16,000)', tag: 'foreign', cap: 16000, categories: { 'å…¨é€šè·¯':['åœ‹å¤–æ¶ˆè²»','æ—¥æœ¬','éŸ“åœ‹'] } },
                    { name: 'æ‚ éŠå¡', rate: 0.03, desc: 'è‡ªå‹•åŠ å€¼', note: '3% (ä¸Šé™åˆ·$3333)', tag: 'easy', cap: 3333 }
                ]
            }
        ];

        const normalizationMap = { 'å…¨å®¶':'å…¨å®¶', '7-11':'7-11', 'è¦çš®':'è¦çš®', 'é«˜éµ':'é«˜éµ', 'å°éµ':'å°éµ', 'ä¸­æ²¹':'ä¸­æ²¹ç›´ç‡Ÿ', 'linepay':'LINE Pay', 'ubereats':'Uber Eats', 'momo':'momo' };
        const quickFilters = [
            { name: 'ğŸª è¶…å•†é‡è²©', kw: ['è¶…å•†','é‡è²©','å…¨è¯','å®¶æ¨‚ç¦'] },
            { name: 'ğŸ” é¤é£²å¤–é€', kw: ['é¤é£²','å¤–é€','éº¥ç•¶å‹'] },
            { name: 'ğŸ›ï¸ ç¶²è³¼å¹³å°', kw: ['ç¶²è³¼','é›»å•†','è¦çš®','momo'] },
            { name: 'ğŸš„ äº¤é€šæ—…éŠ', kw: ['äº¤é€š','æ—…éŠ','æ—¥æœ¬','é«˜éµ'] },
            { name: 'ğŸ’³ è¡Œå‹•æ”¯ä»˜', kw: ['æ”¯ä»˜','Pay'] }
        ];

        let globalMerchantDB = {};
        let activeFilter = null;

        function init() {
            generateDB(); renderQuickFilters(); renderOverview();
            document.getElementById('searchMerchant').addEventListener('input', (e) => {
                document.getElementById('clearSearchBtn').style.display = e.target.value ? 'flex' : 'none';
                debouncedSearch(e);
            });
            document.getElementById('calcMerchant').addEventListener('input', handleCalcSuggest);
        }

        const debouncedSearch = debounce((e) => {
            const val = e.target.value.trim().toLowerCase();
            if (val) renderMerchantResult(val);
        });

        function generateDB() {
            globalMerchantDB = {};
            cardBenefitsData.forEach(card => {
                card.benefits.forEach(b => {
                    if (card.id === 'unicard' && b.tag === 'new') return; // éš±è—ç¨ç«‹æ–°æˆ¶é …
                    if (b.categories) {
                        Object.entries(b.categories).forEach(([cat, list]) => {
                            list.forEach(m => {
                                const key = (normalizationMap[m.toLowerCase()] || m).toLowerCase();
                                if (!globalMerchantDB[key]) globalMerchantDB[key] = { name: m, category: cat, cards: [] };
                                if (!globalMerchantDB[key].cards.some(c => c.scheme === b.name)) {
                                    globalMerchantDB[key].cards.push({ cardId: card.id, cardName: card.name, rate: b.rate, scheme: b.name, note: b.note, tag: b.tag, cap: b.cap });
                                }
                            });
                        });
                    }
                });
            });
        }

        function renderQuickFilters() {
            document.getElementById('quickCategoryTags').innerHTML = quickFilters.map(f => `<div class="category-tag" onclick="applyFilter('${f.name}')">${f.name}</div>`).join('');
        }
        function applyFilter(name) {
            const tags = document.querySelectorAll('.category-tag');
            if (activeFilter === name) { activeFilter = null; tags.forEach(t => t.classList.remove('active')); document.getElementById('merchantContainer').innerHTML = ''; return; }
            activeFilter = name; tags.forEach(t => t.classList.toggle('active', t.innerText === name));
            const kw = quickFilters.find(f => f.name === name).kw;
            const matched = Object.values(globalMerchantDB).filter(d => kw.some(k => d.category.includes(k) || d.name.includes(k)));
            document.getElementById('merchantContainer').innerHTML = matched.map(d => generateCardHTML(d.name)).join('');
        }

        function toggleSearchNewUser() {
            const chk = document.getElementById('searchNewUser');
            chk.checked = !chk.checked;
            document.getElementById('searchNewUserBtn').classList.toggle('active', chk.checked);
            const val = document.getElementById('searchMerchant').value.trim();
            if (val) renderMerchantResult(val); else if (activeFilter) applyFilter(activeFilter);
        }

        function renderMerchantResult(name) { document.getElementById('merchantContainer').innerHTML = generateCardHTML(name); }

        function generateCardHTML(name) {
            const key = name.toLowerCase();
            let data = globalMerchantDB[key] || Object.values(globalMerchantDB).find(d => d.name.toLowerCase().includes(key));
            let cards = data ? JSON.parse(JSON.stringify(data.cards)) : [];
            const isNew = document.getElementById('searchNewUser').checked;
            const uniScheme = document.getElementById('searchUnicardScheme').value;

            // è£œä¸Šé€šç”¨å¡
            if (!cards.find(c => c.cardId === 'dawho')) {
                const isF = ['åœ‹å¤–','æ—¥æœ¬','éŸ“åœ‹','æµ·å¤–'].some(k => name.includes(k));
                cards.push({ cardId: 'dawho', cardName: 'æ°¸è± DAWHO', rate: isF?0.045:0.035, scheme: isF?'åœ‹å¤–æ¶ˆè²»':'åœ‹å…§æ¶ˆè²»', note: 'ä¸€èˆ¬1% + ä»»å‹™2.5%', cap: 16000 });
            }

            cards.forEach(c => {
                if (c.cardId === 'unicard' && c.tag === 'list') {
                    if (uniScheme === 'simple') { c.rate = 0.03; c.scheme = 'ç°¡å–®é¸'; c.cap = 500000; }
                    else if (uniScheme === 'up') { c.rate = 0.045; c.scheme = 'UPé¸'; c.cap = 142857; }
                    else { c.rate = 0.035; c.scheme = 'ä»»æ„é¸'; c.cap = 400000; }
                    if (isNew && ['line pay','uber eats','å®¶æ¨‚ç¦','éŸ“åœ‹','å…¨ç›ˆ'].some(k => name.toLowerCase().includes(k))) {
                        c.rate += 0.03; c.scheme += ' + æ–°æˆ¶'; c.effectiveCap = 14667;
                    }
                }
                if (c.cardId === 'ubear' && c.tag === 'net' && isNew) {
                    c.rate = 0.10; c.scheme = 'ç¶²è³¼/Pay + æ–°æˆ¶'; c.effectiveCap = 2142;
                }
            });

            cards.sort((a,b) => b.rate - a.rate);
            const best = cards[0];
            const theme = brandColorMap[best.cardId].class;
            const color = brandColorMap[best.cardId].color;

            return `
                <div class="merchant-list ${theme}" onclick='openRankingModal(${JSON.stringify(cards)}, "${name}")'>
                    <div><div class="merchant-name">${name}</div><span class="merchant-type">${data ? data.category : 'æœå°‹çµæœ'}</span></div>
                    <div class="merchant-best-info">
                        <div class="best-rate">${formatRate(best.rate)}</div>
                        <div class="best-card-name"><span class="card-icon-shape" style="background:${color}"></span>${best.cardName} <span class="scheme-badge list-badge">${best.scheme}</span></div>
                    </div>
                </div>
            `;
        }

        function calculateRewards() {
            const amount = parseFloat(document.getElementById('calcAmount').value);
            const merchant = document.getElementById('calcMerchant').value.trim();
            const isNew = document.getElementById('calcNewUser').checked;
            const uniScheme = document.getElementById('calcUnicardScheme').value;
            if (!amount || !merchant) return;

            // å€Ÿç”¨æœå°‹é‚è¼¯å–å¾—å¡ç‰‡åˆ—è¡¨
            const dummyContainer = document.createElement('div');
            dummyContainer.innerHTML = generateCardHTML(merchant);
            const cards = JSON.parse(dummyContainer.querySelector('.merchant-list').getAttribute('onclick').match(/\[.*\](?=,)/)[0]);

            const results = cards.map(c => {
                let reward = 0, detail = '', cap = c.effectiveCap || c.cap || Infinity;
                if (amount <= cap) { reward = amount * c.rate; detail = `${formatMoney(reward)} (${formatRate(c.rate)})`; }
                else {
                    reward = (cap * c.rate) + ((amount - cap) * 0.01);
                    detail = `${formatMoney(cap * c.rate)} (ä¸Šé™å…§) + ${formatMoney((amount-cap)*0.01)} (1%)`;
                }
                return { ...c, reward, detail, currentCap: cap };
            }).sort((a,b) => b.reward - a.reward);

            const winner = results[0];
            const backup = results.filter(r => r.cardId !== winner.cardId).sort((a,b) => b.rate - a.rate)[0];
            let splitHtml = '';
            if (winner.currentCap < amount && backup && backup.rate > 0.01) {
                const splitTotal = (winner.currentCap * winner.rate) + ((amount - winner.currentCap) * backup.rate);
                if (splitTotal > winner.reward + 5) {
                    splitHtml = `
                        <div class="split-box">
                            <div class="split-title">ğŸ’¡ æœ€ä½³æ‹†å–®ç­–ç•¥ (å¤šè³º ${formatMoney(splitTotal - winner.reward)})</div>
                            <div class="split-step">å…ˆåˆ· <b>${winner.cardName}</b>ï¼š${formatMoney(winner.currentCap)}</div>
                            <div class="split-step">é¤˜é¡ <b>${backup.cardName}</b>ï¼š${formatMoney(amount - winner.currentCap)}</div>
                            <div class="split-total" style="font-weight:700; margin-top:5px; border-top:1px dotted #ccc; padding-top:5px">ç¸½å›é¥‹æå‡è‡³ï¼š${formatMoney(splitTotal)}</div>
                        </div>
                    `;
                }
            }

            document.getElementById('calcResults').innerHTML = results.map((res, idx) => `
                <div class="calc-result-item ${idx===0?'winner ':''}${brandColorMap[res.cardId].class}">
                    <div class="calc-header">
                        <span style="font-weight:700">${idx+1}. ${res.cardName} <span class="scheme-badge">${res.scheme}</span></span>
                        <span class="calc-money">${idx===0?'ğŸ†':''}${formatMoney(res.reward)}</span>
                    </div>
                    <div style="font-size:0.85em; color:#666">${res.detail}</div>
                    ${idx===0 ? splitHtml : ''}
                </div>
            `).join('');
        }

        function openRankingModal(cards, name) {
            document.getElementById('modalTitle').innerText = `${name} æ’åå›é¥‹`;
            document.getElementById('detailBody').innerHTML = cards.map((c, i) => `
                <div class="detail-card-item ${brandColorMap[c.cardId].class}">
                    <div class="detail-card-header"><span>${i===0?'ğŸ† ':''}${c.cardName}</span><span>${formatRate(c.rate)}</span></div>
                    <div class="detail-card-body">
                        <span class="scheme-badge ${c.scheme.includes('æ–°æˆ¶')?'new-user':''}">${c.scheme}</span>
                        <div class="detail-note">${c.note}</div>
                    </div>
                </div>
            `).join('');
            document.getElementById('detailModal').classList.add('show');
        }

        function handleCalcSuggest(e) {
            const val = e.target.value.trim().toLowerCase();
            const drop = document.getElementById('calcSuggestionDropdown');
            if(!val) { drop.style.display='none'; return; }
            const matches = Object.keys(globalMerchantDB).filter(k => k.includes(val)).slice(0, 5);
            drop.innerHTML = matches.map(m => `<div class="suggestion-item" onclick="pickCalc('${globalMerchantDB[m].name}')">${globalMerchantDB[m].name}</div>`).join('');
            drop.style.display = matches.length ? 'block' : 'none';
        }
        function pickCalc(n) { document.getElementById('calcMerchant').value = n; document.getElementById('calcSuggestionDropdown').style.display='none'; calculateRewards(); }

        function renderOverview() {
            document.getElementById('cardOverviewContainer').innerHTML = cardBenefitsData.map(card => `
                <div class="card-accordion-item ${brandColorMap[card.id].class}">
                    <div class="accordion-header" onclick="this.nextElementSibling.classList.toggle('open')">
                        <span class="card-title-text"><span class="card-icon-shape" style="background:${brandColorMap[card.id].color}"></span> ${card.name}</span><span>â–¼</span>
                    </div>
                    <div class="accordion-body">
                        <div class="benefit-row" style="background:#fff8e1; font-size:0.8em">ğŸ’¡ ${card.note}</div>
                        ${card.benefits.map(b => `<div class="benefit-row">
                            <div class="benefit-header"><span class="benefit-name">${b.name}</span><span class="benefit-rate">${b.rate?formatRate(b.rate):''}</span></div>
                            <div class="benefit-desc">${b.desc}</div>
                            ${b.note ? `<div class="benefit-note">ç´°ç¯€ï¼š${b.note}</div>` : ''}
                        </div>`).join('')}
                    </div>
                </div>
            `).join('');
        }

        function switchTab(id) {
            document.querySelectorAll('.nav-item, .tab-content').forEach(el => el.classList.remove('active'));
            document.querySelector(`[onclick*="${id}"]`).classList.add('active');
            document.getElementById(`tab-${id}`).classList.add('active');
        }
        function clearSearch(i, b, s) { document.getElementById(i).value=''; document.getElementById(b).style.display='none'; if(s) document.getElementById('merchantContainer').innerHTML=''; }
        function closeDetailModal() { document.getElementById('detailModal').classList.remove('show'); }
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
