<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¿¡ç”¨å¡å›é¥‹æŸ¥è©¢åŠ©æ‰‹ 2026</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --color-primary: #2180a0;
            --color-primary-hover: #1a6b84;
            --color-bg: #f5f5f5;
            --color-surface: #ffffff;
            --color-text: #333333;
            --color-text-light: #666666;
            --color-border: #e0e0e0;
            --color-success: #32b862;
            --color-danger: #e74c3c;
            --color-warning: #f57c00;
            --color-badge-bg: #e3f2fd;
            --color-badge-text: #1565c0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            padding: 20px;
            line-height: 1.6;
            padding-top: 10px;
        }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 15px; color: var(--color-primary); font-size: 1.6em; }
        
        /* === é ‚éƒ¨å°è¦½åˆ— === */
        .nav-tabs {
            display: flex;
            background: var(--color-surface);
            padding: 5px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            z-index: 900;
        }
        .nav-item {
            flex: 1;
            text-align: center;
            padding: 12px;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 600;
            color: var(--color-text-light);
            transition: all 0.3s;
        }
        .nav-item.active {
            background-color: var(--color-primary);
            color: white;
            box-shadow: 0 2px 4px rgba(33, 128, 160, 0.3);
        }
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* === æœå°‹é æ¨£å¼ === */
        .form-section {
            background: var(--color-surface);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .info-text {
            background: #e3f2fd;
            padding: 12px;
            border-radius: 8px;
            color: #0d47a1;
            margin-bottom: 20px;
            font-size: 0.9em;
            line-height: 1.5;
            border-left: 4px solid #2196f3;
        }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--color-text); }
        .input-wrapper { position: relative; display: flex; align-items: center; }
        input[type="text"] {
            width: 100%;
            padding: 14px 40px 14px 16px;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            font-size: 16px;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(33, 128, 160, 0.1);
        }
        .clear-btn {
            position: absolute; right: 12px;
            background: #eee; border: none; border-radius: 50%;
            width: 24px; height: 24px; cursor: pointer; color: #666;
            display: none; align-items: center; justify-content: center;
        }
        .suggestion-dropdown {
            position: absolute; top: 100%; left: 0; right: 0;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 0 0 8px 8px;
            max-height: 250px; overflow-y: auto; z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            display: none;
        }
        .suggestion-item { padding: 12px 16px; cursor: pointer; border-bottom: 1px solid #f0f0f0; }
        .suggestion-item:hover { background-color: #f5f9ff; }
        .highlight { color: var(--color-primary); font-weight: 700; }
        
        /* æœå°‹çµæœåˆ—è¡¨ */
        .merchant-list {
            background: var(--color-surface); padding: 16px;
            border-radius: 12px; margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: transform 0.2s; cursor: pointer;
            border: 1px solid transparent;
        }
        .merchant-list:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); border-color: var(--color-primary); }
        .merchant-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .merchant-name { font-size: 1.2em; font-weight: 700; color: var(--color-text); }
        .merchant-type { font-size: 0.9em; color: #888; background: #eee; padding: 2px 8px; border-radius: 12px; }
        .merchant-best-card { color: var(--color-success); font-weight: 600; font-size: 0.95em; margin-top: 5px; }

        /* è† å›Šæ¨™ç±¤æ¨£å¼ (Badge) */
        .scheme-badge {
            display: inline-block;
            background-color: var(--color-badge-bg);
            color: var(--color-badge-text);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 700;
            margin: 0 4px;
            border: 1px solid rgba(21, 101, 192, 0.2);
        }
        .scheme-badge.crazy { background-color: #ffebee; color: #c62828; border-color: #ffcdd2; }
        .scheme-badge.new-user { background-color: #fff3e0; color: #e65100; border-color: #ffe0b2; }

        /* === æ¬Šç›Šç¸½è¦½æ¨£å¼ === */
        .card-accordion-item {
            background: var(--color-surface); border-radius: 12px; margin-bottom: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05); overflow: hidden; border: 1px solid var(--color-border);
        }
        .accordion-header {
            padding: 16px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;
            background: white; transition: background 0.2s;
        }
        .accordion-header:hover { background: #f9f9f9; }
        .card-title-row { display: flex; align-items: center; gap: 10px; }
        .card-icon { font-size: 1.2em; }
        .card-title-text { font-weight: 700; font-size: 1.1em; color: var(--color-text); }
        .chevron { transition: transform 0.3s; color: #999; }
        .accordion-header.active .chevron { transform: rotate(180deg); }
        .accordion-body { display: none; padding: 0; background: #fff; border-top: 1px solid #eee; }
        .accordion-body.open { display: block; animation: slideDown 0.3s ease-out; }
        @keyframes slideDown { from { opacity: 0; max-height: 0; } to { opacity: 1; max-height: 3000px; } }
        
        .benefit-row { 
            padding: 14px 20px; border-bottom: 1px solid #f0f0f0; 
            display: flex; flex-direction: column; cursor: pointer; transition: background 0.2s;
            position: relative;
        }
        .benefit-row:hover { background-color: #f8fbff; }
        .benefit-row::after {
            content: 'â€º'; position: absolute; right: 20px; top: 50%; transform: translateY(-50%);
            font-size: 1.5em; color: #ccc; font-weight: 300;
        }
        .benefit-row.no-action::after { content: ''; }
        .benefit-row.no-action { cursor: default; }

        .benefit-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; padding-right: 20px; }
        .benefit-name { font-weight: 600; font-size: 1em; color: #444; display: flex; align-items: center; gap: 6px; }
        .benefit-rate { font-weight: 700; color: var(--color-primary); font-size: 1.1em; }
        .benefit-rate.high { color: var(--color-danger); }
        .benefit-desc { font-size: 0.85em; color: #666; margin-top: 2px; padding-right: 20px; line-height: 1.4; }
        .benefit-note { font-size: 0.8em; color: #999; margin-top: 4px; display: flex; align-items: center; gap: 4px; }
        .urgent-text { color: #c62828; font-weight: 700; background: #ffebee; padding: 1px 4px; border-radius: 4px; }

        /* === è©³æƒ…å½ˆçª— === */
        .detail-modal {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6); z-index: 2000;
            align-items: center; justify-content: center; padding: 20px;
            backdrop-filter: blur(2px);
        }
        .detail-modal.show { display: flex; }
        .detail-content {
            background: var(--color-surface); border-radius: 16px;
            width: 100%; max-width: 500px; max-height: 85vh;
            display: flex; flex-direction: column;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .detail-header { padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: flex-start; }
        .detail-title h2 { font-size: 1.5em; color: var(--color-primary); margin: 0; }
        .detail-close {
            background: #f0f0f0; border: none; width: 32px; height: 32px;
            border-radius: 50%; font-size: 20px; cursor: pointer; color: #666;
        }
        .detail-body { padding: 20px; overflow-y: auto; }
        
        /* å½ˆçª—å…§åˆ†é¡æ¨£å¼ */
        .detail-category-group { margin-bottom: 20px; }
        .detail-category-title { 
            font-size: 0.95em; font-weight: 700; color: var(--color-text); margin-bottom: 8px; 
            background: #f0f4f8; padding: 6px 10px; border-radius: 6px; display: inline-block;
        }
        .scheme-list-container { display: flex; flex-wrap: wrap; gap: 8px; }
        .scheme-list-item { background: #fff; border: 1px solid #eee; padding: 6px 12px; border-radius: 6px; font-size: 0.9em; color: #333; }
        
        /* æ’åå½ˆçª—æ¨£å¼ */
        .ranking-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px dashed #eee; }
        .ranking-row:last-child { border-bottom: none; }
        .ranking-card { font-weight: 700; color: #333; }
        .ranking-rate { font-weight: 700; color: var(--color-primary); }
        .ranking-rate.top { color: var(--color-success); font-size: 1.2em; }
        .ranking-note { font-size: 0.8em; color: #888; display: block; margin-top: 2px; }
        
        /* å¿«é€Ÿç¯„ä¾‹æ¨™ç±¤ */
        .category-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 15px; }
        .category-tag {
            padding: 6px 12px; background: var(--color-surface);
            border: 1px solid var(--color-border); border-radius: 20px;
            cursor: pointer; font-size: 0.85em; color: var(--color-text-light);
            transition: all 0.2s; user-select: none;
        }
        .category-tag:hover { border-color: var(--color-primary); color: var(--color-primary); }

        @media (max-width: 480px) {
            body { padding: 15px; padding-top: 10px; }
            h1 { font-size: 1.5em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ’³ ä¿¡ç”¨å¡å›é¥‹æŸ¥è©¢åŠ©æ‰‹ 2026</h1>

        <div class="nav-tabs">
            <div class="nav-item active" onclick="switchTab('search')">ğŸ” é€šè·¯æœå°‹</div>
            <div class="nav-item" onclick="switchTab('overview')">ğŸ“‹ æ¬Šç›Šç¸½è¦½</div>
        </div>

        <div id="tab-search" class="tab-content active">
            <div class="form-section">
                <div class="info-text">
                    ğŸ” <strong>2026å¹´æœ€æ–°æ¬Šç›Š</strong>ï¼šåœ‹æ³°CUBE(ç˜‹å¤§æ¸¯3.5%è‡³3/23)ã€å°æ–°Richart(ä¸ƒå¤§æ¬Šç›Š)ã€ç‰å±±Unicard(æ–°æˆ¶7.5%)ã€UBear(æ–°æˆ¶10%)ã€æ°¸è±DAWHOã€‚
                </div>
                
                <div class="form-group">
                    <label for="searchMerchant">æœå°‹é€šè·¯åç¨±</label>
                    <div class="input-wrapper">
                        <input type="text" id="searchMerchant" placeholder="ä¾‹å¦‚ï¼šLINE Payã€é«˜éµã€éº¥ç•¶å‹..." autocomplete="off">
                        <button id="clearSearch" class="clear-btn" onclick="clearSearch()">âœ•</button>
                        <div id="suggestionDropdown" class="suggestion-dropdown"></div>
                    </div>
                </div>
                
                <div style="margin-top: 10px;">
                    <label>å¿«é€Ÿç¯„ä¾‹</label>
                    <div class="category-tags">
                        <div class="category-tag" onclick="quickSearch('é«˜éµ')">ğŸš… é«˜éµ</div>
                        <div class="category-tag" onclick="quickSearch('è¦çš®')">ğŸ›ï¸ è¦çš®</div>
                        <div class="category-tag" onclick="quickSearch('éº¥ç•¶å‹')">ğŸ” éº¥ç•¶å‹</div>
                        <div class="category-tag" onclick="quickSearch('æ—¥æœ¬')">ğŸ‡¯ğŸ‡µ æ—¥æœ¬</div>
                        <div class="category-tag" onclick="quickSearch('Uber')">ğŸš— Uber</div>
                        <div class="category-tag" onclick="quickSearch('LINE Pay')">ğŸ’³ LINE Pay</div>
                    </div>
                </div>
            </div>

            <div id="merchantResults" class="results-section">
                <div id="merchantContainer"></div>
            </div>
        </div>

        <div id="tab-overview" class="tab-content">
            <div id="cardOverviewContainer"></div>
        </div>

    </div>

    <div id="detailModal" class="detail-modal" onclick="if(event.target === this) closeDetailModal()">
        <div class="detail-content">
            <div class="detail-header">
                <div class="detail-title">
                    <h2 id="modalTitle">æ–¹æ¡ˆè©³æƒ…</h2>
                </div>
                <button class="detail-close" onclick="closeDetailModal()">âœ•</button>
            </div>
            <div id="detailBody" class="detail-body"></div>
        </div>
    </div>

    <script>
        // === æ ¸å¿ƒè³‡æ–™ï¼šæ¬Šç›Šç¸½è¦½ (Single Source of Truth) ===
        // ä¿®æ­£é‡é»ï¼šcategories å–ä»£ listï¼Œæ”¯æ´åˆ†é¡é¡¯ç¤º
        const cardBenefitsData = [
            {
                id: 'richart',
                name: 'å°æ–° Richart',
                icon: 'ğŸ¶',
                note: 'éœ€æ¯æ—¥é€é Richart App åˆ‡æ›è‡³å°æ‡‰æ¬Šç›Šæ–¹æ¡ˆ',
                benefits: [
                    { name: 'Payè‘—åˆ·', rate: 0.038, desc: 'å››å¤§è¶…å•† | æ–°å…‰ä¸‰è¶Š | IKEA | å°ç£å¤§è»ŠéšŠ', note: 'éœ€ç¶å®šå°æ–°Payæ”¯ä»˜', tag: 'pay', categories: { 'è¶…å•†':['7-11', 'å…¨å®¶ä¾¿åˆ©å•†åº—'], 'ç™¾è²¨':['æ–°å…‰ä¸‰è¶Š'], 'å±…å®¶':['IKEA'], 'äº¤é€š':['å°ç£å¤§è»ŠéšŠ'], 'é‡è²©':['å¤§æ½¤ç™¼'] } },
                    { name: 'æ•¸è¶£åˆ·', rate: 0.033, desc: 'ç¶²è³¼ | éŠæˆ²å½±éŸ³ | ç·šä¸Šèª²ç¨‹ | AIæœå‹™', note: 'ä¸Šé™ 1000 å…ƒ', tag: 'digital', categories: { 'ç¶²è³¼å¹³å°':['è¦çš®è³¼ç‰©', 'momoè³¼ç‰©ç¶²', 'é…·æ¾(Coupang)', 'PChome', 'æ·˜å¯¶', 'Amazon', 'æ±æ£®', 'åšå®¢ä¾†', 'Richart Mart', 'PayEasy', 'iHerb', 'SHEIN', 'Farfetch', 'Olive Young'], 'ç·šä¸Šèª²ç¨‹':['çŸ¥è­˜è¡›æ˜Ÿ', 'Amazing Talker', 'Tutor ABC', 'Hahow', 'PressPlay'], 'éŠæˆ²å½±éŸ³':['MyCard', 'éŠæˆ²æ©˜å­', 'Steam', 'PlayStation', 'Nintendo', 'Netfilx', 'Disney+'], 'AIæœå‹™':['ChatGPT', 'Notion', 'Canva', 'Perplexity', 'Claude'] } },
                    { name: 'ç©æ—…åˆ·', rate: 0.033, desc: 'æµ·å¤– | èˆªç©º | è¨‚æˆ¿ | æ—…è¡Œç¤¾', note: 'ä¸Šé™ 1000 å…ƒ', tag: 'travel', categories: { 'æµ·å¤–æ¶ˆè²»':['æµ·å¤–æ¶ˆè²»(å«å¯¦é«”)'], 'è¨‚æˆ¿å¹³å°':['Klook', 'KKday', 'Agoda', 'Booking.com', 'Trip.com', 'Airbnb', 'Hotels.com', 'Expedia'], 'æµ·å¤–äº¤é€š':['Uber', 'Grab', 'SUICA', 'ICOCA', 'PASMO', 'WOWPASS', 'AIRSIM'], 'æ—…è¡Œç¤¾':['é›„ç…æ—…éŠ', 'æ˜“éŠç¶²', 'æ±å—æ—…éŠ', 'å¯æ¨‚æ—…éŠ', 'é•·æ±å‡æœŸ', 'äº”ç¦æ—…éŠ', 'å–œé´»å‡æœŸ', 'æ˜“é£›æ—…éŠ', 'ç‡¦æ˜Ÿæ—…éŠ', 'åŠ åˆ©åˆ©æ—…è¡Œç¤¾', 'é³³å‡°åœ‹éš›æ—…è¡Œç¤¾', 'å±±å¯Œæ—…éŠ', 'è¡Œå¥æ—…éŠ'], 'èˆªç©ºå…¬å¸':['ä¸­è¯èˆªç©º', 'é•·æ¦®èˆªç©º', 'æ˜Ÿå®‡èˆªç©º', 'å°ç£è™èˆª', 'åœ‹æ³°èˆªç©º', 'è¯ä¿¡èˆªç©º', 'ç«‹æ¦®èˆªç©º', 'æ¨‚æ¡ƒèˆªç©º', 'é˜¿è¯é…‹èˆªç©º', 'äºæ´²èˆªç©º', 'é…·èˆª', 'æ·æ˜Ÿèˆªç©º', 'æ–°åŠ å¡èˆªç©º', 'æ—¥æœ¬èˆªç©º', 'è¶Šæ·èˆªç©º'] } },
                    { name: 'å¤©å¤©åˆ·', rate: 0.033, desc: 'è¶…å•†é‡è²© | äº¤é€š | åœè»Š | è—¥å±€', note: 'ä¸Šé™ 1000 å…ƒ', tag: 'daily', categories: { 'è¶…å•†é‡è²©(å°æ–°Pay)':['7-11', 'å…¨å®¶', 'å®¶æ¨‚ç¦', 'å¤§è²·å®¶', 'å”å‰è»»å¾·', 'LOPIA'], 'é€šå‹¤äº¤é€š':['å°ç£éµè·¯', 'å°ç£é«˜éµ', 'å°ç£å¤§è»ŠéšŠ', 'Yoxi', 'Uber'], 'åœè»Šç§Ÿè»Š':['å˜Ÿå˜Ÿæˆ¿', 'è»Šéº»å‰', 'åŸå¸‚è»Šæ—…', 'ViViPark', 'USPACE', 'UDRIVE', 'iRent', 'å’Œé‹ç§Ÿè»Š', 'æ ¼ä¸Šç§Ÿè»Š'], 'è—¥å¦è—¥å±€':['å¯¶é›…', 'åº·æ˜¯ç¾', 'å±ˆè‡£æ°', 'æä¸€é†«ç™‚', 'å¤§æ¨¹è—¥å±€', 'ä¸ä¸è—¥å±€', 'ä½‘å…¨ä¿å¥', 'å¥åº·äººç”Ÿ'] } },
                    { name: 'å¤§ç­†åˆ·', rate: 0.033, desc: 'ç™¾è²¨ | Outlet | å±…å®¶ | æ™‚å°š', note: 'ä¸Šé™ 1000 å…ƒ', tag: 'big', categories: { 'æŒ‡å®šç™¾è²¨':['æ–°å…‰ä¸‰è¶Š', 'é æ±ç™¾è²¨', 'é æ±SOGO', 'æ¼¢ç¥å·¨è›‹', 'æ¼¢ç¥ç™¾è²¨', 'å¾®é¢¨', 'å°åŒ—101', 'é æ±å·¨åŸ', 'å»£ä¸‰SOGO', 'å—ç´¡è³¼ç‰©ä¸­å¿ƒ', 'èª å“ç”Ÿæ´»', 'äº¬ç«™', 'ä¸‰å‰µç”Ÿæ´»', 'å¤¢æ™‚ä»£', 'çµ±ä¸€æ™‚ä»£', 'ä¸­å‹ç™¾è²¨', 'LaLaport'], 'æŒ‡å®šOutlet':['MITSUI OUTLET PARK', 'è¯æ³°åå“åŸ', 'SKM Park Outlets'], 'å±…å®¶è£ä¿®':['IKEA', 'ç‰¹åŠ›å±‹', 'HOLA', 'å®œå¾—åˆ©', 'ç‘ªé»‘å®¶å±…'], 'æ™‚å°šå“å‘³':['UNIQLO', 'GU', 'ZARA', 'NET', 'lululemon'] } },
                    { name: 'å¥½é¥—åˆ·', rate: 0.033, desc: 'é¤é£² | å¤–é€ | åŠ æ²¹ | å¨›æ¨‚', note: 'ä¸Šé™ 1000 å…ƒ', tag: 'fun', categories: { 'é¤é£²å¤–é€':['åœ‹å…§é¤é£²', 'ç‹å“ç˜‹Pay', 'Uber Eats', 'Foodpanda'], 'åŠ æ²¹å……é›»':['ä¸­æ²¹ç›´ç‡Ÿ', 'å°äºç›´ç‡Ÿ', 'å…¨åœ‹åŠ æ²¹', 'EVOASIS', 'EVALUE'], 'å±•æ¼”è³¼ç¥¨':['æ‹“å…ƒå”®ç¥¨', 'KKTIX', 'å¹´ä»£å”®ç¥¨', 'å¯¬å®å”®ç¥¨', 'OPENTIX', 'FunNow'], 'æŒ‡å®šKTV':['éŒ¢æ«ƒ', 'å¥½æ¨‚è¿ª', 'ONCOR', 'sing!go', 'äº«æº«é¦¨'], 'æŒ‡å®šæ¨‚åœ’':['ç¾©å¤§éŠæ¨‚ä¸–ç•Œ', 'éº—å¯¶æ¨‚åœ’', 'å…­ç¦æ‘', 'ä¹æ—æ–‡åŒ–æ‘', 'åŠæ¹–å±±', 'X-Park', 'åœ‹ç«‹æµ·æ´‹ç”Ÿç‰©åšç‰©é¤¨', 'é é›„æµ·æ´‹å…¬åœ’', 'å°äººåœ‹'], 'æŒ‡å®šé£¯åº—':['æ™¶è¯', 'é›²æœ—', 'è¬è±ª', 'ç…™æ³¢', 'è€çˆº', 'ç¦è¯', 'æ¼¢ä¾†', 'å›æ‚…', 'æ´²éš›', 'å¯’æ²'] } },
                    { name: 'LINE Pay', rate: 0.023, desc: 'ä¸€èˆ¬ LINE Pay ç¶å®šæ”¯ä»˜', note: 'ç„¡é–€æª»', tag: 'line', categories: { 'è¡Œå‹•æ”¯ä»˜':['LINE Pay'] } },
                    { name: 'å‡æ—¥åˆ·', rate: 0.02, desc: 'åœ‹å…§ç¯€å‡æ—¥ä¸é™é€šè·¯', note: 'åŸºæœ¬å›é¥‹', categories: {} }
                ]
            },
            {
                id: 'cube',
                name: 'åœ‹æ³° CUBE',
                icon: 'âšªï¸',
                note: 'éœ€æ¯æ—¥é€é CUBE App åˆ‡æ›è‡³å°æ‡‰æ¬Šç›Šæ–¹æ¡ˆ',
                benefits: [
                    { name: 'ç˜‹å¤§æ¸¯', rate: 0.035, desc: 'æŒ‡å®šé«˜é›„ä½å®¿ | Klook | é«˜éµ | å°éµ', note: '<span class="urgent-text">2026/3/23 æˆªæ­¢</span>', tag: 'crazy', categories: { 'æŒ‡å®šé«˜é›„ä½å®¿':['åŸå¸‚å•†æ—…', 'å’Œé€¸é£¯åº—', 'æ—…å±…æ–‡æ—…', 'ç§èŠ¯æ—…åº—', 'å¤å„ªæ—…å±…', 'è¯åœ’å¤§é£¯åº—', 'æ·çµ²æ—…', 'éº—å°Šé…’åº—', 'å¸•å¯éº—é…’åº—', 'éˆæ€¡å¤§é£¯åº—'], 'æ—…éŠå¹³å°':['Klook'], 'æŒ‡å®šäº¤é€š':['å°ç£é«˜éµ', 'å°ç£éµè·¯å±€'] } },
                    { name: 'ç©æ•¸ä½', rate: 0.03, desc: 'ç¶²è³¼ | å½±éŸ³ | AI | åœ‹éš›é›»å•†', note: 'ç„¡ä¸Šé™', tag: 'digital', categories: { 'AIå·¥å…·':['ChatGPT', 'Canva', 'Claude', 'Cursor', 'Duolingo', 'Gamma', 'Gemini', 'Notion', 'Perplexity', 'Speak'], 'åœ‹éš›é›»å•†':['æ·˜å¯¶', 'å¤©è²“', 'Coupang é…·æ¾'], 'ç¶²è³¼å¹³å°':['è¦çš®è³¼ç‰©', 'momoè³¼ç‰©ç¶²', 'PChome 24hè³¼ç‰©', 'å°æ¨¹è³¼'], 'æ•¸ä½ä¸²æµ':['Apple åª’é«”æœå‹™', 'Google Play', 'Disney+', 'Netflix', 'Spotify', 'YouTube Premium', 'Max'] } },
                    { name: 'æ¨‚éŸ¿è³¼', rate: 0.03, desc: 'ç™¾è²¨å…¬å¸ | å…¨çƒé¤é£² | å¤–é€ | è—¥å¦', note: 'ç„¡ä¸Šé™', tag: 'fun', categories: { 'åœ‹å…§ç™¾è²¨':['é æ±SOGO', 'é æ±Garden City', 'æ–°å…‰ä¸‰è¶Š', 'é æ±ç™¾è²¨', 'å°åŒ—101', 'BELLAVITA', 'å¾®é¢¨å»£å ´', 'çµ±ä¸€æ™‚ä»£', 'èª å“ç”Ÿæ´»', 'ATT 4 FUN', 'äº¬ç«™', 'ç¾éº—è¯', 'NOKEå¿ æ³°æ¨‚ç”Ÿæ´»', 'å¤§è‘‰é«˜å³¶å±‹', 'Mitsui Shopping Park LaLaport', 'å®åŒ¯å»£å ´', 'å°èŒ‚', 'å¤§æ±Ÿ', 'Big City', 'ä¸­å‹', 'å»£ä¸‰SOGO', 'å—ç´¡', 'è€æ–¯å»£å ´', 'å¤¢æ™‚ä»£', 'æ¼¢ç¥ç™¾è²¨', 'æ¼¢ç¥å·¨è›‹', 'æ–°æœˆå»£å ´', 'CITYLINK', 'ç§€æ³°ç”Ÿæ´»', 'ç’°çƒè³¼ç‰©ä¸­å¿ƒ', 'å¤ªå¹³æ´‹ç™¾è²¨', 'è¯æ³°åå“åŸ', 'SKM Park', 'MITSUI OUTLET PARK'], 'åœ‹å…§é¤é£²':['åœ‹å…§é¤é£²', 'éº¥ç•¶å‹'], 'å¤–é€å¹³å°':['Uber Eats', 'foodpanda'], 'åœ‹å…§è—¥å¦':['å±ˆè‡£æ°', 'åº·æ˜¯ç¾'] } },
                    { name: 'è¶£æ—…è¡Œ', rate: 0.03, desc: 'æµ·å¤–å¯¦é«” | è¨‚æˆ¿ | èˆªç©º | æ—…è¡Œç¤¾ | åœ‹å…§äº¤é€š', note: 'ç„¡ä¸Šé™', tag: 'travel', categories: { 'æµ·å¤–æ¶ˆè²»':['æµ·å¤–å¯¦é«”æ¶ˆè²»'], 'æµ·å¤–äº¤é€š':['SUICA', 'PASMO', 'ICOCA', 'Uber', 'Grab'], 'æŒ‡å®šæ¨‚åœ’':['æ±äº¬è¿ªå£«å°¼', 'å“ˆåˆ©æ³¢ç‰¹å½±åŸ', 'å¤§é˜ªç’°çƒå½±åŸ'], 'æ—…éŠè¨‚æˆ¿':['Klook', 'KKday', 'Agoda', 'Airbnb', 'Booking.com', 'Trip.com'], 'åœ‹å…§æ—…è¡Œç¤¾':['é›„ç…', 'æ˜“éŠç¶²', 'å¯æ¨‚', 'æ±å—', 'äº”ç¦', 'ç‡¦æ˜Ÿ', 'å±±å¯Œ', 'é•·æ±å‡æœŸ', 'é³³å‡°', 'æ˜“é£›ç¶²', 'ç†æƒ³æ—…éŠ', 'æ°¸åˆ©', 'ä¸‰è³€'], 'åœ‹å…§äº¤é€š':['å°ç£é«˜éµ', 'å°ç£å¤§è»ŠéšŠ', 'yoxi', 'iRent', 'å’Œé‹ç§Ÿè»Š', 'æ ¼ä¸Šç§Ÿè»Š', 'Uber'], 'æŒ‡å®šèˆªç©º':['ä¸­è¯èˆªç©º', 'é•·æ¦®èˆªç©º', 'æ˜Ÿå®‡èˆªç©º', 'å°ç£è™èˆª', 'åœ‹æ³°èˆªç©º', 'æ¨‚æ¡ƒèˆªç©º', 'é˜¿è¯é…‹èˆªç©º', 'é…·èˆª', 'æ·æ˜Ÿèˆªç©º', 'æ—¥æœ¬èˆªç©º', 'äºæ´²èˆªç©º', 'è¯åˆèˆªç©º', 'æ–°åŠ å¡èˆªç©º', 'ANAå…¨æ—¥ç©º', 'è¶Šæ·èˆªç©º', 'å¤§éŸ“èˆªç©º', 'é”ç¾èˆªç©º', 'åœŸè€³å…¶èˆªç©º', 'æ³•åœ‹èˆªç©º', 'å¡é”èˆªç©º'], 'æŒ‡å®šä½å®¿':['åœ‹å…§é£¯åº—', 'æ˜Ÿé‡é›†åœ˜', 'å…¨çƒè¿ªå£«å°¼é£¯åº—', 'æ±æ©«INN'] } },
                    { name: 'é›†ç²¾é¸', rate: 0.02, desc: 'è¶…å•† | é‡è²© | åŠ æ²¹ | IKEA', note: 'ç„¡ä¸Šé™', tag: 'base', categories: { 'å……é›»åœè»Š':['U-POWER', 'EVOASIS', 'EVALUE', 'TAIL', 'iCharging', 'è»Šéº»å‰', 'uTagGo'], 'ç”Ÿæ´»å±…å®¶':['IKEA'], 'é‡è²©è¶…å¸‚':['å®¶æ¨‚ç¦', 'å…¨è¯ç¦åˆ©ä¸­å¿ƒ', 'LOPIAå°ç£'], 'æŒ‡å®šåŠ æ²¹':['å°ç£ä¸­æ²¹-ç›´ç‡Ÿç«™'], 'æŒ‡å®šè¶…å•†':['7-ELEVEN', 'å…¨å®¶ä¾¿åˆ©å•†åº—'] } }
                ]
            },
            {
                id: 'unicard',
                name: 'ç‰å±± Unicard',
                icon: 'â›°ï¸',
                note: 'ç°¡å–®é¸ 3% / ä»»æ„é¸ 3.5% / UPé¸ 4.5% (éœ€149é»è¨‚é–±)',
                benefits: [
                    { 
                        name: 'ç™¾å¤§ç‰¹åº—åå–®', rate: 0, tag: 'list', type: 'modal',
                        desc: 'é»æ“ŠæŸ¥çœ‹å®Œæ•´ç™¾å¤§ç‰¹åº— (UPé¸4.5%)', 
                        categories: {
                            'è¡Œå‹•æ”¯ä»˜': ['ç‰å±±Wallet', 'LINE Pay', 'å…¨æ”¯ä»˜', 'è¡—å£æ”¯ä»˜', 'æ‚ éŠä»˜', 'å…¨ç›ˆ+PAY', 'iPASS MONEY', 'icash Pay'],
                            'åŠ æ²¹äº¤é€š': ['å°ç£ä¸­æ²¹(ç›´ç‡Ÿ)', '55688', 'å°éµ', 'é«˜éµ', 'Uber', 'Yoxi'],
                            'åœ‹å…§ç™¾è²¨': ['æ–°å…‰ä¸‰è¶Š', 'é æ±ç™¾è²¨', 'æ¼¢ç¥ç™¾è²¨', 'å¾®é¢¨', 'å°åŒ—101', 'è¯æ³°åå“åŸ', 'ä¸‰äº•OUTLET', 'äº¬ç«™', 'ç¾éº—è¯', 'èª å“', 'ç§€æ³°', 'LaLaport', 'çµ±é ˜', 'çµ±ä¸€æ™‚ä»£', 'æ˜‡æ†æ˜Œ', 'é‡‡ç›Ÿ'],
                            'é¤é£²ç¾é£Ÿ': ['Uber Eats', 'foodpanda', 'EZTABLE', 'ç‹å“ç˜‹Pay', 'é¥—è³“', 'ç“¦åŸ', 'ä¹¾æ¯', 'æ¼¢ä¾†ç¾é£Ÿ', 'é¼ç‹', 'çˆ­é®®'],
                            'èˆªç©ºæ—…éŠ': ['ä¸­è¯èˆªç©º', 'é•·æ¦®èˆªç©º', 'æ—¥æœ¬èˆªç©º', 'å°ç£è™èˆª', 'æ¨‚æ¡ƒèˆªç©º', 'é…·èˆª', 'Trip.com', 'Booking.com', 'Hotels.com', 'AsiaYo', 'Expedia', 'KKday', 'Klook', 'é›„ç…', 'å¯æ¨‚', 'æ±å—', 'Agoda'],
                            'ç²¾é¸å•†å®¶': ['Appleç›´ç‡Ÿåº—', 'å°ç±³å°ç£', 'å…¨åœ‹é›»å­', 'ç‡¦å¤', 'è¿ªå¡å„‚'],
                            'ç”Ÿæ´»æ¡è²·': ['å®¶æ¨‚ç¦', 'å±ˆè‡£æ°', 'åº·æ˜¯ç¾', 'ç‰¹åŠ›å±‹', 'HOLA', 'hoi', 'UNIQLO', 'NET', 'å¤§æ¨¹è—¥å±€', 'ä¸ä¸è—¥å¦'],
                            'é›»å•†å¹³å°': ['momoè³¼ç‰©ç¶²', 'è¦çš®è³¼ç‰©', 'æ·˜å¯¶', 'Coupangé…·æ¾'],
                            'åœ‹å¤–å¯¦é«”': ['æ—¥æœ¬', 'éŸ“åœ‹', 'æ³°åœ‹', 'è¶Šå—', 'æ–°åŠ å¡', 'é¦¬ä¾†è¥¿äº', 'è²å¾‹è³“', 'ä¸­åœ‹', 'é¦™æ¸¯', 'æ¾³é–€', 'ç¾åœ‹', 'åŠ æ‹¿å¤§', 'è‹±åœ‹', 'æ³•åœ‹', 'å¾·åœ‹', 'ç¾©å¤§åˆ©', 'æ¾³æ´²'],
                            'ESGæ¶ˆè²»': ['ç‰¹æ–¯æ‹‰', 'Gogoro', 'YouBike']
                        },
                        note: 'é»æ“ŠæŸ¥çœ‹è©³æƒ…'
                    },
                    { name: 'UPé¸', rate: 0.045, desc: 'ç™¾å¤§ç‰¹åº— (éœ€149é»è¨‚é–±)', type: 'text', note: 'éœ€å®ŒæˆUPä»»å‹™' },
                    { name: 'ä»»æ„é¸', rate: 0.035, desc: 'ç™¾å¤§ç‰¹åº— (éœ€è¨­å®š8å®¶)', type: 'text', note: 'éœ€é€é App è¨­å®š' },
                    { name: 'ç°¡å–®é¸', rate: 0.03, desc: 'ç™¾å¤§ç‰¹åº— (é è¨­æ–¹æ¡ˆ)', type: 'text', note: 'æ ¸å¡å³äº«' },
                    { 
                        name: 'æ–°æˆ¶å›é¥‹', rate: 0.03, tag: 'new', type: 'modal',
                        desc: 'äº”å¤§æŒ‡å®šé€šè·¯ +3%', 
                        categories: { 'æŒ‡å®šé€šè·¯': ['LINE Pay', 'Uber Eats', 'å®¶æ¨‚ç¦', 'éŸ“åœ‹', 'å…¨ç›ˆ+PAY'] },
                        note: '<span class="urgent-text">æ–°æˆ¶+3% (æœ€é«˜7.5%)</span>' 
                    }
                ]
            },
            {
                id: 'ubear',
                name: 'ç‰å±± UBear',
                icon: 'ğŸ»',
                note: 'æŒ‡å®šå¨›æ¨‚ 10% / ç¶²è³¼ 3% (æ–°æˆ¶ç¶²è³¼ +7% = 10%)',
                benefits: [
                    { 
                        name: 'å½±éŸ³å¨›æ¨‚', rate: 0.10, tag: 'ent',
                        desc: 'Netflix | Disney+ | Nintendo | PlayStation', 
                        categories: { 'å½±éŸ³å¨›æ¨‚': ['Netflix', 'Disney+', 'Nintendo', 'PlayStation', 'KKBOX', 'iTunes', 'Google Play', 'Funnow'] },
                        note: 'æ¯æœŸä¸Šé™ 100 å…ƒ' 
                    },
                    { 
                        name: 'ç¶²è³¼/Pay', rate: 0.03, tag: 'net',
                        desc: 'ç¶²è³¼ | è¡Œå‹•æ”¯ä»˜ | äº¤é€šè¨‚æˆ¿ | å¤–é€', 
                        categories: { 
                            'è¡Œå‹•æ”¯ä»˜': ['LINE Pay', 'è¡—å£æ”¯ä»˜', 'æ‚ éŠä»˜', 'OPENéŒ¢åŒ…', 'icash Pay', 'å…¨ç›ˆ+PAY', 'å…¨æ”¯ä»˜', 'æ©˜å­æ”¯ä»˜', 'skm pay', 'ä¸­æ²¹Pay', 'ç‰å±±Wallet', 'Pi æ‹éŒ¢åŒ…', 'æ­ä»˜å¯¶', 'PayPal', 'Hami Pay'],
                            'ç·šä¸Šè³¼ç‰©': ['PChome', 'momoè³¼ç‰©ç¶²', 'è¦çš®', 'Coupangé…·æ¾', 'Yahoo', 'æ·˜å¯¶', 'éœ²å¤©', 'åšå®¢ä¾†', 'ç”Ÿæ´»å¸‚é›†', 'æ¾æœè³¼ç‰©', 'èª å“ç¶²è·¯', 'friDayè³¼ç‰©', 'udnå”®ç¥¨ç¶²', 'GOMAJI', 'æ¨‚å¤©å¸‚å ´', 'å±ˆè‡£æ°ç·šä¸Š', 'åº·æ˜¯ç¾ç·šä¸Š', 'å®¶æ¨‚ç¦ç·šä¸Š', 'ç¥è…¦', 'ç‡¦å¤ç·šä¸Š', 'Appleå®˜ç¶²', 'å°ç±³å°ç£', 'è¿ªå¡å„‚ç·šä¸Š', 'æ‹“å…ƒ', 'ZARA', 'H&M', 'GU', 'UNIQLO', 'Lativ', 'ZALORA', 'Pinkoi'],
                            'äº¤é€šè¨‚æˆ¿': ['55688', 'Uber', 'é«˜éµT-EX', 'å°éµç·šä¸Š', 'æ˜“éŠç¶²', 'Agoda', 'Hotels.com', 'Expedia', 'Klook', 'KKday', 'Booking.com', 'Airbnb', 'ä¸­è¯èˆªç©º', 'é•·æ¦®èˆªç©º', 'å°ç£è™èˆª'],
                            'å¤–é€å¹³å°': ['Uber Eats', 'foodpanda', 'foodomo', 'lalamove', 'ä½ è¨‚']
                        },
                        note: '<span class="urgent-text">æ–°æˆ¶+7% (æœ€é«˜10%)</span>' 
                    }
                ]
            },
            {
                id: 'dawho',
                name: 'æ°¸è± DAWHO',
                icon: 'âš«ï¸',
                note: 'åœ‹å…§ 3.5% / åœ‹å¤– 4.5% (éœ€å¤§æˆ¶ç­‰ç´š)',
                benefits: [
                    { name: 'åœ‹å…§å…¨é€šè·¯', rate: 0.035, desc: 'å…¨é€šè·¯ç„¡è…¦åˆ· (å«ä»»å‹™)', tag: 'all', categories: {}, note: 'ä¸Šé™é¡¯ç¤º 3.5%' },
                    { name: 'æ‚ éŠå¡', rate: 0.03, desc: 'æ‚ éŠå¡è‡ªå‹•åŠ å€¼', tag: 'easy', categories: { 'é›»å­ç¥¨è­‰':['æ‚ éŠå¡è‡ªå‹•åŠ å€¼'] }, note: 'ä¸Šé™100å…ƒ' }
                ]
            }
        ];

        // === åˆ¥åè¾­å…¸ (Alias Map) ===
        const aliasMap = {
            'é«˜éµ': 'å°ç£é«˜éµ', 'å°éµ': 'å°ç£éµè·¯', '711': '7-ELEVEN', 'å°ä¸ƒ': '7-ELEVEN',
            'éº¥ç•¶å‹': 'éº¥ç•¶å‹', 'æ˜Ÿå·´å…‹': 'åœ‹å…§é¤é£²', 'è‚¯å¾·åŸº': 'åœ‹å…§é¤é£²',
            'ä¸­æ²¹': 'å°ç£ä¸­æ²¹-ç›´ç‡Ÿç«™', 'line': 'LINE Pay', 'uber': 'Uber', 'ubereats': 'Uber Eats',
            'foodpanda': 'foodpanda', 'ç†Šè²“': 'foodpanda', 'å…¨è¯': 'å…¨è¯ç¦åˆ©ä¸­å¿ƒ', 'å®¶æ¨‚ç¦': 'å®¶æ¨‚ç¦',
            'momo': 'momoè³¼ç‰©ç¶²', 'è¦çš®': 'è¦çš®è³¼ç‰©', 'pchome': 'PChome 24hè³¼ç‰©', 'æ—¥æœ¬': 'æ—¥æœ¬', 'éŸ“åœ‹': 'éŸ“åœ‹',
            'klook': 'Klook', 'kkday': 'KKday', 'agoda': 'Agoda', 'booking': 'Booking.com',
            'uniqlo': 'UNIQLO', 'ikea': 'IKEA'
        };

        // === è®Šæ•¸ ===
        let globalMerchantDB = {}; // è‡ªå‹•ç”Ÿæˆçš„å•†å®¶è³‡æ–™åº«

        // === åˆå§‹åŒ– ===
        function init() {
            generateMerchantDB();
            renderCardOverview();
            
            const input = document.getElementById('searchMerchant');
            input.addEventListener('input', handleSearchInput); 
            input.addEventListener('focus', handleSearchInput); 
            
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.input-wrapper')) {
                    document.getElementById('suggestionDropdown').style.display = 'none';
                }
            });
        }

        // === 1. è‡ªå‹•ç”Ÿæˆå•†å®¶è³‡æ–™åº« (Reverse Indexing from Categories) ===
        function generateMerchantDB() {
            globalMerchantDB = {};
            
            cardBenefitsData.forEach(card => {
                card.benefits.forEach(benefit => {
                    if (benefit.categories) {
                        Object.values(benefit.categories).forEach(list => {
                            list.forEach(merchant => {
                                const key = merchant.toLowerCase();
                                if (!globalMerchantDB[key]) {
                                    globalMerchantDB[key] = {
                                        name: merchant,
                                        cards: []
                                    };
                                }
                                
                                let rate = benefit.rate;
                                let note = benefit.note;
                                let scheme = benefit.name;

                                // ç‰å±± Unicard æ–°æˆ¶åŠ ç¢¼é‚è¼¯
                                if (card.id === 'unicard') {
                                    if (benefit.name === 'ç™¾å¤§ç‰¹åº—åå–®') {
                                        rate = 0.045; // é è¨­ UPé¸
                                        scheme = 'UPé¸';
                                        // æª¢æŸ¥æ˜¯å¦åœ¨æ–°æˆ¶åå–®å…§
                                        const newBonusBenefit = card.benefits.find(b => b.tag === 'new');
                                        if (newBonusBenefit) {
                                            const newBonusList = Object.values(newBonusBenefit.categories).flat();
                                            if (newBonusList.some(nm => merchant.includes(nm))) {
                                                rate = 0.075;
                                                note = 'å«æ–°æˆ¶åŠ ç¢¼';
                                                scheme = 'UPé¸+æ–°æˆ¶';
                                            }
                                        }
                                    }
                                }
                                // ç‰å±± UBear æ–°æˆ¶é‚è¼¯
                                if (card.id === 'ubear' && benefit.tag === 'net') {
                                    rate = 0.10; 
                                    note = 'å«æ–°æˆ¶åŠ ç¢¼';
                                }

                                globalMerchantDB[key].cards.push({
                                    cardName: card.name,
                                    rate: rate,
                                    scheme: scheme,
                                    note: note,
                                    tag: benefit.tag
                                });
                            });
                        });
                    }
                });
            });
        }

        // === 2. æœå°‹é‚è¼¯ ===
        function handleSearchInput(e) {
            const val = e.target.value.trim().toLowerCase();
            const dropdown = document.getElementById('suggestionDropdown');
            const clearBtn = document.getElementById('clearSearch');
            
            clearBtn.style.display = val ? 'flex' : 'none';

            if (!val) {
                dropdown.style.display = 'none';
                return;
            }

            let matches = new Set();
            for (const [alias, realName] of Object.entries(aliasMap)) {
                if (alias.includes(val)) {
                    matches.add(realName);
                }
            }
            Object.keys(globalMerchantDB).forEach(key => {
                if (key.includes(val)) {
                    matches.add(globalMerchantDB[key].name);
                }
            });

            const results = Array.from(matches).slice(0, 10);
            if (results.length > 0) {
                dropdown.innerHTML = results.map(name => 
                    `<div class="suggestion-item" onclick="selectMerchant('${name}')">${name}</div>`
                ).join('');
                dropdown.style.display = 'block';
            } else {
                dropdown.innerHTML = '<div class="suggestion-item" style="cursor:default; color:#999;">ç„¡ç›¸é—œé€šè·¯ï¼Œè©¦è©¦çœ‹ DAWHO (3.5%)</div>';
                dropdown.style.display = 'block';
            }
        }

        function clearSearch() {
            document.getElementById('searchMerchant').value = '';
            document.getElementById('merchantContainer').innerHTML = '';
            document.getElementById('clearSearch').style.display = 'none';
            document.getElementById('suggestionDropdown').style.display = 'none';
        }

        function selectMerchant(name) {
            document.getElementById('searchMerchant').value = name;
            document.getElementById('suggestionDropdown').style.display = 'none';
            renderMerchantResult(name);
        }

        function quickSearch(name) {
            selectMerchant(name);
        }

        // === 3. é¡¯ç¤ºæœå°‹çµæœ (å–®ä¸€å¡ç‰‡) ===
        function renderMerchantResult(name) {
            const container = document.getElementById('merchantContainer');
            const key = name.toLowerCase();
            let data = globalMerchantDB[key];

            if (!data) {
                const fuzzyKey = Object.keys(globalMerchantDB).find(k => k.includes(key) || key.includes(k));
                if (fuzzyKey) data = globalMerchantDB[fuzzyKey];
            }

            let cards = data ? [...data.cards] : [];
            const dawho = { cardName: 'æ°¸è± DAWHO', rate: 0.035, scheme: 'åœ‹å…§å…¨é€šè·¯', note: 'ç„¡è…¦åˆ·', tag: 'all' };
            
            if (!cards.find(c => c.cardName === 'æ°¸è± DAWHO')) {
                cards.push(dawho);
            }

            cards.sort((a, b) => b.rate - a.rate);
            const bestCard = cards[0];

            container.innerHTML = `
                <div class="merchant-list" onclick='openRankingModal(${JSON.stringify(cards)}, "${name}")'>
                    <div class="merchant-header">
                        <span class="merchant-name">${name}</span>
                        <span class="merchant-type">é»æ“ŠæŸ¥çœ‹æ’å</span>
                    </div>
                    <div class="merchant-best-card">
                        ğŸ† ${bestCard.cardName} ${(bestCard.rate * 100).toFixed(1)}%
                    </div>
                    <div style="font-size:0.85em; color:#666; margin-top:4px;">
                        ${bestCard.scheme} â€¢ ${bestCard.note.replace(/<[^>]*>/g, '')}
                    </div>
                </div>
            `;
        }

        // === 4. æ’åå½ˆçª— ===
        function openRankingModal(cards, merchantName) {
            const body = document.getElementById('detailBody');
            document.getElementById('modalTitle').innerText = `${merchantName} å›é¥‹æ’å`;
            
            const html = cards.map((c, idx) => {
                let badgeClass = 'scheme-badge';
                if (c.tag === 'crazy') badgeClass += ' crazy';
                if (c.rate >= 0.07) badgeClass += ' new-user';

                return `
                    <div class="ranking-row">
                        <div style="flex:1;">
                            <div class="ranking-card">${idx + 1}. ${c.cardName}</div>
                            <span class="${badgeClass}">${c.scheme}</span>
                            <span class="ranking-note">${c.note}</span>
                        </div>
                        <div class="ranking-rate ${idx === 0 ? 'top' : ''}">${(c.rate * 100).toFixed(1)}%</div>
                    </div>
                `;
            }).join('');

            body.innerHTML = html;
            document.getElementById('detailModal').classList.add('show');
        }

        // === 5. æ¬Šç›Šç¸½è¦½ (åˆ†é¡è©³æƒ…) ===
        function renderCardOverview() {
            const container = document.getElementById('cardOverviewContainer');
            const html = cardBenefitsData.map((card, cardIndex) => `
                <div class="card-accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <div class="card-title-row">
                            <span class="card-icon">${card.icon}</span>
                            <span class="card-title-text">${card.name}</span>
                        </div>
                        <span class="chevron">â–¼</span>
                    </div>
                    <div class="accordion-body">
                        <div class="benefit-row no-action" style="background:#fffcec; border-bottom:1px dashed #e0e0e0;">
                            <div class="benefit-name" style="font-size:0.9em; color:#666;">â„¹ï¸ å¡ç‰‡å‚™è¨»</div>
                            <div class="benefit-desc">${card.note}</div>
                        </div>
                        ${renderBenefits(card, cardIndex)}
                    </div>
                </div>
            `).join('');
            container.innerHTML = html;
        }

        function renderBenefits(card, cardIndex) {
            return card.benefits.map((b, bIndex) => {
                if (card.id === 'unicard' && b.type === 'text') {
                    return `
                        <div class="benefit-row no-action">
                            <div class="benefit-header">
                                <span class="benefit-name">${b.name}</span>
                                <span class="benefit-rate">${(b.rate * 100).toFixed(1)}%</span>
                            </div>
                            <div class="benefit-desc">${b.desc}</div>
                        </div>
                    `;
                }
                
                const isClickable = b.categories && Object.keys(b.categories).length > 0;
                return `
                    <div class="benefit-row ${isClickable ? '' : 'no-action'}" 
                         onclick="${isClickable ? `openSchemeList(${cardIndex}, ${bIndex})` : ''}">
                        <div class="benefit-header">
                            <span class="benefit-name">${b.name}</span>
                            <span class="benefit-rate ${b.rate >= 0.035 ? 'high' : ''}">${b.rate > 0 ? (b.rate * 100).toFixed(1) + '%' : ''}</span>
                        </div>
                        <div class="benefit-desc">${b.desc}</div>
                        ${b.note ? `<div class="benefit-note">ğŸ’¡ ${b.note}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        function openSchemeList(cardIndex, benefitIndex) {
            const benefit = cardBenefitsData[cardIndex].benefits[benefitIndex];
            const cardName = cardBenefitsData[cardIndex].name;
            
            document.getElementById('modalTitle').innerText = `${cardName} - ${benefit.name}`;
            
            let htmlContent = `<div style="margin-bottom:15px; font-size:0.9em; color:#666;">${benefit.note}</div>`;
            
            if (benefit.categories) {
                Object.entries(benefit.categories).forEach(([categoryName, items]) => {
                    htmlContent += `
                        <div class="detail-category-group">
                            <div class="detail-category-title">${categoryName}</div>
                            <div class="scheme-list-container">
                                ${items.map(item => `<span class="scheme-list-item">${item}</span>`).join('')}
                            </div>
                        </div>
                    `;
                });
            } else {
                htmlContent += '<div style="color:#999;">æš«ç„¡è©³ç´°æ¸…å–®</div>';
            }

            document.getElementById('detailBody').innerHTML = htmlContent;
            document.getElementById('detailModal').classList.add('show');
        }

        function toggleAccordion(header) {
            const body = header.nextElementSibling;
            const isOpen = body.classList.contains('open');
            if (!isOpen) {
                body.classList.add('open');
                header.classList.add('active');
            } else {
                body.classList.remove('open');
                header.classList.remove('active');
            }
        }

        function switchTab(tabId) {
            currentTab = tabId;
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.querySelector(`.nav-item[onclick="switchTab('${tabId}')"]`).classList.add('active');
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(`tab-${tabId}`).classList.add('active');
        }

        function closeDetailModal() {
            document.getElementById('detailModal').classList.remove('show');
        }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
